
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>蚂蚁金服SOFA-Boot整合SOFA-RPC(中篇) | Coding | Harrison&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="baidu-site-verification" content="0aFfZiB4tV" />
  
  
  <meta name="description" content="前言上篇文章简单地介绍了 SOFA-Boot 的功能特性，对 Readiness 健康检查的配置举例说明。重点介绍了如何在 SOFA-Boot 中引入 SOFA-RPC 中间件，给出了基于 bolt、rest 和 dubbo 等不同协议通道的服务发布与消费的全流程。">
<meta name="keywords" content="RPC,SOFA-Boot,SOFA_RPC">
<meta property="og:type" content="article">
<meta property="og:title" content="蚂蚁金服SOFA-Boot整合SOFA-RPC(中篇)">
<meta property="og:url" content="https://ostenant.coding.me/2018/05/09/蚂蚁金服SOFA-Boot整合SOFA-RPC(中篇)/index.html">
<meta property="og:site_name" content="Coding | Harrison&#39;s Blog">
<meta property="og:description" content="前言上篇文章简单地介绍了 SOFA-Boot 的功能特性，对 Readiness 健康检查的配置举例说明。重点介绍了如何在 SOFA-Boot 中引入 SOFA-RPC 中间件，给出了基于 bolt、rest 和 dubbo 等不同协议通道的服务发布与消费的全流程。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://ols3fdyll.bkt.clouddn.com/SOFA.JPG">
<meta property="og:image" content="http://ols3fdyll.bkt.clouddn.com/sofa-bolt-invoke-way.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/10548396-035e78bdc34c7525?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2018-05-10T07:36:51.543Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="蚂蚁金服SOFA-Boot整合SOFA-RPC(中篇)">
<meta name="twitter:description" content="前言上篇文章简单地介绍了 SOFA-Boot 的功能特性，对 Readiness 健康检查的配置举例说明。重点介绍了如何在 SOFA-Boot 中引入 SOFA-RPC 中间件，给出了基于 bolt、rest 和 dubbo 等不同协议通道的服务发布与消费的全流程。">
<meta name="twitter:image" content="http://ols3fdyll.bkt.clouddn.com/SOFA.JPG">
  
    <link rel="alternative" href="/atom.xml" title="Coding | Harrison&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
 
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Coding | Harrison&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">上善若水任方猿</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="https://github.com/ostenant">Github</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="ostenant.coding.me">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-蚂蚁金服SOFA-Boot整合SOFA-RPC(中篇)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/09/蚂蚁金服SOFA-Boot整合SOFA-RPC(中篇)/" class="article-date">
  <time datetime="2018-05-09T07:08:00.000Z" itemprop="datePublished">2018-05-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/RPC通信框架系列/">RPC通信框架系列</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      蚂蚁金服SOFA-Boot整合SOFA-RPC(中篇)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>上篇文章简单地介绍了 SOFA-Boot 的功能特性，对 Readiness 健康检查的配置举例说明。重点介绍了如何在 SOFA-Boot 中引入 SOFA-RPC 中间件，给出了基于 bolt、rest 和 dubbo 等不同协议通道的服务发布与消费的全流程。</p>
<a id="more"></a>
<p><img src="http://ols3fdyll.bkt.clouddn.com/SOFA.JPG" alt=""></p>
<p>本文将进一步介绍 SOFA-RPC 中间件提供的丰富而强大的功能，包括单向调用、同步调用、Future调用、回调，泛化调用，过滤器配置等。</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="1-调用方式"><a href="#1-调用方式" class="headerlink" title="1. 调用方式"></a>1. 调用方式</h2><p>SOFA-RPC 提供单向调用、同步调用、异步调用和回调四种调用机制。为了区分四者的不同之处，这里给出 SOFA 官方提供的原理图。</p>
<p><img src="http://ols3fdyll.bkt.clouddn.com/sofa-bolt-invoke-way.png" alt=""></p>
<p>下面给出详细阐述和配置说明：</p>
<h3 id="1-1-单向方式"><a href="#1-1-单向方式" class="headerlink" title="1.1. 单向方式"></a>1.1. 单向方式</h3><p>当前线程发起调用后，不关心调用结果，不做超时控制，只要请求已经发出，就完成本次调用。目前支持 bolt 协议。</p>
<h4 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h4><p>使用单向方式需要在<strong>服务引用</strong>的时候通过 <code>sofa:global-attrs</code> 元素的 <code>type</code> 属性声明调用方式为 <code>oneway</code> ，这样使用该服务引用发起调用时就是使用的单向方式了。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sofa:reference</span> <span class="attr">id</span>=<span class="string">"helloOneWayServiceReference"</span> <span class="attr">interface</span>=<span class="string">"com.ostenant.sofa.rpc.example.invoke.HelloOneWayService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sofa:binding.bolt</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sofa:global-attrs</span> <span class="attr">type</span>=<span class="string">"oneway"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sofa:binding.bolt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sofa:reference</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h4><p>单向调用不保证成功，而且发起方无法知道调用结果。因此通常用于可以重试，或者定时通知类的场景，调用过程是有可能因为网络问题，机器故障等原因，导致请求失败。业务场景需要能接受这样的异常场景，才可以使用。</p>
<h3 id="1-2-同步方式"><a href="#1-2-同步方式" class="headerlink" title="1.2. 同步方式"></a>1.2. 同步方式</h3><p>当前线程发起调用后，需要在指定的超时时间内，等到响应结果，才能完成本次调用。如果超时时间内没有得到结果，那么会抛出超时异常。</p>
<h4 id="配置说明-1"><a href="#配置说明-1" class="headerlink" title="配置说明"></a>配置说明</h4><p><strong>服务接口与实现类</strong></p>
<p>SOFA-RPC 缺省采用的就是同步调用，可以省略 <code>sofa:global-attrs</code> 配置项。</p>
<p><strong>服务端发布配置</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloSyncServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.ostenant.sofa.rpc.example.invoke.HelloSyncServiceImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sofa:service</span> <span class="attr">ref</span>=<span class="string">"helloSyncServiceImpl"</span> <span class="attr">interface</span>=<span class="string">"com.ostenant.sofa.rpc.example.invoke.HelloSyncService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sofa:binding.bolt</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sofa:service</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>客户端引用配置</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sofa:reference</span> <span class="attr">id</span>=<span class="string">"helloSyncServiceReference"</span> <span class="attr">interface</span>=<span class="string">"com.ostenant.sofa.rpc.example.invoke.HelloSyncService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sofa:binding.bolt</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sofa:reference</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>服务端启动入口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication springApplication = <span class="keyword">new</span> SpringApplication(SyncServerApplication.class);</span><br><span class="line">ApplicationContext applicationContext = springApplication.run(args);</span><br></pre></td></tr></table></figure>
<p><strong>客户端启动入口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication springApplication = <span class="keyword">new</span> SpringApplication(SyncClientApplication.class);</span><br><span class="line">ApplicationContext applicationContext = springApplication.run(args);</span><br></pre></td></tr></table></figure>
<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HelloSyncService helloSyncServiceReference = (HelloSyncService) applicationContext.getBean(<span class="string">"helloSyncServiceReference"</span>);</span><br><span class="line">System.out.println(helloSyncServiceReference.saySync(<span class="string">"sync"</span>));</span><br></pre></td></tr></table></figure>
<h4 id="适用场景-1"><a href="#适用场景-1" class="headerlink" title="适用场景"></a>适用场景</h4><p>同步调用是最常用的方式。注意要根据对端的处理能力，合理设置超时时间。</p>
<h3 id="1-3-Future方式"><a href="#1-3-Future方式" class="headerlink" title="1.3. Future方式"></a>1.3. Future方式</h3><p>Future 方式下，客户端发起调用后不会等待服务端的结果，继续执行后面的业务逻辑。服务端返回的结果会被 SOFA-RPC 缓存，当客户端需要结果的时候，需要主动获取。目前支持 bolt 协议。</p>
<h4 id="配置说明-2"><a href="#配置说明-2" class="headerlink" title="配置说明"></a>配置说明</h4><p><strong>服务接口和实现类</strong></p>
<p>HelloFutureService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HelloFutureService</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">sayFuture</span><span class="params">(String future)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HelloFutureServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloFutureServiceImpl</span> <span class="keyword">implements</span> <span class="title">HelloFutureService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayFuture</span><span class="params">(String future)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> future;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>服务端发布配置</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloFutureServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.ostenant.sofa.rpc.example.invoke.HelloFutureServiceImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sofa:service</span> <span class="attr">ref</span>=<span class="string">"helloFutureServiceImpl"</span> <span class="attr">interface</span>=<span class="string">"com.ostenant.sofa.rpc.example.invoke.HelloFutureService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sofa:binding.bolt</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sofa:service</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>客户端引用配置</strong></p>
<p>使用 Future 方式需要在服务引用的时候通过 <code>sofa:global-attrs</code> 元素的 <code>type</code> 属性声明调用方式为 <code>future</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sofa:reference</span> <span class="attr">id</span>=<span class="string">"helloFutureServiceReference"</span> <span class="attr">interface</span>=<span class="string">"com.ostenant.sofa.rpc.example.invoke.HelloFutureService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sofa:binding.bolt</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sofa:global-attrs</span> <span class="attr">type</span>=<span class="string">"future"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sofa:binding.bolt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sofa:reference</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样使用该服务引用发起调用时就是使用的 <code>Future</code> 方式了。</p>
<p><strong>服务端启动入口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication springApplication = <span class="keyword">new</span> SpringApplication(FutureServerApplication.class);</span><br><span class="line">ApplicationContext applicationContext = springApplication.run(args);</span><br></pre></td></tr></table></figure>
<p><strong>客户端启动入口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication springApplication = <span class="keyword">new</span> SpringApplication(FutureClientApplication.class);</span><br><span class="line">ApplicationContext applicationContext = springApplication.run(args);</span><br></pre></td></tr></table></figure>
<p>客户端获取返回结果有两种方式：</p>
<ul>
<li>其一，通过 <code>SofaResponseFuture</code> 直接获取结果。第一个参数是获取结果的超时时间，第二个参数表示是否清除线程上下文中的结果。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HelloFutureService helloFutureServiceReference = (HelloFutureService) applicationContext</span><br><span class="line">    .getBean(<span class="string">"helloFutureServiceReference"</span>);</span><br><span class="line">helloFutureServiceReference.sayFuture(<span class="string">"future"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    String result = (String)SofaResponseFuture.getResponse(<span class="number">1000</span>, <span class="keyword">true</span>);</span><br><span class="line">    System.out.println(<span class="string">"Future result: "</span> + result)</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>其二，获取原生 Future。该种方式会获取 JDK 原生的 Future ，参数表示是否清除线程上下文中的结果。获取结果的方式就是 JDK Future 的获取方式。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HelloFutureService helloFutureServiceReference = (HelloFutureService) applicationContext</span><br><span class="line">    .getBean(<span class="string">"helloFutureServiceReference"</span>);</span><br><span class="line">helloFutureServiceReference.sayFuture(<span class="string">"future"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Future future = SofaResponseFuture.getFuture(<span class="keyword">true</span>);</span><br><span class="line">    String result = (String)future.get(<span class="number">1000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">    System.out.println(<span class="string">"Future result: "</span> + result)</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="适用场景-2"><a href="#适用场景-2" class="headerlink" title="适用场景"></a>适用场景</h4><p>Future 方式适用于非阻塞编程模式。对于客户端程序处理后，不需要立即获取返回结果，可以先完成后续程序代码执行，在后续业务中，主动从当前线程上下文获取调用返回结果。减少了网络 IO 等待造成的代码运行阻塞和延迟。</p>
<h3 id="1-4-回调方式"><a href="#1-4-回调方式" class="headerlink" title="1.4. 回调方式"></a>1.4. 回调方式</h3><p>当前线程发起调用，则本次调用马上结束，可以马上执行下一次调用。发起调用时需要注册一个回调，该回调需要分配一个异步线程池。待响应返回后，会在回调的异步线程池，来执行回调逻辑。</p>
<h4 id="配置说明-3"><a href="#配置说明-3" class="headerlink" title="配置说明"></a>配置说明</h4><p><strong>服务接口和实现类</strong></p>
<p>HelloCallbackService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HelloCallbackService</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">sayCallback</span><span class="params">(String callback)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HelloCallbackServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloCallbackServiceImpl</span> <span class="keyword">implements</span> <span class="title">HelloCallbackService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayCallback</span><span class="params">(String string)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>业务回调类</strong></p>
<p>客户端回调类需要实现 <code>com.alipay.sofa.rpc.core.invoke.SofaResponseCallback</code> 接口。</p>
<p>CallbackImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallbackImpl</span> <span class="keyword">implements</span> <span class="title">SofaResponseCallback</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAppResponse</span><span class="params">(Object appResponse, String methodName, RequestBase request)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"callback client process:"</span> + appResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAppException</span><span class="params">(Throwable throwable, String methodName, RequestBase request)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSofaException</span><span class="params">(SofaRpcException sofaException, String methodName, RequestBase request)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SofaResponseCallback 接口提供了 3 个方法：</p>
<ul>
<li>onAppResponse: 程序正常运行，则进入该回调方法。</li>
<li>onAppException: 服务端程序抛出异常，则进入该回调方法。</li>
<li>onSofaException: 框架内部出现错误，则进入该回调方法。</li>
</ul>
<p><strong>服务端发布配置</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloCallbackServiceImpl"</span> <span class="attr">class</span>=<span class="string">"helloFutureServiceReference"</span> <span class="attr">interface</span>=<span class="string">"com.ostenant.sofa.rpc.example.invoke.HelloCallbackServiceImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sofa:service</span> <span class="attr">ref</span>=<span class="string">"helloCallbackServiceImpl"</span> <span class="attr">interface</span>=<span class="string">"helloFutureServiceReference"</span> <span class="attr">interface</span>=<span class="string">"com.ostenant.sofa.rpc.example.invoke.HelloCallbackService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sofa:binding.bolt</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sofa:service</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>客户端引用配置</strong></p>
<p>在服务引用的时候通过 <code>sofa:global-attrs</code> 元素的 <code>type</code> 属性声明调用方式为 <code>callback</code> ，再通过 <code>callback-ref</code> 声明回调的实现类。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"callbackImpl"</span> <span class="attr">class</span>=<span class="string">"com.ostenant.sofa.rpc.example.invoke.CallbackImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sofa:reference</span> <span class="attr">id</span>=<span class="string">"helloCallbackServiceReference"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">interface</span>=<span class="string">"com.ostenant.sofa.rpc.example.invoke.HelloCallbackService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sofa:binding.bolt</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sofa:global-attrs</span> <span class="attr">type</span>=<span class="string">"callback"</span> <span class="attr">callback-ref</span>=<span class="string">"callbackImpl"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sofa:binding.bolt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sofa:reference</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样使用该服务引用发起调用时，就是使用的回调方式了。在结果返回时，由 SOFA-RPC 自动调用该回调类的相应方法。</p>
<p><strong>服务端启动入口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication springApplication = <span class="keyword">new</span> SpringApplication(CallbackServerApplication.class);</span><br><span class="line">ApplicationContext applicationContext = springApplication.run(args);</span><br></pre></td></tr></table></figure>
<p><strong>客户端启动入口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication springApplication = <span class="keyword">new</span> SpringApplication(CallbackClientApplication.class);</span><br><span class="line">ApplicationContext applicationContext = springApplication.run(args);</span><br></pre></td></tr></table></figure>
<p><strong>客户端发起调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HelloCallbackService helloCallbackServiceReference = (HelloCallbackService) applicationContext</span><br><span class="line">            .getBean(<span class="string">"helloCallbackServiceReference"</span>);</span><br><span class="line">helloCallbackServiceReference.sayCallback(<span class="string">"callback"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sayCallback() 的返回值不应该直接获取。在客户端注册的回调类中，返回值会以参数的形式传入正确的方法，以回调的形式完成后续逻辑处理。</p>
<h4 id="适用场景-3"><a href="#适用场景-3" class="headerlink" title="适用场景"></a>适用场景</h4><p>Callback 方式适用于异步非阻塞编程模式。客户端程序所在线程发起调用后，继续执行后续操作，不需要主动去获取返回值。服务端程序处理完成，将返回值传回一个异步线程池，由子线程通过回调函数进行返回值处理。很大情况的减少了网络 IO 阻塞，解决了单线程的瓶颈，实现了异步编程。</p>
<h2 id="2-泛化调用"><a href="#2-泛化调用" class="headerlink" title="2. 泛化调用"></a>2. 泛化调用</h2><p>泛化调用方式能够在客户端不依赖服务端的接口情况下发起调用，目前支持 bolt 协议。由于不知道服务端的接口，因此需要通过字符串的方式将服务端的接口，调用的方法，参数及结果类进行描述。</p>
<h4 id="配置说明-4"><a href="#配置说明-4" class="headerlink" title="配置说明"></a>配置说明</h4><p><strong>泛化参数类</strong></p>
<p>SampleGenericParamModel.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleGenericParamModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>泛化返回类</strong></p>
<p>SampleGenericResultModel.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleGenericResultModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>服务接口和实现类</strong></p>
<p>SampleGenericService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SampleGenericService</span> </span>&#123;</span><br><span class="line">    <span class="function">SampleGenericResultModel <span class="title">sayGeneric</span><span class="params">(SampleGenericParamModel sampleGenericParamModel)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>SampleGenericParamModel：作为 sayGeneric() 的输入参数类型，有一个 <code>name</code> 成员变量，作为真正的方法入参。</p>
</li>
<li><p>SampleGenericResultModel：作为 sayGeneric() 的返回结果类型，声明了 <code>name</code> 和 <code>value</code> 两个成员变量，作为真实的返回值。 </p>
</li>
</ul>
<p>SampleGenericServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleGenericServiceImpl</span> <span class="keyword">implements</span> <span class="title">SampleGenericService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SampleGenericResultModel <span class="title">sayGeneric</span><span class="params">(SampleGenericParamModel sampleGenericParamModel)</span> </span>&#123;</span><br><span class="line">        String name = sampleGenericParamModel.getName();</span><br><span class="line">        SampleGenericResultModel resultModel = <span class="keyword">new</span> SampleGenericResultModel();</span><br><span class="line">        resultModel.setName(name);</span><br><span class="line">        resultModel.setValue(<span class="string">"sample generic value"</span>);</span><br><span class="line">        <span class="keyword">return</span> resultModel;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>服务端发布配置</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">"sampleGenericServiceImpl"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.ostenant.sofa.rpc.example.generic.SampleGenericServiceImpl"</span>/&gt;</span><br><span class="line">&lt;sofa:service ref=<span class="string">"sampleGenericServiceImpl"</span> <span class="class"><span class="keyword">interface</span></span>=<span class="string">"com.ostenant.sofa.rpc.example.generic.SampleGenericService"</span>&gt;</span><br><span class="line">    &lt;sofa:binding.bolt/&gt;</span><br><span class="line">&lt;/sofa:service&gt;</span><br></pre></td></tr></table></figure>
<p><strong>客户端引用配置</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;sofa:reference id=<span class="string">"sampleGenericServiceReference"</span> <span class="class"><span class="keyword">interface</span></span>=<span class="string">"com.alipay.sofa.rpc.api.GenericService"</span>&gt;</span><br><span class="line">    &lt;sofa:binding.bolt&gt;</span><br><span class="line">        &lt;sofa:global-attrs generic-<span class="class"><span class="keyword">interface</span></span>=<span class="string">"com.ostenant.sofa.rpc.example.generic.SampleGenericService"</span>/&gt;</span><br><span class="line">    &lt;/sofa:binding.bolt&gt;</span><br><span class="line">&lt;/sofa:reference&gt;</span><br></pre></td></tr></table></figure>
<p>在泛化调用过程中，客户端配置有两点需要注意：</p>
<ul>
<li><code>sofa:reference</code> 指向的服务接口需要声明为 SOFA-RPC 提供的泛化接口 <code>com.alipay.sofa.rpc.api.GenericService</code>。</li>
<li><code>sofa:global-attrs</code> 需要声明属性 <code>generic-interface</code>，value 为真实的服务接口名称。</li>
</ul>
<p><strong>服务端启动入口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication springApplication = <span class="keyword">new</span> SpringApplication(SampleGenericServerApplication.class);</span><br><span class="line">ApplicationContext applicationContext = springApplication.run(args);</span><br></pre></td></tr></table></figure>
<p><strong>客户端启动入口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication springApplication = <span class="keyword">new</span> SpringApplication(SampleGenericClientApplication.class);</span><br><span class="line">ApplicationContext applicationContext = springApplication.run(args);</span><br></pre></td></tr></table></figure>
<p><strong>客户端发起调用</strong></p>
<ul>
<li>获取服务的泛化引用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GenericService sampleGenericServiceReference = (GenericService) applicationContext</span><br><span class="line">    .getBean(<span class="string">"sampleGenericServiceReference"</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>准备方法参数 </li>
</ul>
<p>由于客户端没有调用服务的参数类，因此通过 <code>com.alipay.hessian.generic.model.GenericObjectGenericObject</code> 进行描述。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 准备方法参数</span></span><br><span class="line">GenericObject genericParam = <span class="keyword">new</span> GenericObject(</span><br><span class="line">    <span class="string">"com.ostenant.sofa.rpc.example.generic.SampleGenericParamModel"</span>);</span><br><span class="line">genericParam.putField(<span class="string">"name"</span>, <span class="string">"Harrison"</span>);</span><br></pre></td></tr></table></figure>
<p><code>GenericObject</code> 持有一个 <code>Map&lt;String, Object&gt;</code> 类型的变量，你能够通过 <code>GenericObject</code> 提供的 <code>putField()</code> 方法，将参数类的属性和值放到这个 <code>Map</code> 中，以此来描述参数类。</p>
<ul>
<li>发起泛化调用</li>
</ul>
<p>通过 <code>GenericService</code> 的 <code>$genericInvoke(arg1, agr2, arg3)</code> 方法可以发起服务的泛化调用，各个参数含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">含义</th>
<th style="text-align:left">参数可选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">arg1</td>
<td style="text-align:left">目标方法名称</td>
<td style="text-align:left">必填</td>
</tr>
<tr>
<td style="text-align:left">arg2</td>
<td style="text-align:left">参数类型的数组，要求严格遵循先后次序</td>
<td style="text-align:left">必填</td>
</tr>
<tr>
<td style="text-align:left">arg3</td>
<td style="text-align:left">参数值的数组，要求与参数类型数组保持一致</td>
<td style="text-align:left">必填</td>
</tr>
<tr>
<td style="text-align:left">arg4</td>
<td style="text-align:left">返回值的Class类型</td>
<td style="text-align:left">可选</td>
</tr>
</tbody>
</table>
<p>方式一：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GenericObject genericResult = (GenericObject) sampleGenericServiceReference.$genericInvoke(</span><br><span class="line">    <span class="comment">// 目标方法名称</span></span><br><span class="line">    <span class="string">"sayGeneric"</span>,</span><br><span class="line">    <span class="comment">// 参数类型名称</span></span><br><span class="line">    <span class="keyword">new</span> String[] &#123; <span class="string">"com.ostenant.sofa.rpc.example.generic.SampleGenericParamModel"</span> &#125;,</span><br><span class="line">    <span class="comment">// 参数的值</span></span><br><span class="line">    <span class="keyword">new</span> Object[] &#123; genericParam &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证返回结果</span></span><br><span class="line">System.out.println(<span class="string">"Type: "</span> + genericResult.getType());</span><br><span class="line">System.out.println(<span class="string">"Name: "</span> + genericResult.getField(<span class="string">"name"</span>));</span><br><span class="line">System.out.println(<span class="string">"Value: "</span> + genericResult.getField(<span class="string">"value"</span>));</span><br></pre></td></tr></table></figure>
<p>方式二：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SampleGenericResultModel sampleGenericResult = sampleGenericServiceReference.$genericInvoke(</span><br><span class="line">    <span class="comment">// 目标方法名称</span></span><br><span class="line">    <span class="string">"sayGeneric"</span>,</span><br><span class="line">    <span class="comment">// 参数类型名称</span></span><br><span class="line">    <span class="keyword">new</span> String[] &#123; <span class="string">"com.ostenant.sofa.rpc.example.generic.SampleGenericParamModel"</span> &#125;,</span><br><span class="line">    <span class="comment">// 参数的值</span></span><br><span class="line">    <span class="keyword">new</span> Object[] &#123; genericParam &#125;,</span><br><span class="line">    <span class="comment">// 返回值的Class类型</span></span><br><span class="line">    SampleGenericResultModel.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证返回结果</span></span><br><span class="line">System.out.println(<span class="string">"Type: "</span> + sampleGenericResult.getClass().getName());</span><br><span class="line">System.out.println(<span class="string">"Name: "</span> + sampleGenericResult.getName());</span><br><span class="line">System.out.println(<span class="string">"Value: "</span> + sampleGenericResult.getValue());</span><br></pre></td></tr></table></figure>
<p><strong>查看控制台输出</strong></p>
<p>两种方式输出如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Type: com.ostenant.sofa.rpc.example.generic.SampleGenericResultModel</span><br><span class="line">Name: Harrison</span><br><span class="line">Value: sample generic value</span><br></pre></td></tr></table></figure>
<h2 id="3-过滤器配置"><a href="#3-过滤器配置" class="headerlink" title="3. 过滤器配置"></a>3. 过滤器配置</h2><p>SOFA-RPC 通过过滤器 Filter 来实现对请求和响应的拦截处理。用户可以自定义 Filter 实现拦截扩展，目前支持 bolt 协议。开发人员通过继承 <code>com.alipay.sofa.rpc.filter.Filter</code> 实现过滤器的自定义。</p>
<h4 id="配置说明-5"><a href="#配置说明-5" class="headerlink" title="配置说明"></a>配置说明</h4><p><strong>服务接口与实现类</strong></p>
<p>FilterService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FilterService</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">sayFilter</span><span class="params">(String filter)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>FilterServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FilterServiceImpl</span> <span class="keyword">implements</span> <span class="title">FilterService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayFilter</span><span class="params">(String filter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filters;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>服务端过滤器</strong></p>
<p>在 Filter 实现类中，<code>invoke()</code> 方法实现具体的拦截逻辑，通过 <code>FilterInvoker.invoke(SofaRequest)</code> 触发服务的调用，在该方法前后可以实现具体的拦截处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleServerFilter</span> <span class="keyword">extends</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SofaResponse <span class="title">invoke</span><span class="params">(FilterInvoker invoker, SofaRequest request)</span> <span class="keyword">throws</span> SofaRpcException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SampleFilter before server process"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> invoker.invoke(request);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"SampleFilter after server process"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>服务端发布配置</strong></p>
<p>服务端需要配置服务实现类、过滤器，然后在 <code>sofa:service</code> 的 <code>sofa:global-attrs</code> 标签配置 <code>filter</code> 属性，实现两者的绑定。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sampleFilter"</span> <span class="attr">class</span>=<span class="string">"com.ostenant.sofa.rpc.example.filter.SampleServerFilter"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"filterService"</span> <span class="attr">class</span>=<span class="string">"com.ostenant.sofa.rpc.example.filter.FilterServiceImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sofa:service</span> <span class="attr">ref</span>=<span class="string">"filterService"</span> <span class="attr">interface</span>=<span class="string">"com.ostenant.sofa.rpc.example.filter.FilterService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sofa:binding.bolt</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sofa:global-attrs</span> <span class="attr">filter</span>=<span class="string">"sampleFilter"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sofa:binding.bolt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sofa:service</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>客户端过滤器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleClientFilter</span> <span class="keyword">extends</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SofaResponse <span class="title">invoke</span><span class="params">(FilterInvoker invoker, SofaRequest request)</span> <span class="keyword">throws</span> SofaRpcException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SampleFilter before client invoke"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> invoker.invoke(request);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"SampleFilter after client invoke"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>客户端引用配置</strong></p>
<p>同样的，客户端过滤器需要在 <code>sofa:reference</code> 的 <code>sofa:global-attrs</code> 标签中配置 <code>filter</code> 属性，实现客户端引用类的调用拦截。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sampleFilter"</span> <span class="attr">class</span>=<span class="string">"com.alipay.sofa.rpc.samples.filter.SampleClientFilter"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sofa:reference</span> <span class="attr">id</span>=<span class="string">"filterServiceReference"</span> <span class="attr">interface</span>=<span class="string">"com.ostenant.sofa.rpc.example.filter.FilterService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sofa:binding.bolt</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sofa:global-attrs</span> <span class="attr">filter</span>=<span class="string">"sampleFilter"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sofa:binding.bolt</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sofa:reference</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>服务端启动类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication springApplication = <span class="keyword">new</span> SpringApplication(FilterServerApplication.class);</span><br><span class="line">ApplicationContext applicationContext = springApplication.run(args);</span><br></pre></td></tr></table></figure>
<p><strong>客户端启动类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication springApplication = <span class="keyword">new</span> SpringApplication(FilterClientApplication.class);</span><br><span class="line">ApplicationContext applicationContext = springApplication.run(args);</span><br></pre></td></tr></table></figure>
<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FilterService filterServiceReference = (FilterService) applicationContext.getBean(<span class="string">"filterServiceReference"</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// sleep 5s, 便于观察过滤器效果</span></span><br><span class="line">    Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String result = filterServiceReference.sayFilter(<span class="string">"filter"</span>);</span><br><span class="line">System.out.println(<span class="string">"Invoke result: "</span> + result);</span><br></pre></td></tr></table></figure>
<p><strong>查看拦截输出</strong></p>
<ul>
<li>服务端打印输出</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SampleFilter before server process</span><br><span class="line">SampleFilter after server process</span><br></pre></td></tr></table></figure>
<ul>
<li>客户端打印输出</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SampleFilter before client invoke</span><br><span class="line">SampleFilter after client invoke</span><br><span class="line">Invoke result: filter</span><br></pre></td></tr></table></figure>
<p>过滤器配置生效，总结过滤器拦截先后次序如下：</p>
<ol>
<li>客户端发起调用 -&gt; 客户端前置拦截 -&gt; 服务端前置拦截          </li>
<li>服务端方法执行</li>
<li>服务端后置拦截 -&gt; 客户端后置拦截 -&gt; 客户端接收返回值</li>
</ol>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>本文介绍了 SOFA-RPC 的集中调用方式，包括单向调用、同步调用、Future调用、回调，引入了 SOFA-RPC 独有的泛化调用机制，同时对过滤器的配置进行了简单介绍。</p>
<hr>
<p>欢迎扫码关注我的个人技术公众号： 零壹技术栈</p>
<p><img src="http://upload-images.jianshu.io/upload_images/10548396-035e78bdc34c7525?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>本帐号将持续分享后端技术干货，包括虚拟机基础，多线程编程，高性能框架，异步、缓存和消息中间件，分布式和微服务，架构学习和进阶等学习资料和文章。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://ostenant.coding.me/2018/05/09/蚂蚁金服SOFA-Boot整合SOFA-RPC(中篇)/" data-id="cjhtbiao1003gvi4u3rwkbdpk" class="article-share-link" data-share="baidu" data-title="蚂蚁金服SOFA-Boot整合SOFA-RPC(中篇)">分享到</a>
      

      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RPC/">RPC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SOFA-Boot/">SOFA-Boot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SOFA-RPC/">SOFA_RPC</a></li></ul>

    </footer>
	
  
    
<nav id="article-nav">
  
    <a href="/2018/05/12/蚂蚁金服SOFA-Boot整合SOFA-RPC(下篇)/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">
        
          蚂蚁金服SOFA-Boot整合SOFA-RPC(下篇)
        
      </div>
    </a>
  
  
    <a href="/2018/05/08/蚂蚁金服SOFA-Boot整合SOFA-RPC(上篇)/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">蚂蚁金服SOFA-Boot整合SOFA-RPC(上篇)</div>
    </a>
  
</nav>

  
</article>








</section>
      
      <aside id="sidebar">
  
    
<div class="widget-wrap">
  <h3 class="widget-title">关于我</h3>
  <ul class="widget about-me">
    
    <li><img class="author" title="About me" src="/img/favicon.png" /></li>
    
    
    <li>ostenant@163.com</li>
    
    <li>一枚热爱生活，追逐自由的小技术！</li>
    
  </ul>
</div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker学习系列/">Docker学习系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ECMAScript基础系列/">ECMAScript基础系列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA编程进阶系列/">JAVA编程进阶系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA虚拟机系列/">JAVA虚拟机系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA设计模式系列/">JAVA设计模式系列</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JDK1-8编程系列/">JDK1.8编程系列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java编程基础系列/">Java编程基础系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java编程进阶系列/">Java编程进阶系列</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java虚拟机系列/">Java虚拟机系列</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RPC通信框架系列/">RPC通信框架系列</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RxJava异步框架系列/">RxJava异步框架系列</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Boot-2-0系列/">Spring Boot 2.0系列</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Boot-2-0系列/Spring-Reactive编程系列/">Spring Reactive编程系列</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Reactive编程系列/">Spring Reactive编程系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式系列/">分布式系列</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微服务系列/">微服务系列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术知识图谱/">技术知识图谱</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构学习系列/">架构学习系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络协议系列/">网络协议系列</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/认证与授权系列/">认证与授权系列</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/2PC/">2PC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/3PC/">3PC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Adapter/">Adapter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/">Apache</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BASE/">BASE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Builder/">Builder</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAP/">CAP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CentOS/">CentOS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Consul/">Consul</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Consul-template/">Consul-template</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECMAScript/">ECMAScript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTPS/">HTTPS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK/">JDK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK1-8/">JDK1.8</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NIO/">NIO</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth-2-0/">OAuth 2.0</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Prototype/">Prototype</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPC/">RPC</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reactive-Streams/">Reactive Streams</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reactor/">Reactor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reference/">Reference</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Registrator/">Registrator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxJava/">RxJava</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SOFA-Boot/">SOFA-Boot</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SOFA-RPC/">SOFA-RPC</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SOFA-RPC/">SOFA_RPC</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Singleton/">Singleton</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Boot-2-0/">Spring Boot 2.0</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Cloud/">Spring Cloud</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-WebFlux/">Spring WebFlux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thrift/">Thrift</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unique-ID/">Unique ID</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/">Web</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/">WebSocket</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/异步/">异步</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/2PC/" style="font-size: 10px;">2PC</a> <a href="/tags/3PC/" style="font-size: 10px;">3PC</a> <a href="/tags/Adapter/" style="font-size: 10px;">Adapter</a> <a href="/tags/Android/" style="font-size: 13.33px;">Android</a> <a href="/tags/Apache/" style="font-size: 13.33px;">Apache</a> <a href="/tags/BASE/" style="font-size: 10px;">BASE</a> <a href="/tags/Builder/" style="font-size: 10px;">Builder</a> <a href="/tags/CAP/" style="font-size: 10px;">CAP</a> <a href="/tags/CentOS/" style="font-size: 10px;">CentOS</a> <a href="/tags/Consul/" style="font-size: 11.67px;">Consul</a> <a href="/tags/Consul-template/" style="font-size: 10px;">Consul-template</a> <a href="/tags/Docker/" style="font-size: 13.33px;">Docker</a> <a href="/tags/ECMAScript/" style="font-size: 11.67px;">ECMAScript</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/JDK/" style="font-size: 10px;">JDK</a> <a href="/tags/JDK1-8/" style="font-size: 11.67px;">JDK1.8</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/Java/" style="font-size: 18.33px;">Java</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/OAuth-2-0/" style="font-size: 10px;">OAuth 2.0</a> <a href="/tags/Prototype/" style="font-size: 10px;">Prototype</a> <a href="/tags/RPC/" style="font-size: 20px;">RPC</a> <a href="/tags/Reactive-Streams/" style="font-size: 11.67px;">Reactive Streams</a> <a href="/tags/Reactor/" style="font-size: 10px;">Reactor</a> <a href="/tags/Reference/" style="font-size: 10px;">Reference</a> <a href="/tags/Registrator/" style="font-size: 10px;">Registrator</a> <a href="/tags/RxJava/" style="font-size: 13.33px;">RxJava</a> <a href="/tags/SOFA-Boot/" style="font-size: 13.33px;">SOFA-Boot</a> <a href="/tags/SOFA-RPC/" style="font-size: 11.67px;">SOFA-RPC</a> <a href="/tags/SOFA-RPC/" style="font-size: 11.67px;">SOFA_RPC</a> <a href="/tags/Singleton/" style="font-size: 10px;">Singleton</a> <a href="/tags/Spring-Boot-2-0/" style="font-size: 10px;">Spring Boot 2.0</a> <a href="/tags/Spring-Cloud/" style="font-size: 11.67px;">Spring Cloud</a> <a href="/tags/Spring-WebFlux/" style="font-size: 11.67px;">Spring WebFlux</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/Thrift/" style="font-size: 16.67px;">Thrift</a> <a href="/tags/Unique-ID/" style="font-size: 10px;">Unique ID</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/WebSocket/" style="font-size: 10px;">WebSocket</a> <a href="/tags/分布式/" style="font-size: 15px;">分布式</a> <a href="/tags/异步/" style="font-size: 13.33px;">异步</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/05/30/2018后端架构师技术图谱/">2018后端架构师技术图谱【转载】</a>
          </li>
        
          <li>
            <a href="/2018/05/27/实战Spring Boot 2.0 Reactive编程系列(一) - WebFlux初体验/">实战Spring Boot 2.0 Reactive编程系列(一) - WebFlux初体验</a>
          </li>
        
          <li>
            <a href="/2018/05/26/聊聊Spring Reactor反应式编程/">聊聊Spring Reactor反应式编程</a>
          </li>
        
          <li>
            <a href="/2018/05/23/Android异步框架RxJava 1.x系列(三) - 线程调度器Scheduler/">Android异步框架RxJava 1.x系列(三) - 线程调度器Scheduler</a>
          </li>
        
          <li>
            <a href="/2018/05/21/Android异步框架RxJava 1.x系列(二) - 事件及事件序列转换原理/">Android异步框架RxJava 1.x系列(二) - 事件及事件序列转换原理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://weekly.manong.io/issues" target="_blank">码农周刊</a>
          </li>
        
          <li>
            <a href="https://www.tuicool.com/mags" target="_blank">编程狂人</a>
          </li>
        
          <li>
            <a href="http://ifeve.com" target="_blank">并发编程网</a>
          </li>
        
          <li>
            <a href="https://juejin.im" target="_blank">掘金</a>
          </li>
        
          <li>
            <a href="http://www.jianshu.com" target="_blank">简书</a>
          </li>
        
          <li>
            <a href="https://github.com" target="_blank">Github</a>
          </li>
        
          <li>
            <a href="https://stackoverflow.com" target="_blank">StackoverFlow</a>
          </li>
        
          <li>
            <a href="http://www.infoq.com" target="_blank">Infoq</a>
          </li>
        
          <li>
            <a href="https://segmentfault.com" target="_blank">SegmentFault</a>
          </li>
        
          <li>
            <a href="http://www.importnew.com" target="_blank">ImportNew</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Chen Harrison<br>
      Powered by <a href="//hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="https://github.com/ostenant" class="mobile-nav-link">Github</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!--

-->



   

<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>



<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<script src="/js/script.js"></script>


</div>
</body>
</html>
