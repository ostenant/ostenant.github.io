<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>深入剖析Redis系列(三) - Redis集群模式搭建与原理详解 | Icarus&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="前言在 Redis 3.0 之前，使用 哨兵（sentinel）机制来监控各个节点之间的状态。Redis Cluster 是 Redis 的 分布式解决方案，在 3.0 版本正式推出，有效地解决了 Redis 在 分布式 方面的需求。当遇到 单机内存、并发、流量 等瓶颈时，可以采用 Cluster 架构方案达到 负载均衡 的目的。">
<meta name="keywords" content="负载均衡,Redis,Redis Cluster,TwemProxy,Codis,高可用,动态扩容">
<meta property="og:type" content="article">
<meta property="og:title" content="深入剖析Redis系列(三) - Redis集群模式搭建与原理详解">
<meta property="og:url" content="https://ostenant.coding.me/2018/08/29/深入剖析Redis系列(三) - Redis集群模式搭建与原理详解/index.html">
<meta property="og:site_name" content="Icarus&#39;s Blog">
<meta property="og:description" content="前言在 Redis 3.0 之前，使用 哨兵（sentinel）机制来监控各个节点之间的状态。Redis Cluster 是 Redis 的 分布式解决方案，在 3.0 版本正式推出，有效地解决了 Redis 在 分布式 方面的需求。当遇到 单机内存、并发、流量 等瓶颈时，可以采用 Cluster 架构方案达到 负载均衡 的目的。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/8/22/16560ce61de7471a?w=1772&h=591&f=jpeg&s=46258">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9e74a09b36?w=495&h=397&f=png&s=34726">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9e6f8b3a44?w=818&h=519&f=png&s=28712">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9e751d0773?w=1211&h=622&f=png&s=77243">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9e7509b300?w=1429&h=987&f=png&s=63694">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9e84b4b379?w=711&h=761&f=png&s=70609">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9e75424f0a?w=849&h=565&f=png&s=20637">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9f1b14840d?w=908&h=559&f=png&s=50894">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9f1b2a7661?w=1160&h=781&f=png&s=65891">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9f644d509a?w=507&h=567&f=png&s=22499">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9f56a93231?w=763&h=573&f=png&s=23603">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/1/16455ec5dcc40392?w=258&h=258&f=jpeg&s=16109">
<meta property="og:updated_time" content="2018-09-14T05:31:54.415Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深入剖析Redis系列(三) - Redis集群模式搭建与原理详解">
<meta name="twitter:description" content="前言在 Redis 3.0 之前，使用 哨兵（sentinel）机制来监控各个节点之间的状态。Redis Cluster 是 Redis 的 分布式解决方案，在 3.0 版本正式推出，有效地解决了 Redis 在 分布式 方面的需求。当遇到 单机内存、并发、流量 等瓶颈时，可以采用 Cluster 架构方案达到 负载均衡 的目的。">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2018/8/22/16560ce61de7471a?w=1772&h=591&f=jpeg&s=46258">
    

    
        <link rel="alternate" href="/" title="Icarus&#39;s Blog" type="application/atom+xml" />
    

    
        <link rel="icon" href="/css/images/cat.png" />
    

    <link rel="stylesheet" href="/libs/font-awesome5/css/fontawesome.min.css">
    <link rel="stylesheet" href="/libs/font-awesome5/css/fa-brands.min.css">
    <link rel="stylesheet" href="/libs/font-awesome5/css/fa-solid.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'true', 'auto');
ga('send', 'pageview');

</script>
    
    
        <meta name="google-site-verification" content="true" />
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Icarus&#39;s Blog</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">主页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">分类</a>
                
                    <a class="main-nav-link" href="/tags">标签</a>
                
                    <a class="main-nav-link" href="/wechat">公众号</a>
                
                    <a class="main-nav-link" href="/about">关于我</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.jpeg" />
                            <i class="fas fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fas fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">主页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">分类</a></td>
                
                    <td><a class="main-nav-link" href="/tags">标签</a></td>
                
                    <td><a class="main-nav-link" href="/wechat">公众号</a></td>
                
                    <td><a class="main-nav-link" href="/about">关于我</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile" class="profile-fixed">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/avatar.jpeg" />
            <h2 id="name">陈林 | Icarus</h2>
            <h3 id="title">年轻无为，卖码为生!</h3>
            <span id="location"><i class="fas fa-map-marker-alt" style="padding-right: 5px"></i>中国, 成都</span>
            <a id="follow" target="_blank" href="http://github.com/ostenant">关注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                71
                <span>文章</span>
            </div>
            <div class="article-info-block">
                97
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/ostenant" target="_blank" title="github" class=tooltip>
                            <i class="fab fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fab fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fab fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fab fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="linkedin" class=tooltip>
                            <i class="fab fa-linkedin"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fab fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-深入剖析Redis系列(三) - Redis集群模式搭建与原理详解" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            深入剖析Redis系列(三) - Redis集群模式搭建与原理详解
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2018/08/29/深入剖析Redis系列(三) - Redis集群模式搭建与原理详解/">
            <time datetime="2018-08-29T13:47:00.000Z" itemprop="datePublished">2018-08-29</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/Redis学习系列/">Redis学习系列</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Codis/">Codis</a>, <a class="tag-link" href="/tags/Redis/">Redis</a>, <a class="tag-link" href="/tags/Redis-Cluster/">Redis Cluster</a>, <a class="tag-link" href="/tags/TwemProxy/">TwemProxy</a>, <a class="tag-link" href="/tags/动态扩容/">动态扩容</a>, <a class="tag-link" href="/tags/负载均衡/">负载均衡</a>, <a class="tag-link" href="/tags/高可用/">高可用</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <hr>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在 <code>Redis 3.0</code> 之前，使用 <strong>哨兵</strong>（<code>sentinel</code>）机制来监控各个节点之间的状态。<code>Redis Cluster</code> 是 <code>Redis</code> 的 <strong>分布式解决方案</strong>，在 <code>3.0</code> 版本正式推出，有效地解决了 <code>Redis</code> 在 <strong>分布式</strong> 方面的需求。当遇到 <strong>单机内存</strong>、<strong>并发</strong>、<strong>流量</strong> 等瓶颈时，可以采用 <code>Cluster</code> 架构方案达到 <strong>负载均衡</strong> 的目的。</p>
<a id="more"></a>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/22/16560ce61de7471a?w=1772&amp;h=591&amp;f=jpeg&amp;s=46258" alt=""></p>
<p>本文将从 <strong>集群方案</strong>、<strong>数据分布</strong>、<strong>搭建集群</strong>、<strong>节点通信</strong>、<strong>集群伸缩</strong>、<strong>请求路由</strong>、<strong>故障转移</strong>、<strong>集群运维</strong> 等几个方面介绍 <code>Redis Cluster</code>。</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="1-Redis集群方案"><a href="#1-Redis集群方案" class="headerlink" title="1. Redis集群方案"></a>1. Redis集群方案</h2><p><code>Redis Cluster</code> 集群模式通常具有 <strong>高可用</strong>、<strong>可扩展性</strong>、<strong>分布式</strong>、<strong>容错</strong> 等特性。<code>Redis</code> 分布式方案一般有两种：</p>
<h3 id="1-1-客户端分区方案"><a href="#1-1-客户端分区方案" class="headerlink" title="1.1 客户端分区方案"></a>1.1 客户端分区方案</h3><p><strong>客户端</strong> 就已经决定数据会被 <strong>存储</strong> 到哪个 <code>redis</code> 节点或者从哪个 <code>redis</code> 节点 <strong>读取数据</strong>。其主要思想是采用 <strong>哈希算法</strong> 将 <code>Redis</code> 数据的 <code>key</code> 进行散列，通过 <code>hash</code> 函数，特定的 <code>key</code>会 <strong>映射</strong> 到特定的 <code>Redis</code> 节点上。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9e74a09b36?w=495&amp;h=397&amp;f=png&amp;s=34726" alt=""></p>
<p><strong>客户端分区方案</strong> 的代表为 <code>Redis Sharding</code>，<code>Redis Sharding</code> 是 <code>Redis Cluster</code> 出来之前，业界普遍使用的 <code>Redis</code> <strong>多实例集群</strong> 方法。<code>Java</code> 的 <code>Redis</code> 客户端驱动库 <code>Jedis</code>，支持 <code>Redis Sharding</code> 功能，即 <code>ShardedJedis</code> 以及 <strong>结合缓存池</strong> 的 <code>ShardedJedisPool</code>。</p>
<ul>
<li><strong>优点</strong></li>
</ul>
<p>不使用 <strong>第三方中间件</strong>，<strong>分区逻辑</strong> 可控，<strong>配置</strong> 简单，节点之间无关联，容易 <strong>线性扩展</strong>，灵活性强。</p>
<ul>
<li><strong>缺点</strong></li>
</ul>
<p><strong>客户端</strong> 无法 <strong>动态增删</strong> 服务节点，客户端需要自行维护 <strong>分发逻辑</strong>，客户端之间 <strong>无连接共享</strong>，会造成 <strong>连接浪费</strong>。</p>
<h3 id="1-2-代理分区方案"><a href="#1-2-代理分区方案" class="headerlink" title="1.2. 代理分区方案"></a>1.2. 代理分区方案</h3><p><strong>客户端</strong> 发送请求到一个 <strong>代理组件</strong>，<strong>代理</strong> 解析 <strong>客户端</strong> 的数据，并将请求转发至正确的节点，最后将结果回复给客户端。</p>
<ul>
<li><p><strong>优点</strong>：简化 <strong>客户端</strong> 的分布式逻辑，<strong>客户端</strong> 透明接入，切换成本低，代理的 <strong>转发</strong> 和 <strong>存储</strong> 分离。</p>
</li>
<li><p><strong>缺点</strong>：多了一层 <strong>代理层</strong>，加重了 <strong>架构部署复杂度</strong> 和 <strong>性能损耗</strong>。</p>
</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9e6f8b3a44?w=818&amp;h=519&amp;f=png&amp;s=28712" alt=""></p>
<p><strong>代理分区</strong> 主流实现的有方案有 <code>Twemproxy</code> 和 <code>Codis</code>。</p>
<h4 id="1-2-1-Twemproxy"><a href="#1-2-1-Twemproxy" class="headerlink" title="1.2.1. Twemproxy"></a>1.2.1. Twemproxy</h4><p><code>Twemproxy</code> 也叫 <code>nutcraker</code>，是 <code>twitter</code> 开源的一个 <code>redis</code> 和 <code>memcache</code> 的 <strong>中间代理服务器</strong> 程序。<code>Twemproxy</code> 作为 <strong>代理</strong>，可接受来自多个程序的访问，按照 <strong>路由规则</strong>，转发给后台的各个 <code>Redis</code> 服务器，再原路返回。<code>Twemproxy</code> 存在 <strong>单点故障</strong> 问题，需要结合 <code>Lvs</code> 和 <code>Keepalived</code> 做 <strong>高可用方案</strong>。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9e751d0773?w=1211&amp;h=622&amp;f=png&amp;s=77243" alt=""></p>
<ul>
<li><p><strong>优点</strong>：应用范围广，稳定性较高，中间代理层 <strong>高可用</strong>。</p>
</li>
<li><p><strong>缺点</strong>：无法平滑地 <strong>水平扩容/缩容</strong>，无 <strong>可视化管理界面</strong>，运维不友好，出现故障，不能 <strong>自动转移</strong>。</p>
</li>
</ul>
<h4 id="1-2-2-Codis"><a href="#1-2-2-Codis" class="headerlink" title="1.2.2. Codis"></a>1.2.2. Codis</h4><p><code>Codis</code> 是一个 <strong>分布式</strong> <code>Redis</code> 解决方案，对于上层应用来说，连接 <code>Codis-Proxy</code> 和直接连接 <strong>原生的</strong> <code>Redis-Server</code> 没有的区别。<code>Codis</code> 底层会 <strong>处理请求的转发</strong>，不停机的进行 <strong>数据迁移</strong> 等工作。<code>Codis</code> 采用了无状态的 <strong>代理层</strong>，对于 <strong>客户端</strong> 来说，一切都是透明的。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9e7509b300?w=1429&amp;h=987&amp;f=png&amp;s=63694" alt=""></p>
<ul>
<li><strong>优点</strong></li>
</ul>
<p>实现了上层 <code>Proxy</code> 和底层 <code>Redis</code> 的 <strong>高可用</strong>，<strong>数据分片</strong> 和 <strong>自动平衡</strong>，提供 <strong>命令行接口</strong> 和 <code>RESTful API</code>，提供 <strong>监控</strong> 和 <strong>管理</strong> 界面，可以动态 <strong>添加</strong> 和 <strong>删除</strong> <code>Redis</code> 节点。</p>
<ul>
<li><strong>缺点</strong></li>
</ul>
<p><strong>部署架构</strong> 和 <strong>配置</strong> 复杂，不支持 <strong>跨机房</strong> 和 <strong>多租户</strong>，不支持 <strong>鉴权管理</strong>。</p>
<h3 id="1-3-查询路由方案"><a href="#1-3-查询路由方案" class="headerlink" title="1.3. 查询路由方案"></a>1.3. 查询路由方案</h3><p><strong>客户端随机地</strong> 请求任意一个 <code>Redis</code> 实例，然后由 <code>Redis</code> 将请求 <strong>转发</strong> 给 <strong>正确</strong> 的 <code>Redis</code> 节点。<code>Redis Cluster</code> 实现了一种 <strong>混合形式</strong> 的 <strong>查询路由</strong>，但并不是 <strong>直接</strong> 将请求从一个 <code>Redis</code> 节点 <strong>转发</strong> 到另一个 <code>Redis</code> 节点，而是在 <strong>客户端</strong> 的帮助下直接 <strong>重定向</strong>（ <code>redirected</code>）到正确的 <code>Redis</code> 节点。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9e84b4b379?w=711&amp;h=761&amp;f=png&amp;s=70609" alt=""></p>
<ul>
<li><strong>优点</strong></li>
</ul>
<p><strong>无中心节点</strong>，数据按照 <strong>槽</strong> 存储分布在多个 <code>Redis</code> 实例上，可以平滑的进行节点 <strong>扩容/缩容</strong>，支持 <strong>高可用</strong> 和 <strong>自动故障转移</strong>，运维成本低。</p>
<ul>
<li><strong>缺点</strong></li>
</ul>
<p>严重依赖 <code>Redis-trib</code> 工具，缺乏 <strong>监控管理</strong>，需要依赖 <code>Smart Client</code> (<strong>维护连接</strong>，<strong>缓存路由表</strong>，<code>MultiOp</code> 和 <code>Pipeline</code> 支持)。<code>Failover</code> 节点的 <strong>检测过慢</strong>，不如 <strong>中心节点</strong> <code>ZooKeeper</code> 及时。<code>Gossip</code> 消息具有一定开销。无法根据统计区分 <strong>冷热数据</strong>。</p>
<h2 id="2-数据分布"><a href="#2-数据分布" class="headerlink" title="2. 数据分布"></a>2. 数据分布</h2><h3 id="2-1-数据分布理论"><a href="#2-1-数据分布理论" class="headerlink" title="2.1. 数据分布理论"></a>2.1. 数据分布理论</h3><p><strong>分布式数据库</strong> 首先要解决把 <strong>整个数据集</strong> 按照 <strong>分区规则</strong> 映射到 <strong>多个节点</strong> 的问题，即把 <strong>数据集</strong> 划分到 <strong>多个节点</strong> 上，每个节点负责 <strong>整体数据</strong> 的一个 <strong>子集</strong>。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9e75424f0a?w=849&amp;h=565&amp;f=png&amp;s=20637" alt=""></p>
<p>数据分布通常有 <strong>哈希分区</strong> 和 <strong>顺序分区</strong> 两种方式，对比如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">分区方式</th>
<th style="text-align:left">特点</th>
<th style="text-align:left">相关产品</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">哈希分区</td>
<td style="text-align:left">离散程度好，数据分布与业务无关，无法顺序访问</td>
<td style="text-align:left">Redis Cluster，Cassandra，Dynamo</td>
</tr>
<tr>
<td style="text-align:left">顺序分区</td>
<td style="text-align:left">离散程度易倾斜，数据分布与业务相关，可以顺序访问</td>
<td style="text-align:left">BigTable，HBase，Hypertable</td>
</tr>
</tbody>
</table>
<p>由于 <code>Redis Cluster</code> 采用 <strong>哈希分区规则</strong>，这里重点讨论 <strong>哈希分区</strong>。常见的 <strong>哈希分区</strong> 规则有几种，下面分别介绍：</p>
<h4 id="2-1-1-节点取余分区"><a href="#2-1-1-节点取余分区" class="headerlink" title="2.1.1. 节点取余分区"></a>2.1.1. 节点取余分区</h4><p>使用特定的数据，如 <code>Redis</code> 的 <strong>键</strong> 或 <strong>用户</strong> <code>ID</code>，再根据 <strong>节点数量</strong> <code>N</code> 使用公式：<code>hash（key）% N</code> 计算出 <strong>哈希值</strong>，用来决定数据 <strong>映射</strong> 到哪一个节点上。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9f1b14840d?w=908&amp;h=559&amp;f=png&amp;s=50894" alt=""></p>
<ul>
<li><strong>优点</strong></li>
</ul>
<p>这种方式的突出优点是 <strong>简单性</strong>，常用于 <strong>数据库</strong> 的 <strong>分库分表规则</strong>。一般采用 <strong>预分区</strong> 的方式，提前根据 <strong>数据量</strong> 规划好 <strong>分区数</strong>，比如划分为 <code>512</code> 或 <code>1024</code> 张表，保证可支撑未来一段时间的 <strong>数据容量</strong>，再根据 <strong>负载情况</strong> 将 <strong>表</strong> 迁移到其他 <strong>数据库</strong> 中。扩容时通常采用 <strong>翻倍扩容</strong>，避免 <strong>数据映射</strong> 全部被 <strong>打乱</strong>，导致 <strong>全量迁移</strong> 的情况。</p>
<ul>
<li><strong>缺点</strong></li>
</ul>
<p>当 <strong>节点数量</strong> 变化时，如 <strong>扩容</strong> 或 <strong>收缩</strong> 节点，数据节点 <strong>映射关系</strong> 需要重新计算，会导致数据的 <strong>重新迁移</strong>。</p>
<h4 id="2-1-2-一致性哈希分区"><a href="#2-1-2-一致性哈希分区" class="headerlink" title="2.1.2. 一致性哈希分区"></a>2.1.2. 一致性哈希分区</h4><p><strong>一致性哈希</strong> 可以很好的解决 <strong>稳定性问题</strong>，可以将所有的 <strong>存储节点</strong> 排列在 <strong>收尾相接</strong> 的 <code>Hash</code> 环上，每个 <code>key</code> 在计算 <code>Hash</code> 后会 <strong>顺时针</strong> 找到 <strong>临接</strong> 的 <strong>存储节点</strong> 存放。而当有节点 <strong>加入</strong> 或 <strong>退出</strong> 时，仅影响该节点在 <code>Hash</code> 环上 <strong>顺时针相邻</strong> 的 <strong>后续节点</strong>。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9f1b2a7661?w=1160&amp;h=781&amp;f=png&amp;s=65891" alt=""></p>
<ul>
<li><strong>优点</strong></li>
</ul>
<p><strong>加入</strong> 和 <strong>删除</strong> 节点只影响 <strong>哈希环</strong> 中 <strong>顺时针方向</strong> 的 <strong>相邻的节点</strong>，对其他节点无影响。</p>
<ul>
<li><strong>缺点</strong></li>
</ul>
<p><strong>加减节点</strong> 会造成 <strong>哈希环</strong> 中部分数据 <strong>无法命中</strong>。当使用 <strong>少量节点</strong> 时，<strong>节点变化</strong> 将大范围影响 <strong>哈希环</strong> 中 <strong>数据映射</strong>，不适合 <strong>少量数据节点</strong> 的分布式方案。<strong>普通</strong> 的 <strong>一致性哈希分区</strong> 在增减节点时需要 <strong>增加一倍</strong> 或 <strong>减去一半</strong> 节点才能保证 <strong>数据</strong> 和 <strong>负载的均衡</strong>。</p>
<blockquote>
<p><strong>注意</strong>：因为 <strong>一致性哈希分区</strong> 的这些缺点，一些分布式系统采用 <strong>虚拟槽</strong> 对 <strong>一致性哈希</strong> 进行改进，比如 <code>Dynamo</code> 系统。</p>
</blockquote>
<h4 id="2-1-3-虚拟槽分区"><a href="#2-1-3-虚拟槽分区" class="headerlink" title="2.1.3. 虚拟槽分区"></a>2.1.3. 虚拟槽分区</h4><p><strong>虚拟槽分区</strong> 巧妙地使用了 <strong>哈希空间</strong>，使用 <strong>分散度良好</strong> 的 <strong>哈希函数</strong> 把所有数据 <strong>映射</strong> 到一个 <strong>固定范围</strong> 的 <strong>整数集合</strong> 中，整数定义为 <strong>槽</strong>（<code>slot</code>）。这个范围一般 <strong>远远大于</strong> 节点数，比如 <code>Redis Cluster</code> 槽范围是 <code>0 ~ 16383</code>。<strong>槽</strong> 是集群内 <strong>数据管理</strong> 和 <strong>迁移</strong> 的 <strong>基本单位</strong>。采用 <strong>大范围槽</strong> 的主要目的是为了方便 <strong>数据拆分</strong> 和 <strong>集群扩展</strong>。每个节点会负责 <strong>一定数量的槽</strong>，如图所示：</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9f644d509a?w=507&amp;h=567&amp;f=png&amp;s=22499" alt=""></p>
<p>当前集群有 <code>5</code> 个节点，每个节点平均大约负责 <code>3276</code> 个 <strong>槽</strong>。由于采用 <strong>高质量</strong> 的 <strong>哈希算法</strong>，每个槽所映射的数据通常比较 <strong>均匀</strong>，将数据平均划分到 <code>5</code> 个节点进行 <strong>数据分区</strong>。<code>Redis Cluster</code> 就是采用 <strong>虚拟槽分区</strong>。</p>
<ul>
<li><strong>节点1</strong>： 包含 <code>0</code> 到 <code>3276</code> 号哈希槽。</li>
<li><strong>节点2</strong>：包含 <code>3277</code>  到 <code>6553</code> 号哈希槽。</li>
<li><strong>节点3</strong>：包含 <code>6554</code> 到 <code>9830</code> 号哈希槽。</li>
<li><strong>节点4</strong>：包含 <code>9831</code> 到 <code>13107</code> 号哈希槽。</li>
<li><strong>节点5</strong>：包含 <code>13108</code> 到 <code>16383</code> 号哈希槽。</li>
</ul>
<p>这种结构很容易 <strong>添加</strong> 或者 <strong>删除</strong> 节点。如果 <strong>增加</strong> 一个节点 <code>6</code>，就需要从节点 <code>1 ~ 5</code> 获得部分 <strong>槽</strong> 分配到节点 <code>6</code> 上。如果想 <strong>移除</strong> 节点 <code>1</code>，需要将节点 <code>1</code> 中的 <strong>槽</strong> 移到节点 <code>2 ~ 5</code> 上，然后将 <strong>没有任何槽</strong> 的节点 <code>1</code> 从集群中 <strong>移除</strong> 即可。</p>
<blockquote>
<p>由于从一个节点将 <strong>哈希槽</strong> 移动到另一个节点并不会 <strong>停止服务</strong>，所以无论 <strong>添加删除</strong> 或者 <strong>改变</strong> 某个节点的 <strong>哈希槽的数量</strong> 都不会造成 <strong>集群不可用</strong> 的状态.</p>
</blockquote>
<h3 id="2-2-Redis的数据分区"><a href="#2-2-Redis的数据分区" class="headerlink" title="2.2. Redis的数据分区"></a>2.2. Redis的数据分区</h3><p><code>Redis Cluster</code> 采用 <strong>虚拟槽分区</strong>，所有的 <strong>键</strong> 根据 <strong>哈希函数</strong> 映射到 <code>0~16383</code> 整数槽内，计算公式：<code>slot = CRC16（key）&amp; 16383</code>。每个节点负责维护一部分槽以及槽所映射的 <strong>键值数据</strong>，如图所示：</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/4/165a4f9f56a93231?w=763&amp;h=573&amp;f=png&amp;s=23603" alt=""></p>
<h4 id="2-2-1-Redis虚拟槽分区的特点"><a href="#2-2-1-Redis虚拟槽分区的特点" class="headerlink" title="2.2.1. Redis虚拟槽分区的特点"></a>2.2.1. Redis虚拟槽分区的特点</h4><ul>
<li><p>解耦 <strong>数据</strong> 和 <strong>节点</strong> 之间的关系，简化了节点 <strong>扩容</strong> 和 <strong>收缩</strong> 难度。</p>
</li>
<li><p><strong>节点自身</strong> 维护槽的 <strong>映射关系</strong>，不需要 <strong>客户端</strong> 或者 <strong>代理服务</strong> 维护 <strong>槽分区元数据</strong>。</p>
</li>
<li><p>支持 <strong>节点</strong>、<strong>槽</strong>、<strong>键</strong> 之间的 <strong>映射查询</strong>，用于 <strong>数据路由</strong>、<strong>在线伸缩</strong> 等场景。</p>
</li>
</ul>
<h3 id="2-3-Redis集群的功能限制"><a href="#2-3-Redis集群的功能限制" class="headerlink" title="2.3. Redis集群的功能限制"></a>2.3. Redis集群的功能限制</h3><p><code>Redis</code> 集群相对 <strong>单机</strong> 在功能上存在一些限制，需要 <strong>开发人员</strong> 提前了解，在使用时做好规避。</p>
<ul>
<li><code>key</code> <strong>批量操作</strong> 支持有限。</li>
</ul>
<p>类似 <code>mset</code>、<code>mget</code> 操作，目前只支持对具有相同 <code>slot</code> 值的 <code>key</code> 执行 <strong>批量操作</strong>。对于 <strong>映射为不同</strong> <code>slot</code> 值的 <code>key</code> 由于执行 <code>mget</code>、<code>mget</code> 等操作可能存在于多个节点上，因此不被支持。</p>
<ul>
<li><code>key</code> <strong>事务操作</strong> 支持有限。</li>
</ul>
<p>只支持 <strong>多</strong> <code>key</code> 在 <strong>同一节点上</strong> 的 <strong>事务操作</strong>，当多个 <code>key</code> 分布在 <strong>不同</strong> 的节点上时 <strong>无法</strong> 使用事务功能。</p>
<ul>
<li><code>key</code> 作为 <strong>数据分区</strong> 的最小粒度</li>
</ul>
<p>不能将一个 <strong>大的键值</strong> 对象如 <code>hash</code>、<code>list</code> 等映射到 <strong>不同的节点</strong>。</p>
<ul>
<li>不支持 <strong>多数据库空间</strong></li>
</ul>
<p><strong>单机</strong> 下的 <code>Redis</code> 可以支持 <code>16</code> 个数据库（<code>db0 ~ db15</code>），<strong>集群模式</strong> 下只能使用 <strong>一个</strong> 数据库空间，即 <code>db0</code>。</p>
<ul>
<li><strong>复制结构</strong> 只支持一层</li>
</ul>
<p><strong>从节点</strong> 只能复制 <strong>主节点</strong>，不支持 <strong>嵌套树状复制</strong> 结构。</p>
<h2 id="3-Redis集群搭建"><a href="#3-Redis集群搭建" class="headerlink" title="3. Redis集群搭建"></a>3. Redis集群搭建</h2><p><code>Redis-Cluster</code> 是 <code>Redis</code> 官方的一个 <strong>高可用</strong> 解决方案，<code>Cluster</code> 中的 <code>Redis</code> 共有 <code>2^14（16384）</code> 个 <code>slot</code> <strong>槽</strong>。创建 <code>Cluster</code> 后，<strong>槽</strong> 会 <strong>平均分配</strong> 到每个 <code>Redis</code> 节点上。</p>
<p>下面介绍一下本机启动 <code>6</code> 个 <code>Redis</code> 的 <strong>集群服务</strong>，并使用 <code>redis-trib.rb</code> 创建 <strong>3主3从</strong> 的 <strong>集群</strong>。搭建集群工作需要以下三个步骤：</p>
<h3 id="3-1-准备节点"><a href="#3-1-准备节点" class="headerlink" title="3.1. 准备节点"></a>3.1. 准备节点</h3><p><code>Redis</code> 集群一般由 <strong>多个节点</strong> 组成，节点数量至少为 <code>6</code> 个，才能保证组成 <strong>完整高可用</strong> 的集群。每个节点需要 <strong>开启配置</strong> <code>cluster-enabled yes</code>，让 <code>Redis</code> 运行在 <strong>集群模式</strong> 下。</p>
<p><code>Redis</code> 集群的节点规划如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">节点名称</th>
<th style="text-align:left">端口号</th>
<th style="text-align:left">是主是从</th>
<th>所属主节点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">redis-6379</td>
<td style="text-align:left">6379</td>
<td style="text-align:left">主节点</td>
<td>—</td>
</tr>
<tr>
<td style="text-align:left">redis-6389</td>
<td style="text-align:left">6389</td>
<td style="text-align:left">从节点</td>
<td>redis-6379</td>
</tr>
<tr>
<td style="text-align:left">redis-6380</td>
<td style="text-align:left">6380</td>
<td style="text-align:left">主节点</td>
<td>—</td>
</tr>
<tr>
<td style="text-align:left">redis-6390</td>
<td style="text-align:left">6390</td>
<td style="text-align:left">从节点</td>
<td>redis-6380</td>
</tr>
<tr>
<td style="text-align:left">redis-6381</td>
<td style="text-align:left">6381</td>
<td style="text-align:left">主节点</td>
<td>—</td>
</tr>
<tr>
<td style="text-align:left">redis-6391</td>
<td style="text-align:left">6391</td>
<td style="text-align:left">从节点</td>
<td>redis-6381</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意</strong>：建议为集群内 <strong>所有节点</strong> 统一目录，一般划分三个目录：<code>conf</code>、<code>data</code>、<code>log</code>，分别存放 <strong>配置</strong>、<strong>数据</strong> 和 <strong>日志</strong> 相关文件。把 <code>6</code> 个节点配置统一放在 <code>conf</code> 目录下。</p>
</blockquote>
<h4 id="3-1-1-创建redis各实例目录"><a href="#3-1-1-创建redis各实例目录" class="headerlink" title="3.1.1. 创建redis各实例目录"></a>3.1.1. 创建redis各实例目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir -p /usr/<span class="built_in">local</span>/redis-cluster</span><br><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/redis-cluster</span><br><span class="line">$ sudo mkdir conf data <span class="built_in">log</span></span><br><span class="line">$ sudo mkdir -p data/redis-6379 data/redis-6389 data/redis-6380 data/redis-6390 data/redis-6381 data/redis-6391</span><br></pre></td></tr></table></figure>
<h4 id="3-1-2-redis配置文件管理"><a href="#3-1-2-redis配置文件管理" class="headerlink" title="3.1.2. redis配置文件管理"></a>3.1.2. redis配置文件管理</h4><p>根据以下 <strong>模板</strong> 配置各个实例的 <code>redis.conf</code>，以下只是搭建集群需要的 <strong>基本配置</strong>，可能需要根据实际情况做修改。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis后台运行</span></span><br><span class="line">daemonize yes</span><br><span class="line"><span class="comment"># 绑定的主机端口</span></span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1</span><br><span class="line"><span class="comment"># 数据存放目录</span></span><br><span class="line">dir /usr/<span class="built_in">local</span>/redis-cluster/data/redis-6379</span><br><span class="line"><span class="comment"># 进程文件</span></span><br><span class="line">pidfile /var/run/redis-cluster/<span class="variable">$&#123;自定义&#125;</span>.pid</span><br><span class="line"><span class="comment"># 日志文件</span></span><br><span class="line">logfile /usr/<span class="built_in">local</span>/redis-cluster/<span class="built_in">log</span>/<span class="variable">$&#123;自定义&#125;</span>.<span class="built_in">log</span></span><br><span class="line"><span class="comment"># 端口号</span></span><br><span class="line">port 6379</span><br><span class="line"><span class="comment"># 开启集群模式，把注释#去掉</span></span><br><span class="line">cluster-enabled yes</span><br><span class="line"><span class="comment"># 集群的配置，配置文件首次启动自动生成</span></span><br><span class="line">cluster-config-file /usr/<span class="built_in">local</span>/redis-cluster/conf/<span class="variable">$&#123;自定义&#125;</span>.conf</span><br><span class="line"><span class="comment"># 请求超时，设置10秒</span></span><br><span class="line">cluster-node-timeout 10000</span><br><span class="line"><span class="comment"># aof日志开启，有需要就开启，它会每次写操作都记录一条日志</span></span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>redis-6379.conf</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1</span><br><span class="line">dir /usr/<span class="built_in">local</span>/redis-cluster/data/redis-6379</span><br><span class="line">pidfile /var/run/redis-cluster/redis-6379.pid</span><br><span class="line">logfile /usr/<span class="built_in">local</span>/redis-cluster/<span class="built_in">log</span>/redis-6379.log</span><br><span class="line">port 6379</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file /usr/<span class="built_in">local</span>/redis-cluster/conf/node-6379.conf</span><br><span class="line">cluster-node-timeout 10000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>redis-6389.conf</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1</span><br><span class="line">dir /usr/<span class="built_in">local</span>/redis-cluster/data/redis-6389</span><br><span class="line">pidfile /var/run/redis-cluster/redis-6389.pid</span><br><span class="line">logfile /usr/<span class="built_in">local</span>/redis-cluster/<span class="built_in">log</span>/redis-6389.log</span><br><span class="line">port 6389</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file /usr/<span class="built_in">local</span>/redis-cluster/conf/node-6389.conf</span><br><span class="line">cluster-node-timeout 10000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>redis-6380.conf</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1</span><br><span class="line">dir /usr/<span class="built_in">local</span>/redis-cluster/data/redis-6380</span><br><span class="line">pidfile /var/run/redis-cluster/redis-6380.pid</span><br><span class="line">logfile /usr/<span class="built_in">local</span>/redis-cluster/<span class="built_in">log</span>/redis-6380.log</span><br><span class="line">port 6380</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file /usr/<span class="built_in">local</span>/redis-cluster/conf/node-6380.conf</span><br><span class="line">cluster-node-timeout 10000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>redis-6390.conf</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1</span><br><span class="line">dir /usr/<span class="built_in">local</span>/redis-cluster/data/redis-6390</span><br><span class="line">pidfile /var/run/redis-cluster/redis-6390.pid</span><br><span class="line">logfile /usr/<span class="built_in">local</span>/redis-cluster/<span class="built_in">log</span>/redis-6390.log</span><br><span class="line">port 6390</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file /usr/<span class="built_in">local</span>/redis-cluster/conf/node-6390.conf</span><br><span class="line">cluster-node-timeout 10000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>redis-6381.conf</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1</span><br><span class="line">dir /usr/<span class="built_in">local</span>/redis-cluster/data/redis-6381</span><br><span class="line">pidfile /var/run/redis-cluster/redis-6381.pid</span><br><span class="line">logfile /usr/<span class="built_in">local</span>/redis-cluster/<span class="built_in">log</span>/redis-6381.log</span><br><span class="line">port 6381</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file /usr/<span class="built_in">local</span>/redis-cluster/conf/node-6381.conf</span><br><span class="line">cluster-node-timeout 10000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>redis-6391.conf</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1</span><br><span class="line">dir /usr/<span class="built_in">local</span>/redis-cluster/data/redis-6391</span><br><span class="line">pidfile /var/run/redis-cluster/redis-6391.pid</span><br><span class="line">logfile /usr/<span class="built_in">local</span>/redis-cluster/<span class="built_in">log</span>/redis-6391.log</span><br><span class="line">port 6391</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file /usr/<span class="built_in">local</span>/redis-cluster/conf/node-6391.conf</span><br><span class="line">cluster-node-timeout 10000</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>
<h3 id="3-2-环境准备"><a href="#3-2-环境准备" class="headerlink" title="3.2. 环境准备"></a>3.2. 环境准备</h3><h4 id="3-2-1-安装Ruby环境"><a href="#3-2-1-安装Ruby环境" class="headerlink" title="3.2.1. 安装Ruby环境"></a>3.2.1. 安装Ruby环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo brew install ruby</span><br></pre></td></tr></table></figure>
<h4 id="3-2-2-准备rubygem-redis依赖"><a href="#3-2-2-准备rubygem-redis依赖" class="headerlink" title="3.2.2. 准备rubygem redis依赖"></a>3.2.2. 准备rubygem redis依赖</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo gem install redis</span><br><span class="line">Password:</span><br><span class="line">Fetching: redis-4.0.2.gem (100%)</span><br><span class="line">Successfully installed redis-4.0.2</span><br><span class="line">Parsing documentation <span class="keyword">for</span> redis-4.0.2</span><br><span class="line">Installing ri documentation <span class="keyword">for</span> redis-4.0.2</span><br><span class="line">Done installing documentation <span class="keyword">for</span> redis after 1 seconds</span><br><span class="line">1 gem installed</span><br></pre></td></tr></table></figure>
<h4 id="3-2-3-拷贝redis-trib-rb到集群根目录"><a href="#3-2-3-拷贝redis-trib-rb到集群根目录" class="headerlink" title="3.2.3. 拷贝redis-trib.rb到集群根目录"></a>3.2.3. 拷贝redis-trib.rb到集群根目录</h4><p><code>redis-trib.rb</code> 是 <code>redis</code> 官方推出的管理 <code>redis</code> <strong>集群</strong> 的工具，集成在 <code>redis</code> 的源码 <code>src</code> 目录下，将基于 <code>redis</code> 提供的 <strong>集群命令</strong> 封装成 <strong>简单</strong>、<strong>便捷</strong>、<strong>实用</strong> 的 <strong>操作工具</strong>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp /usr/<span class="built_in">local</span>/redis-4.0.11/src/redis-trib.rb /usr/<span class="built_in">local</span>/redis-cluster</span><br></pre></td></tr></table></figure>
<p>查看 <code>redis-trib.rb</code> 命令环境是否正确，输出如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ ./redis-trib.rb </span><br><span class="line">Usage: redis-trib &lt;<span class="built_in">command</span>&gt; &lt;options&gt; &lt;arguments ...&gt;</span><br><span class="line"></span><br><span class="line">  create          host1:port1 ... hostN:portN</span><br><span class="line">                  --replicas &lt;arg&gt;</span><br><span class="line">  check           host:port</span><br><span class="line">  info            host:port</span><br><span class="line">  fix             host:port</span><br><span class="line">                  --timeout &lt;arg&gt;</span><br><span class="line">  reshard         host:port</span><br><span class="line">                  --from &lt;arg&gt;</span><br><span class="line">                  --to &lt;arg&gt;</span><br><span class="line">                  --slots &lt;arg&gt;</span><br><span class="line">                  --yes</span><br><span class="line">                  --timeout &lt;arg&gt;</span><br><span class="line">                  --pipeline &lt;arg&gt;</span><br><span class="line">  rebalance       host:port</span><br><span class="line">                  --weight &lt;arg&gt;</span><br><span class="line">                  --auto-weights</span><br><span class="line">                  --use-empty-masters</span><br><span class="line">                  --timeout &lt;arg&gt;</span><br><span class="line">                  --simulate</span><br><span class="line">                  --pipeline &lt;arg&gt;</span><br><span class="line">                  --threshold &lt;arg&gt;</span><br><span class="line">  add-node        new_host:new_port existing_host:existing_port</span><br><span class="line">                  --slave</span><br><span class="line">                  --master-id &lt;arg&gt;</span><br><span class="line">  del-node        host:port node_id</span><br><span class="line">  <span class="built_in">set</span>-timeout     host:port milliseconds</span><br><span class="line">  call            host:port <span class="built_in">command</span> arg arg .. arg</span><br><span class="line">  import          host:port</span><br><span class="line">                  --from &lt;arg&gt;</span><br><span class="line">                  --copy</span><br><span class="line">                  --replace</span><br><span class="line">  <span class="built_in">help</span>            (show this <span class="built_in">help</span>)</span><br><span class="line"></span><br><span class="line">For check, fix, reshard, del-node, <span class="built_in">set</span>-timeout you can specify the host and port of any working node <span class="keyword">in</span> the cluster.</span><br></pre></td></tr></table></figure>
<p><code>redis-trib.rb</code> 是 <code>redis</code> 作者用 <code>ruby</code> 完成的。<code>redis-trib.rb</code> <strong>命令行工具</strong> 的具体功能如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">create</td>
<td style="text-align:left">创建集群</td>
</tr>
<tr>
<td style="text-align:left">check</td>
<td style="text-align:left">检查集群</td>
</tr>
<tr>
<td style="text-align:left">info</td>
<td style="text-align:left">查看集群信息</td>
</tr>
<tr>
<td style="text-align:left">fix</td>
<td style="text-align:left">修复集群</td>
</tr>
<tr>
<td style="text-align:left">reshard</td>
<td style="text-align:left">在线迁移slot</td>
</tr>
<tr>
<td style="text-align:left">rebalance</td>
<td style="text-align:left">平衡集群节点slot数量</td>
</tr>
<tr>
<td style="text-align:left">add-node</td>
<td style="text-align:left">将新节点加入集群</td>
</tr>
<tr>
<td style="text-align:left">del-node</td>
<td style="text-align:left">从集群中删除节点</td>
</tr>
<tr>
<td style="text-align:left">set-timeout</td>
<td style="text-align:left">设置集群节点间心跳连接的超时时间</td>
</tr>
<tr>
<td style="text-align:left">call</td>
<td style="text-align:left">在集群全部节点上执行命令</td>
</tr>
<tr>
<td style="text-align:left">import</td>
<td style="text-align:left">将外部redis数据导入集群</td>
</tr>
</tbody>
</table>
<h3 id="3-3-安装集群"><a href="#3-3-安装集群" class="headerlink" title="3.3. 安装集群"></a>3.3. 安装集群</h3><h4 id="3-3-1-启动redis服务节点"><a href="#3-3-1-启动redis服务节点" class="headerlink" title="3.3.1. 启动redis服务节点"></a>3.3.1. 启动redis服务节点</h4><p>运行如下命令启动 <code>6</code> 台 <code>redis</code> 节点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo redis-server conf/redis-6379.conf</span><br><span class="line">sudo redis-server conf/redis-6389.conf</span><br><span class="line">sudo redis-server conf/redis-6380.conf</span><br><span class="line">sudo redis-server conf/redis-6390.conf</span><br><span class="line">sudo redis-server conf/redis-6381.conf</span><br><span class="line">sudo redis-server conf/redis-6391.conf</span><br></pre></td></tr></table></figure>
<p>启动完成后，<code>redis</code> 以集群模式启动，查看各个 <code>redis</code> 节点的进程状态：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | grep redis-server</span><br><span class="line">    0  1908     1   0  4:59下午 ??         0:00.01 redis-server *:6379 [cluster] </span><br><span class="line">    0  1911     1   0  4:59下午 ??         0:00.01 redis-server *:6389 [cluster] </span><br><span class="line">    0  1914     1   0  4:59下午 ??         0:00.01 redis-server *:6380 [cluster] </span><br><span class="line">    0  1917     1   0  4:59下午 ??         0:00.01 redis-server *:6390 [cluster] </span><br><span class="line">    0  1920     1   0  4:59下午 ??         0:00.01 redis-server *:6381 [cluster] </span><br><span class="line">    0  1923     1   0  4:59下午 ??         0:00.01 redis-server *:6391 [cluster]</span><br></pre></td></tr></table></figure>
<p>在每个 <code>redis</code> 节点的 <code>redis.conf</code> 文件中，我们都配置了 <code>cluster-config-file</code> 的文件路径，集群启动时，<code>conf</code> 目录会新生成 <strong>集群</strong> 节点配置文件。查看文件列表如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ tree -L 3 .</span><br><span class="line">.</span><br><span class="line">├── appendonly.aof</span><br><span class="line">├── conf</span><br><span class="line">│   ├── node-6379.conf</span><br><span class="line">│   ├── node-6380.conf</span><br><span class="line">│   ├── node-6381.conf</span><br><span class="line">│   ├── node-6389.conf</span><br><span class="line">│   ├── node-6390.conf</span><br><span class="line">│   ├── node-6391.conf</span><br><span class="line">│   ├── redis-6379.conf</span><br><span class="line">│   ├── redis-6380.conf</span><br><span class="line">│   ├── redis-6381.conf</span><br><span class="line">│   ├── redis-6389.conf</span><br><span class="line">│   ├── redis-6390.conf</span><br><span class="line">│   └── redis-6391.conf</span><br><span class="line">├── data</span><br><span class="line">│   ├── redis-6379</span><br><span class="line">│   ├── redis-6380</span><br><span class="line">│   ├── redis-6381</span><br><span class="line">│   ├── redis-6389</span><br><span class="line">│   ├── redis-6390</span><br><span class="line">│   └── redis-6391</span><br><span class="line">├── <span class="built_in">log</span></span><br><span class="line">│   ├── redis-6379.log</span><br><span class="line">│   ├── redis-6380.log</span><br><span class="line">│   ├── redis-6381.log</span><br><span class="line">│   ├── redis-6389.log</span><br><span class="line">│   ├── redis-6390.log</span><br><span class="line">│   └── redis-6391.log</span><br><span class="line">└── redis-trib.rb</span><br><span class="line"></span><br><span class="line">9 directories, 20 files</span><br></pre></td></tr></table></figure>
<h4 id="3-3-2-redis-trib关联集群节点"><a href="#3-3-2-redis-trib关联集群节点" class="headerlink" title="3.3.2. redis-trib关联集群节点"></a>3.3.2. redis-trib关联集群节点</h4><p>按照 <strong>从主到从</strong> 的方式 <strong>从左到右</strong> 依次排列 <code>6</code> 个 <code>redis</code> 节点。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ./redis-trib.rb create --replicas 1 127.0.0.1:6379 127.0.0.1:6380 127.0.0.1:6381 127.0.0.1:6389 127.0.0.1:6390 127.0.0.1:6391</span><br></pre></td></tr></table></figure>
<p>集群创建后，<code>redis-trib</code> 会先将 <code>16384</code> 个 <strong>哈希槽</strong> 分配到 <code>3</code> 个 <strong>主节点</strong>，即 <code>redis-6379</code>，<code>redis-6380</code> 和 <code>redis-6381</code>。然后将各个 <strong>从节点</strong> 指向 <strong>主节点</strong>，进行 <strong>数据同步</strong>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Creating cluster</span><br><span class="line">&gt;&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span><br><span class="line">Using 3 masters:</span><br><span class="line">127.0.0.1:6379</span><br><span class="line">127.0.0.1:6380</span><br><span class="line">127.0.0.1:6381</span><br><span class="line">Adding replica 127.0.0.1:6390 to 127.0.0.1:6379</span><br><span class="line">Adding replica 127.0.0.1:6391 to 127.0.0.1:6380</span><br><span class="line">Adding replica 127.0.0.1:6389 to 127.0.0.1:6381</span><br><span class="line">&gt;&gt;&gt; Trying to optimize slaves allocation <span class="keyword">for</span> anti-affinity</span><br><span class="line">[WARNING] Some slaves are <span class="keyword">in</span> the same host as their master</span><br><span class="line">M: ad4b9ffceba062492ed67ab336657426f55874b7 127.0.0.1:6379</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">M: df23c6cad0654ba83f0422e352a81ecee822702e 127.0.0.1:6380</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">M: ab9da92d37125f24fe60f1f33688b4f8644612ee 127.0.0.1:6381</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">S: 25cfa11a2b4666021da5380ff332b80dbda97208 127.0.0.1:6389</span><br><span class="line">   replicates ad4b9ffceba062492ed67ab336657426f55874b7</span><br><span class="line">S: 48e0a4b539867e01c66172415d94d748933be173 127.0.0.1:6390</span><br><span class="line">   replicates df23c6cad0654ba83f0422e352a81ecee822702e</span><br><span class="line">S: d881142a8307f89ba51835734b27cb309a0fe855 127.0.0.1:6391</span><br><span class="line">   replicates ab9da92d37125f24fe60f1f33688b4f8644612ee</span><br></pre></td></tr></table></figure>
<p>然后输入 <code>yes</code>，<code>redis-trib.rb</code> 开始执行 <strong>节点握手</strong> 和 <strong>槽分配</strong> 操作，输出如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Can I <span class="built_in">set</span> the above configuration? (<span class="built_in">type</span> <span class="string">'yes'</span> to accept): yes</span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span><br><span class="line">Waiting <span class="keyword">for</span> the cluster to join....</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 127.0.0.1:6379)</span><br><span class="line">M: ad4b9ffceba062492ed67ab336657426f55874b7 127.0.0.1:6379</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: ab9da92d37125f24fe60f1f33688b4f8644612ee 127.0.0.1:6381</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 48e0a4b539867e01c66172415d94d748933be173 127.0.0.1:6390</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates df23c6cad0654ba83f0422e352a81ecee822702e</span><br><span class="line">S: d881142a8307f89ba51835734b27cb309a0fe855 127.0.0.1:6391</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates ab9da92d37125f24fe60f1f33688b4f8644612ee</span><br><span class="line">M: df23c6cad0654ba83f0422e352a81ecee822702e 127.0.0.1:6380</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 25cfa11a2b4666021da5380ff332b80dbda97208 127.0.0.1:6389</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates ad4b9ffceba062492ed67ab336657426f55874b7</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>
<p>执行 <strong>集群检查</strong>，检查各个 <code>redis</code> 节点占用的 <strong>哈希槽</strong>（<code>slot</code>）的个数以及 <code>slot</code> <strong>覆盖率</strong>。<code>16384</code> 个槽位中，<strong>主节点</strong> <code>redis-6379</code>、<code>redis-6380</code> 和 <code>redis-6381</code> 分别占用了 <code>5461</code>、<code>5461</code> 和 <code>5462</code> 个槽位。</p>
<h4 id="3-3-3-redis主节点的日志"><a href="#3-3-3-redis主节点的日志" class="headerlink" title="3.3.3. redis主节点的日志"></a>3.3.3. redis主节点的日志</h4><p>可以发现，通过 <code>BGSAVE</code> 命令，<strong>从节点</strong> <code>redis-6389</code> 在 <strong>后台</strong> 异步地从 <strong>主节点</strong> <code>redis-6379</code> 同步数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ cat <span class="built_in">log</span>/redis-6379.log </span><br><span class="line">1907:C 05 Sep 16:59:52.960 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">1907:C 05 Sep 16:59:52.961 <span class="comment"># Redis version=4.0.11, bits=64, commit=00000000, modified=0, pid=1907, just started</span></span><br><span class="line">1907:C 05 Sep 16:59:52.961 <span class="comment"># Configuration loaded</span></span><br><span class="line">1908:M 05 Sep 16:59:52.964 * Increased maximum number of open files to 10032 (it was originally <span class="built_in">set</span> to 256).</span><br><span class="line">1908:M 05 Sep 16:59:52.965 * No cluster configuration found, I<span class="string">'m ad4b9ffceba062492ed67ab336657426f55874b7</span></span><br><span class="line"><span class="string">1908:M 05 Sep 16:59:52.967 * Running mode=cluster, port=6379.</span></span><br><span class="line"><span class="string">1908:M 05 Sep 16:59:52.967 # Server initialized</span></span><br><span class="line"><span class="string">1908:M 05 Sep 16:59:52.967 * Ready to accept connections</span></span><br><span class="line"><span class="string">1908:M 05 Sep 17:01:17.782 # configEpoch set to 1 via CLUSTER SET-CONFIG-EPOCH</span></span><br><span class="line"><span class="string">1908:M 05 Sep 17:01:17.812 # IP address for this node updated to 127.0.0.1</span></span><br><span class="line"><span class="string">1908:M 05 Sep 17:01:22.740 # Cluster state changed: ok</span></span><br><span class="line"><span class="string">1908:M 05 Sep 17:01:23.681 * Slave 127.0.0.1:6389 asks for synchronization</span></span><br><span class="line"><span class="string">1908:M 05 Sep 17:01:23.681 * Partial resynchronization not accepted: Replication ID mismatch (Slave asked for '</span>4c5afe96cac51cde56039f96383ea7217ef2af41<span class="string">', my replication IDs are '</span>037b661bf48c80c577d1fa937ba55367a3692921<span class="string">' and '</span>0000000000000000000000000000000000000000<span class="string">')</span></span><br><span class="line"><span class="string">1908:M 05 Sep 17:01:23.681 * Starting BGSAVE for SYNC with target: disk</span></span><br><span class="line"><span class="string">1908:M 05 Sep 17:01:23.682 * Background saving started by pid 1952</span></span><br><span class="line"><span class="string">1952:C 05 Sep 17:01:23.683 * DB saved on disk</span></span><br><span class="line"><span class="string">1908:M 05 Sep 17:01:23.749 * Background saving terminated with success</span></span><br><span class="line"><span class="string">1908:M 05 Sep 17:01:23.752 * Synchronization with slave 127.0.0.1:6389 succeeded</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-4-redis集群完整性检测"><a href="#3-3-4-redis集群完整性检测" class="headerlink" title="3.3.4. redis集群完整性检测"></a>3.3.4. redis集群完整性检测</h4><p>使用 <code>redis-trib.rb check</code> 命令检测之前创建的 <strong>两个集群</strong> 是否成功，<code>check</code> 命令只需要给出集群中 <strong>任意一个节点地址</strong> 就可以完成 <strong>整个集群</strong> 的 <strong>检查工作</strong>，命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./redis-trib.rb check 127.0.0.1:6379</span><br></pre></td></tr></table></figure>
<p>当最后输出如下信息，提示集群 <strong>所有的槽</strong> 都已分配到节点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>本文介绍了 <code>Redis</code> <strong>集群解决方案</strong>，<strong>数据分布</strong> 和 <strong>集群搭建</strong>。集群方案包括 <strong>客户端分区</strong> 方案，<strong>代理分区</strong> 方案 和 <strong>查询路由</strong> 方案。<strong>数据分布</strong> 部分简单地对 <strong>节点取余</strong> 分区，<strong>一致性哈希</strong> 分区以及 <strong>虚拟槽</strong> 分区进行了阐述和对比。最后对使用 <code>Redis-trib</code> 搭建了一个 <strong>三主三从</strong> 的 <strong>虚拟槽</strong> 集群示例。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>《Redis 开发与运维》</p>
<hr>
<p>欢迎关注技术公众号： 零壹技术栈</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/7/1/16455ec5dcc40392?w=258&amp;h=258&amp;f=jpeg&amp;s=16109" alt="零壹技术栈"></p>
<p>本帐号将持续分享后端技术干货，包括虚拟机基础，多线程编程，高性能框架，异步、缓存和消息中间件，分布式和微服务，架构学习和进阶等学习资料和文章。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



    <div class="a2a_kit a2a_default_style">
    <a class="a2a_dd" href="https://www.addtoany.com/share">Share</a>
    <span class="a2a_divider"></span>
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_google_plus"></a>
    <a class="a2a_button_pinterest"></a>
    <a class="a2a_button_tumblr"></a>
</div>
<script type="text/javascript" src="//static.addtoany.com/menu/page.js"></script>
<style>
    .a2a_menu {
        border-radius: 4px;
    }
    .a2a_menu a {
        margin: 2px 0;
        font-size: 14px;
        line-height: 16px;
        border-radius: 4px;
        color: inherit !important;
        font-family: 'Microsoft Yahei';
    }
    #a2apage_dropdown {
        margin: 10px 0;
    }
    .a2a_mini_services {
        padding: 10px;
    }
    a.a2a_i,
    i.a2a_i {
        width: 122px;
        line-height: 16px;
    }
    a.a2a_i .a2a_svg,
    a.a2a_more .a2a_svg {
        width: 16px;
        height: 16px;
        line-height: 16px;
        vertical-align: top;
        background-size: 16px;
    }
    a.a2a_i {
        border: none !important;
    }
    a.a2a_menu_show_more_less {
        margin: 0;
        padding: 10px 0;
        line-height: 16px;
    }
    .a2a_mini_services:after{content:".";display:block;height:0;clear:both;visibility:hidden}
    .a2a_mini_services{*+height:1%;}
</style>

</div>

            
    
        <a href="https://ostenant.coding.me/2018/08/29/深入剖析Redis系列(三) - Redis集群模式搭建与原理详解/#comments" class="article-comment-link">评论</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
    
        <a href="/2018/08/26/浅谈常见的NoSQL技术方案和选型/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">浅谈常见的NoSQL技术方案和选型</div>
        </a>
    
</nav>


    
</article>


    
    
        <section id="comments">
    <div id="lv-container" data-id="city" data-uid=MTAyMC8zNzE2NC8xMzY5OA==></div>
</section>
    

</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Redis学习系列/">Redis学习系列</a></p>
                            <p class="item-title"><a href="/2018/08/29/深入剖析Redis系列(三) - Redis集群模式搭建与原理详解/" class="title">深入剖析Redis系列(三) - Redis集群模式搭建与原理详解</a></p>
                            <p class="item-date"><time datetime="2018-08-29T13:47:00.000Z" itemprop="datePublished">2018-08-29</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/NoSQL技术选型系列/">NoSQL技术选型系列</a></p>
                            <p class="item-title"><a href="/2018/08/26/浅谈常见的NoSQL技术方案和选型/" class="title">浅谈常见的NoSQL技术方案和选型</a></p>
                            <p class="item-date"><time datetime="2018-08-26T15:19:00.000Z" itemprop="datePublished">2018-08-26</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Redis学习系列/">Redis学习系列</a></p>
                            <p class="item-title"><a href="/2018/08/17/深入剖析Redis系列(二) - Redis哨兵模式与高可用集群/" class="title">深入剖析Redis系列(二) - Redis哨兵模式与高可用集群</a></p>
                            <p class="item-date"><time datetime="2018-08-17T15:02:00.000Z" itemprop="datePublished">2018-08-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Redis学习系列/">Redis学习系列</a></p>
                            <p class="item-title"><a href="/2018/08/16/深入剖析Redis系列(一) - Redis入门简介与主从搭建/" class="title">深入剖析Redis系列(一) - Redis入门简介与主从搭建</a></p>
                            <p class="item-date"><time datetime="2018-08-16T05:36:00.000Z" itemprop="datePublished">2018-08-16</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/JAVA虚拟机系列/">JAVA虚拟机系列</a></p>
                            <p class="item-title"><a href="/2018/08/06/JVM系列(七) - JVM线上监控工具/" class="title">JVM系列(七) - JVM线上监控工具</a></p>
                            <p class="item-date"><time datetime="2018-08-06T07:21:00.000Z" itemprop="datePublished">2018-08-06</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker学习系列/">Docker学习系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA编程基础系列/">JAVA编程基础系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA编程进阶系列/">JAVA编程进阶系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA虚拟机系列/">JAVA虚拟机系列</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA设计模式系列/">JAVA设计模式系列</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JDK1-8编程系列/">JDK1.8编程系列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java编程进阶系列/">Java编程进阶系列</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL学习系列/">MySQL学习系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NoSQL技术选型系列/">NoSQL技术选型系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RPC通信框架系列/">RPC通信框架系列</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis学习系列/">Redis学习系列</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RxJava异步框架系列/">RxJava异步框架系列</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Reactive编程系列/">Spring Reactive编程系列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/任务调度框架系列/">任务调度框架系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式系列/">分布式系列</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/加密算法系列/">加密算法系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/实战Spring-Boot-2-0系列/">实战Spring Boot 2.0系列</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微服务系列/">微服务系列</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术知识图谱/">技术知识图谱</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构学习系列/">架构学习系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/测试框架系列/">测试框架系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/消息队列系列/">消息队列系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络协议系列/">网络协议系列</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/认证与授权系列/">认证与授权系列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/高并发系统系列/">高并发系统系列</a><span class="category-list-count">2</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/2PC/">2PC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/3PC/">3PC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AES/">AES</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ActiveMQ/">ActiveMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Adapter/">Adapter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/">Apache</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BASE/">BASE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Builder/">Builder</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAP/">CAP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CentOS/">CentOS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Codis/">Codis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Consul/">Consul</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Consul-template/">Consul-template</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DES/">DES</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker-Compose/">Docker Compose</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Filter/">Filter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTPS/">HTTPS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Interceptor/">Interceptor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK/">JDK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK1-8/">JDK1.8</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT/">JWT</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K-V数据库/">K-V数据库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/">Kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Listener/">Listener</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MD5/">MD5</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mockito/">Mockito</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NIO/">NIO</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NoSQL/">NoSQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth/">OAuth</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth-2-0/">OAuth 2.0</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Paxos/">Paxos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Prototype/">Prototype</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Quartz/">Quartz</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPC/">RPC</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RSA/">RSA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/">RabbitMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raft/">Raft</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reactive-Streams/">Reactive Streams</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reactor/">Reactor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis-Cluster/">Redis Cluster</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis-Sentinel/">Redis Sentinel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reference/">Reference</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Registrator/">Registrator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RocketMQ/">RocketMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxJava/">RxJava</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SAML/">SAML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SHA1/">SHA1</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SOFA-Boot/">SOFA-Boot</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SOFA-RPC/">SOFA-RPC</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSO/">SSO</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ScheduledExecutorService/">ScheduledExecutorService</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Servlet/">Servlet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Session/">Session</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Singleton/">Singleton</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Boot-2-0/">Spring Boot 2.0</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Cloud/">Spring Cloud</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Task/">Spring Task</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-WebFlux/">Spring WebFlux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thrift/">Thrift</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Timer/">Timer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TwemProxy/">TwemProxy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unique-ID/">Unique ID</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/">Web</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/">WebSocket</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/一致性哈希/">一致性哈希</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/主从复制/">主从复制</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/全文搜索/">全文搜索</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式存储/">分布式存储</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分片/">分片</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/列存储/">列存储</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/动态扩容/">动态扩容</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/反向代理/">反向代理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/反模式/">反模式</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/图形数据库/">图形数据库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/定时任务/">定时任务</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/异步/">异步</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微服务/">微服务</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文档数据库/">文档数据库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/服务器/">服务器</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/消息队列/">消息队列</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/行存储/">行存储</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/负载均衡/">负载均衡</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/限流/">限流</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高可用/">高可用</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高并发/">高并发</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高性能/">高性能</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/2PC/" style="font-size: 10px;">2PC</a> <a href="/tags/3PC/" style="font-size: 10px;">3PC</a> <a href="/tags/AES/" style="font-size: 10px;">AES</a> <a href="/tags/ActiveMQ/" style="font-size: 10px;">ActiveMQ</a> <a href="/tags/Adapter/" style="font-size: 10px;">Adapter</a> <a href="/tags/Android/" style="font-size: 12.86px;">Android</a> <a href="/tags/Apache/" style="font-size: 12.86px;">Apache</a> <a href="/tags/BASE/" style="font-size: 10px;">BASE</a> <a href="/tags/Builder/" style="font-size: 10px;">Builder</a> <a href="/tags/CAP/" style="font-size: 10px;">CAP</a> <a href="/tags/CentOS/" style="font-size: 10px;">CentOS</a> <a href="/tags/Codis/" style="font-size: 10px;">Codis</a> <a href="/tags/Consul/" style="font-size: 11.43px;">Consul</a> <a href="/tags/Consul-template/" style="font-size: 10px;">Consul-template</a> <a href="/tags/DES/" style="font-size: 10px;">DES</a> <a href="/tags/Docker/" style="font-size: 15.71px;">Docker</a> <a href="/tags/Docker-Compose/" style="font-size: 10px;">Docker Compose</a> <a href="/tags/Filter/" style="font-size: 10px;">Filter</a> <a href="/tags/Gradle/" style="font-size: 10px;">Gradle</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/Interceptor/" style="font-size: 10px;">Interceptor</a> <a href="/tags/JDK/" style="font-size: 10px;">JDK</a> <a href="/tags/JDK1-8/" style="font-size: 11.43px;">JDK1.8</a> <a href="/tags/JVM/" style="font-size: 17.14px;">JVM</a> <a href="/tags/JWT/" style="font-size: 10px;">JWT</a> <a href="/tags/Java/" style="font-size: 18.57px;">Java</a> <a href="/tags/K-V数据库/" style="font-size: 10px;">K-V数据库</a> <a href="/tags/Kafka/" style="font-size: 10px;">Kafka</a> <a href="/tags/Listener/" style="font-size: 10px;">Listener</a> <a href="/tags/MD5/" style="font-size: 10px;">MD5</a> <a href="/tags/Mockito/" style="font-size: 10px;">Mockito</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/NIO/" style="font-size: 14.29px;">NIO</a> <a href="/tags/Nginx/" style="font-size: 11.43px;">Nginx</a> <a href="/tags/NoSQL/" style="font-size: 10px;">NoSQL</a> <a href="/tags/OAuth/" style="font-size: 10px;">OAuth</a> <a href="/tags/OAuth-2-0/" style="font-size: 10px;">OAuth 2.0</a> <a href="/tags/Paxos/" style="font-size: 10px;">Paxos</a> <a href="/tags/Prototype/" style="font-size: 10px;">Prototype</a> <a href="/tags/Quartz/" style="font-size: 11.43px;">Quartz</a> <a href="/tags/RPC/" style="font-size: 20px;">RPC</a> <a href="/tags/RSA/" style="font-size: 10px;">RSA</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/Raft/" style="font-size: 10px;">Raft</a> <a href="/tags/Reactive-Streams/" style="font-size: 11.43px;">Reactive Streams</a> <a href="/tags/Reactor/" style="font-size: 10px;">Reactor</a> <a href="/tags/Redis/" style="font-size: 12.86px;">Redis</a> <a href="/tags/Redis-Cluster/" style="font-size: 10px;">Redis Cluster</a> <a href="/tags/Redis-Sentinel/" style="font-size: 10px;">Redis Sentinel</a> <a href="/tags/Reference/" style="font-size: 10px;">Reference</a> <a href="/tags/Registrator/" style="font-size: 10px;">Registrator</a> <a href="/tags/RocketMQ/" style="font-size: 10px;">RocketMQ</a> <a href="/tags/RxJava/" style="font-size: 12.86px;">RxJava</a> <a href="/tags/SAML/" style="font-size: 10px;">SAML</a> <a href="/tags/SHA1/" style="font-size: 10px;">SHA1</a> <a href="/tags/SOFA-Boot/" style="font-size: 12.86px;">SOFA-Boot</a> <a href="/tags/SOFA-RPC/" style="font-size: 14.29px;">SOFA-RPC</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/ScheduledExecutorService/" style="font-size: 10px;">ScheduledExecutorService</a> <a href="/tags/Servlet/" style="font-size: 10px;">Servlet</a> <a href="/tags/Session/" style="font-size: 10px;">Session</a> <a href="/tags/Singleton/" style="font-size: 10px;">Singleton</a> <a href="/tags/Spring-Boot-2-0/" style="font-size: 18.57px;">Spring Boot 2.0</a> <a href="/tags/Spring-Cloud/" style="font-size: 11.43px;">Spring Cloud</a> <a href="/tags/Spring-Task/" style="font-size: 10px;">Spring Task</a> <a href="/tags/Spring-WebFlux/" style="font-size: 11.43px;">Spring WebFlux</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/Thrift/" style="font-size: 15.71px;">Thrift</a> <a href="/tags/Timer/" style="font-size: 10px;">Timer</a> <a href="/tags/TwemProxy/" style="font-size: 10px;">TwemProxy</a> <a href="/tags/Unique-ID/" style="font-size: 10px;">Unique ID</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/WebSocket/" style="font-size: 10px;">WebSocket</a> <a href="/tags/一致性哈希/" style="font-size: 10px;">一致性哈希</a> <a href="/tags/主从复制/" style="font-size: 10px;">主从复制</a> <a href="/tags/全文搜索/" style="font-size: 10px;">全文搜索</a> <a href="/tags/分布式/" style="font-size: 14.29px;">分布式</a> <a href="/tags/分布式存储/" style="font-size: 10px;">分布式存储</a> <a href="/tags/分片/" style="font-size: 10px;">分片</a> <a href="/tags/列存储/" style="font-size: 10px;">列存储</a> <a href="/tags/动态扩容/" style="font-size: 10px;">动态扩容</a> <a href="/tags/反向代理/" style="font-size: 10px;">反向代理</a> <a href="/tags/反模式/" style="font-size: 12.86px;">反模式</a> <a href="/tags/图形数据库/" style="font-size: 10px;">图形数据库</a> <a href="/tags/定时任务/" style="font-size: 10px;">定时任务</a> <a href="/tags/异步/" style="font-size: 15.71px;">异步</a> <a href="/tags/微服务/" style="font-size: 12.86px;">微服务</a> <a href="/tags/文档数据库/" style="font-size: 10px;">文档数据库</a> <a href="/tags/服务器/" style="font-size: 10px;">服务器</a> <a href="/tags/消息队列/" style="font-size: 10px;">消息队列</a> <a href="/tags/行存储/" style="font-size: 10px;">行存储</a> <a href="/tags/负载均衡/" style="font-size: 11.43px;">负载均衡</a> <a href="/tags/限流/" style="font-size: 10px;">限流</a> <a href="/tags/高可用/" style="font-size: 10px;">高可用</a> <a href="/tags/高并发/" style="font-size: 10px;">高并发</a> <a href="/tags/高性能/" style="font-size: 10px;">高性能</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://weekly.manong.io/issues" target="_blank">码农周刊</a>
                    </li>
                
                    <li>
                        <a href="https://www.tuicool.com/mags" target="_blank">编程狂人</a>
                    </li>
                
                    <li>
                        <a href="http://ifeve.com" target="_blank">并发编程网</a>
                    </li>
                
                    <li>
                        <a href="https://juejin.im" target="_blank">掘金</a>
                    </li>
                
                    <li>
                        <a href="http://www.jianshu.com" target="_blank">简书</a>
                    </li>
                
                    <li>
                        <a href="https://github.com" target="_blank">Github</a>
                    </li>
                
                    <li>
                        <a href="https://stackoverflow.com" target="_blank">StackoverFlow</a>
                    </li>
                
                    <li>
                        <a href="http://www.infoq.com" target="_blank">Infoq</a>
                    </li>
                
                    <li>
                        <a href="https://segmentfault.com" target="_blank">SegmentFault</a>
                    </li>
                
                    <li>
                        <a href="http://www.importnew.com" target="_blank">ImportNew</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fas fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2018 Chen Icarus<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">Icarus</a><br>
            
    <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1273891841'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s13.cnzz.com/z_stat.php%3Fid%3D1273891841%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>


        </div>
    </div>
</footer>
        
    
    
    <!-- 来必力City版安装代码 -->
    <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];

         if (typeof LivereTower === 'function') { return; }

         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;

         e.parentNode.insertBefore(j, e);
     })(document, 'script');
    </script>
  <noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
  <!-- City版安装代码已完成 -->





    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>