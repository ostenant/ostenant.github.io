<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>JVM系列(七) - JVM线上监控工具 | Icarus&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="前言通过上一篇的 JVM 垃圾回收知识，我们了解了 JVM 具体的 垃圾回收算法 和几种 垃圾回收器。理论是指导实践的工具，有了理论指导，定位问题的时候，知识和经验是关键基础，数据可以为我们提供依据。">
<meta name="keywords" content="JVM">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM系列(七) - JVM线上监控工具">
<meta property="og:url" content="https://ostenant.coding.me/2018/08/06/JVM系列(七) - JVM线上监控工具/index.html">
<meta property="og:site_name" content="Icarus&#39;s Blog">
<meta property="og:description" content="前言通过上一篇的 JVM 垃圾回收知识，我们了解了 JVM 具体的 垃圾回收算法 和几种 垃圾回收器。理论是指导实践的工具，有了理论指导，定位问题的时候，知识和经验是关键基础，数据可以为我们提供依据。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/8/12/1652e8d753092849?w=2880&h=1696&f=png&s=769053">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/8/12/1652e8d752efb04c?w=2880&h=1726&f=png&s=769036">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/8/12/1652e8d752fbdf18?w=2880&h=468&f=png&s=120137">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/8/4/16502c7bd1fd0856?w=258&h=258&f=jpeg&s=16109">
<meta property="og:updated_time" content="2018-08-13T10:02:51.220Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JVM系列(七) - JVM线上监控工具">
<meta name="twitter:description" content="前言通过上一篇的 JVM 垃圾回收知识，我们了解了 JVM 具体的 垃圾回收算法 和几种 垃圾回收器。理论是指导实践的工具，有了理论指导，定位问题的时候，知识和经验是关键基础，数据可以为我们提供依据。">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2018/8/12/1652e8d753092849?w=2880&h=1696&f=png&s=769053">
    

    
        <link rel="alternate" href="/" title="Icarus&#39;s Blog" type="application/atom+xml" />
    

    
        <link rel="icon" href="/css/images/cat.png" />
    

    <link rel="stylesheet" href="/libs/font-awesome5/css/fontawesome.min.css">
    <link rel="stylesheet" href="/libs/font-awesome5/css/fa-brands.min.css">
    <link rel="stylesheet" href="/libs/font-awesome5/css/fa-solid.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'true', 'auto');
ga('send', 'pageview');

</script>
    
    
        <meta name="google-site-verification" content="true" />
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Icarus&#39;s Blog</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">主页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">分类</a>
                
                    <a class="main-nav-link" href="/tags">标签</a>
                
                    <a class="main-nav-link" href="/wechat">公众号</a>
                
                    <a class="main-nav-link" href="/about">关于我</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.jpeg" />
                            <i class="fas fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fas fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">主页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">分类</a></td>
                
                    <td><a class="main-nav-link" href="/tags">标签</a></td>
                
                    <td><a class="main-nav-link" href="/wechat">公众号</a></td>
                
                    <td><a class="main-nav-link" href="/about">关于我</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile" class="profile-fixed">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/avatar.jpeg" />
            <h2 id="name">陈林 | Icarus</h2>
            <h3 id="title">年轻无为，卖码为生!</h3>
            <span id="location"><i class="fas fa-map-marker-alt" style="padding-right: 5px"></i>中国, 成都</span>
            <a id="follow" target="_blank" href="http://github.com/ostenant">关注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                69
                <span>文章</span>
            </div>
            <div class="article-info-block">
                85
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/ostenant" target="_blank" title="github" class=tooltip>
                            <i class="fab fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fab fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fab fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fab fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="linkedin" class=tooltip>
                            <i class="fab fa-linkedin"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fab fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-JVM系列(七) - JVM线上监控工具" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            JVM系列(七) - JVM线上监控工具
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2018/08/06/JVM系列(七) - JVM线上监控工具/">
            <time datetime="2018-08-06T07:21:00.000Z" itemprop="datePublished">2018-08-06</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/JAVA虚拟机系列/">JAVA虚拟机系列</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/JVM/">JVM</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <hr>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>通过上一篇的 <code>JVM</code> 垃圾回收知识，我们了解了 <code>JVM</code> 具体的 <strong>垃圾回收算法</strong> 和几种 <strong>垃圾回收器</strong>。理论是指导实践的工具，有了理论指导，定位问题的时候，知识和经验是关键基础，数据可以为我们提供依据。</p>
<a id="more"></a>
<p>在线上我们经常会遇见如下几个问题：</p>
<ul>
<li>内存泄露；</li>
<li>某个进程突然 <code>CPU</code> 飙升；</li>
<li>线程死锁；</li>
<li>响应变慢。</li>
</ul>
<p>如果遇到了以上这种问题，在 <strong>线下环境</strong> 可以有各种 <strong>可视化的本地工具</strong> 支持查看。但是一旦到 <strong>线上环境</strong>，就没有这么多的 <strong>本地调试工具</strong> 支持，我们该如何基于 <strong>监控工具</strong> 来进行定位问题？</p>
<p>我们一般会基于 <strong>数据收集</strong> 来定位问题，而数据的收集离不开 <strong>监控工具</strong> 的处理，比如：<strong>运行日志</strong>、<strong>异常堆栈</strong>、<code>GC</code> <strong>日志</strong>、<strong>线程快照</strong>、<strong>堆内存快照</strong> 等。为了解决以上问题，我们常用的 <code>JVM</code> <strong>性能调优监控工具</strong> 大致有：<code>jps</code>、<code>jstat</code>、<code>jstack</code>、<code>jmap</code>、<code>jhat</code>、<code>hprof</code>、<code>jinfo</code>。</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>如果想要查看 <code>Java</code> 进程中 <strong>线程堆栈</strong> 的信息，可以选择 <code>jstack</code> 命令。如果要查看 <strong>堆内存</strong>，可以使用 <code>jmap</code> 导出并使用 <code>jhat</code> 来进行分析，包括查看 <strong>类的加载信息</strong>，<code>GC</code> <strong>算法</strong>，<strong>对象</strong> 的使用情况等。可以使用 <code>jstat</code> 来对 <code>JVM</code> 进行 <strong>统计监测</strong>，包括查看各个 <strong>区内存</strong> 和 <code>GC</code> 的情况，还可以使用 <code>hprof</code> 查看 <code>CPU</code> <strong>使用率</strong>，统计 <strong>堆内存</strong> 使用情况。下面会详细的介绍这几个工具的用法。</p>
<h2 id="JVM常见监控工具-amp-指令"><a href="#JVM常见监控工具-amp-指令" class="headerlink" title="JVM常见监控工具 &amp; 指令"></a>JVM常见监控工具 &amp; 指令</h2><h3 id="1-jps进程监控工具"><a href="#1-jps进程监控工具" class="headerlink" title="1. jps进程监控工具"></a>1. jps进程监控工具</h3><p><code>jps</code> 是用于查看有权访问的 <code>hotspot</code> <strong>虚拟机</strong> 的进程。当未指定 <code>hostid</code> 时，默认查看 <strong>本机</strong> <code>jvm</code> 进程，否则查看指定的 <code>hostid</code> 机器上的 <code>jvm</code> 进程，此时 <code>hostid</code> 所指机器必须开启 <code>jstatd</code> 服务。</p>
<p><code>jps</code> 可以列出 <code>jvm</code> 进程 <code>lvmid</code>，<strong>主类类名</strong>，<code>main</code> 函数参数, <code>jvm</code> 参数，<code>jar</code> 名称等信息。</p>
<p>命令格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">usage: jps [-<span class="built_in">help</span>]</span><br><span class="line">       jps [-q] [-mlvV] [&lt;hostid&gt;]</span><br><span class="line"></span><br><span class="line">Definitions:</span><br><span class="line">    &lt;hostid&gt;:      &lt;hostname&gt;[:&lt;port&gt;]</span><br></pre></td></tr></table></figure>
<p>参数含义如下：</p>
<ul>
<li>-q: 不输出 <strong>类名称</strong>、<code>Jar</code> <strong>名称</strong> 和传入 <code>main</code> 方法的 <strong>参数</strong>；</li>
<li>-l: 输出 <code>main</code> 类或 <code>Jar</code> 的 <strong>全限定名称</strong>；</li>
<li>-m: 输出传入 <code>main</code> 方法的 <strong>参数</strong>；</li>
<li>-v: 输出传入 <code>JVM</code> 的参数。</li>
</ul>
<h3 id="2-jinfo配置信息查看工具"><a href="#2-jinfo配置信息查看工具" class="headerlink" title="2. jinfo配置信息查看工具"></a>2. jinfo配置信息查看工具</h3><p><code>jinfo</code>（<code>JVM Configuration info</code>）这个命令作用是实时查看和调整 <strong>虚拟机运行参数</strong>。之前的 <code>jps -v</code> 命令只能查看到显示 <strong>指定的参数</strong>，如果想要查看 <strong>未显示</strong> 的参数的值就要使用 <code>jinfo</code> 命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">    jinfo [option] &lt;pid&gt;</span><br><span class="line">        (to connect to running process)</span><br><span class="line">    jinfo [option] &lt;executable &lt;core&gt;</span><br><span class="line">        (to connect to a core file)</span><br><span class="line">    jinfo [option] [server_id@]&lt;remote server IP or hostname&gt;</span><br><span class="line">        (to connect to remote debug server)</span><br></pre></td></tr></table></figure>
<p>参数含义如下：</p>
<ul>
<li>pid：本地 <code>jvm</code> 服务的进程 <code>ID</code>；</li>
<li>executable core：打印 <strong>堆栈跟踪</strong> 的核心文件；</li>
<li>remote server IP/hostname：远程 <code>debug</code> 服务的 <strong>主机名</strong> 或 <code>IP</code> 地址；</li>
<li>server id：远程 <code>debug</code> 服务的 <strong>进程</strong> <code>ID</code>。</li>
</ul>
<p>参数选项说明如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">flag</td>
<td style="text-align:left">输出指定 <code>args</code> 参数的值</td>
</tr>
<tr>
<td style="text-align:left">flags</td>
<td style="text-align:left">不需要 <code>args</code> 参数，输出所有 <code>JVM</code> 参数的值</td>
</tr>
<tr>
<td style="text-align:left">sysprops</td>
<td style="text-align:left">输出系统属性，等同于 <code>System.getProperties()</code></td>
</tr>
</tbody>
</table>
<ul>
<li>查看正在运行的 <code>jvm</code> 进程的 <strong>扩展参数</strong>。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ jinfo -flags 31983 </span><br><span class="line">Attaching to process ID 31983, please <span class="built_in">wait</span>… </span><br><span class="line">Debugger attached successfully. </span><br><span class="line">Server compiler detected. </span><br><span class="line">JVM version is 25.91-b14 </span><br><span class="line">Non-default VM flags: -XX:CICompilerCount=3 -XX:InitialHeapSize=20971520 -XX:MaxHeapFreeRatio=90 -XX:MaxHeapSize=20971520 -XX:MaxNewSize=2097152 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=2097152 -XX:OldSize=18874368 -XX:+PrintGC -XX:+PrintGCDetails -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseFastUnorderedTimeStamps -XX:+UseParallelGC </span><br><span class="line">Command line: -Xmx20m -Xms20m -Xmn2m -javaagent:/opt/idea-IU-181.4668.68/lib/idea_rt.jar=34989:/opt/idea-IU-181.4668.68/bin -Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure>
<ul>
<li>查看正在运行的 <code>jvm</code> 进程的所有 <strong>参数信息</strong>。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">$ jinfo 31983</span><br><span class="line">Attaching to process ID 31983, please <span class="built_in">wait</span>...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.91-b14</span><br><span class="line">Java System Properties:</span><br><span class="line"></span><br><span class="line">java.runtime.name = Java(TM) SE Runtime Environment</span><br><span class="line">java.vm.version = 25.91-b14</span><br><span class="line">sun.boot.library.path = /opt/jdk1.8.0_91/jre/lib/amd64</span><br><span class="line">java.vendor.url = http://java.oracle.com/</span><br><span class="line">java.vm.vendor = Oracle Corporation</span><br><span class="line">path.separator = :</span><br><span class="line">file.encoding.pkg = sun.io</span><br><span class="line">java.vm.name = Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line">sun.os.patch.level = unknown</span><br><span class="line">sun.java.launcher = SUN_STANDARD</span><br><span class="line">user.country = CN</span><br><span class="line">user.dir = /home/linchen/projects</span><br><span class="line">java.vm.specification.name = Java Virtual Machine Specification</span><br><span class="line">java.runtime.version = 1.8.0_91-b14</span><br><span class="line">java.awt.graphicsenv = sun.awt.X11GraphicsEnvironment</span><br><span class="line">os.arch = amd64</span><br><span class="line">java.endorsed.dirs = /opt/jdk1.8.0_91/jre/lib/endorsed</span><br><span class="line">java.io.tmpdir = /tmp</span><br><span class="line">line.separator = </span><br><span class="line"></span><br><span class="line">java.vm.specification.vendor = Oracle Corporation</span><br><span class="line">os.name = Linux</span><br><span class="line">sun.jnu.encoding = UTF-8</span><br><span class="line">java.library.path = /usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line">java.specification.name = Java Platform API Specification</span><br><span class="line">java.class.version = 52.0</span><br><span class="line">sun.management.compiler = HotSpot 64-Bit Tiered Compilers</span><br><span class="line">os.version = 4.15.0-24-generic</span><br><span class="line">user.home = /home/linchen</span><br><span class="line">user.timezone = </span><br><span class="line">java.awt.printerjob = sun.print.PSPrinterJob</span><br><span class="line">file.encoding = UTF-8</span><br><span class="line">java.specification.version = 1.8</span><br><span class="line">user.name = linchen</span><br><span class="line">java.class.path = /opt/jdk1.8.0_91/jre/lib/charsets.jar:/opt/jdk1.8.0_91/jre/lib/deploy.jar:/opt/jdk1.8.0_91/jre/lib/ext/cldrdata.jar:/opt/jdk1.8.0_91/jre/lib/ext/dnsns.jar:/opt/jdk1.8.0_91/jre/lib/ext/jaccess.jar:/opt/jdk1.8.0_91/jre/lib/ext/jfxrt.jar:/opt/jdk1.8.0_91/jre/lib/ext/localedata.jar:/opt/jdk1.8.0_91/jre/lib/ext/nashorn.jar:/opt/jdk1.8.0_91/jre/lib/ext/sunec.jar:/opt/jdk1.8.0_91/jre/lib/ext/sunjce_provider.jar:/opt/jdk1.8.0_91/jre/lib/ext/sunpkcs11.jar:/opt/jdk1.8.0_91/jre/lib/ext/zipfs.jar:/opt/jdk1.8.0_91/jre/lib/javaws.jar:/opt/jdk1.8.0_91/jre/lib/jce.jar:/opt/jdk1.8.0_91/jre/lib/jfr.jar:/opt/jdk1.8.0_91/jre/lib/jfxswt.jar:/opt/jdk1.8.0_91/jre/lib/jsse.jar:/opt/jdk1.8.0_91/jre/lib/management-agent.jar:/opt/jdk1.8.0_91/jre/lib/plugin.jar:/opt/jdk1.8.0_91/jre/lib/resources.jar:/opt/jdk1.8.0_91/jre/lib/rt.jar:/home/linchen/IdeaProjects/core_java/target/classes:/home/linchen/.m2/repository/io/netty/netty-all/4.1.7.Final/netty-all-4.1.7.Final.jar:/home/linchen/.m2/repository/junit/junit/4.12/junit-4.12.jar:/home/linchen/.m2/repository/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar:/home/linchen/.m2/repository/com/lmax/disruptor/3.3.0/disruptor-3.3.0.jar:/home/linchen/.m2/repository/com/rabbitmq/amqp-client/5.3.0/amqp-client-5.3.0.jar:/home/linchen/.m2/repository/org/slf4j/slf4j-api/1.7.25/slf4j-api-1.7.25.jar:/opt/idea-IU-181.4668.68/lib/idea_rt.jar</span><br><span class="line">java.vm.specification.version = 1.8</span><br><span class="line">sun.arch.data.model = 64</span><br><span class="line">sun.java.command = com.own.learn.jvm.JinfoTest</span><br><span class="line">java.home = /opt/jdk1.8.0_91/jre</span><br><span class="line">user.language = zh</span><br><span class="line">java.specification.vendor = Oracle Corporation</span><br><span class="line">awt.toolkit = sun.awt.X11.XToolkit</span><br><span class="line">java.vm.info = mixed mode</span><br><span class="line">java.version = 1.8.0_91</span><br><span class="line">java.ext.dirs = /opt/jdk1.8.0_91/jre/lib/ext:/usr/java/packages/lib/ext</span><br><span class="line">sun.boot.class.path = /opt/jdk1.8.0_91/jre/lib/resources.jar:/opt/jdk1.8.0_91/jre/lib/rt.jar:/opt/jdk1.8.0_91/jre/lib/sunrsasign.jar:/opt/jdk1.8.0_91/jre/lib/jsse.jar:/opt/jdk1.8.0_91/jre/lib/jce.jar:/opt/jdk1.8.0_91/jre/lib/charsets.jar:/opt/jdk1.8.0_91/jre/lib/jfr.jar:/opt/jdk1.8.0_91/jre/classes</span><br><span class="line">java.vendor = Oracle Corporation</span><br><span class="line">file.separator = /</span><br><span class="line">java.vendor.url.bug = http://bugreport.sun.com/bugreport/</span><br><span class="line">sun.io.unicode.encoding = UnicodeLittle</span><br><span class="line">sun.cpu.endian = little</span><br><span class="line">sun.desktop = gnome</span><br><span class="line">sun.cpu.isalist = </span><br><span class="line"></span><br><span class="line">VM Flags:</span><br><span class="line">Non-default VM flags: -XX:CICompilerCount=3 -XX:InitialHeapSize=20971520 -XX:MaxHeapFreeRatio=90 -XX:MaxHeapSize=20971520 -XX:MaxNewSize=2097152 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=2097152 -XX:OldSize=18874368 -XX:+PrintGC -XX:+PrintGCDetails -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseFastUnorderedTimeStamps -XX:+UseParallelGC </span><br><span class="line">Command line:  -Xmx20m -Xms20m -Xmn2m -javaagent:/opt/idea-IU-181.4668.68/lib/idea_rt.jar=34989:/opt/idea-IU-181.4668.68/bin -Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure>
<ul>
<li>查看正在运行的 <code>jvm</code> 进程的 <strong>环境变量信息</strong>。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ jinfo -sysprops 31983 </span><br><span class="line">Attaching to process ID 31983, please <span class="built_in">wait</span>… </span><br><span class="line">Debugger attached successfully. </span><br><span class="line">Server compiler detected. </span><br><span class="line">JVM version is 25.91-b14 </span><br><span class="line">java.runtime.name = Java(TM) SE Runtime Environment </span><br><span class="line">java.vm.version = 25.91-b14 </span><br><span class="line">sun.boot.library.path = /opt/jdk1.8.0_91/jre/lib/amd64 </span><br><span class="line">java.vendor.url = http://java.oracle.com/ </span><br><span class="line">java.vm.vendor = Oracle Corporation </span><br><span class="line">path.separator = : </span><br><span class="line">file.encoding.pkg = sun.io </span><br><span class="line">java.vm.name = Java HotSpot(TM) 64-Bit Server VM </span><br><span class="line">sun.os.patch.level = unknown </span><br><span class="line">sun.java.launcher = SUN_STANDARD </span><br><span class="line">user.country = CN </span><br><span class="line">user.dir = /home/linchen/projects </span><br><span class="line">java.vm.specification.name = Java Virtual Machine Specification </span><br><span class="line">java.runtime.version = 1.8.0_91-b14 </span><br><span class="line">java.awt.graphicsenv = sun.awt.X11GraphicsEnvironment </span><br><span class="line">os.arch = amd64 </span><br><span class="line">java.endorsed.dirs = /opt/jdk1.8.0_91/jre/lib/endorsed </span><br><span class="line">java.io.tmpdir = /tmp </span><br><span class="line">line.separator =</span><br></pre></td></tr></table></figure>
<h3 id="2-jstat信息统计监控工具"><a href="#2-jstat信息统计监控工具" class="headerlink" title="2. jstat信息统计监控工具"></a>2. jstat信息统计监控工具</h3><p><code>jstat</code> 是用于识别 <strong>虚拟机</strong> 各种 <strong>运行状态信息</strong> 的命令行工具。它可以显示 <strong>本地</strong> 或者 <strong>远程虚拟机</strong> 进程中的 <strong>类装载</strong>、<strong>内存</strong>、<strong>垃圾收集</strong>、<code>jit</code> <strong>编译</strong> 等运行数据，它是 <strong>线上</strong> 定位 <code>jvm</code> <strong>性能</strong> 的首选工具。</p>
<p><code>jstat</code> 工具提供如下的 <code>jvm</code> 监控功能：</p>
<ol>
<li><strong>类的加载</strong> 及 <strong>卸载</strong> 的情况；</li>
<li>查看 <strong>新生代</strong>、<strong>老生代</strong> 及 <strong>元空间</strong>（<code>MetaSpace</code>）的 <strong>容量</strong> 及使用情况；</li>
<li>查看 <strong>新生代</strong>、<strong>老生代</strong> 及 <strong>元空间</strong>（<code>MetaSpace</code>）的 <strong>垃圾回收情况</strong>，包括垃圾回收的 <strong>次数</strong>，垃圾回收所占用的 <strong>时间</strong>；</li>
<li>查看 <strong>新生代</strong> 中 <code>Eden</code> 区及 <code>Survior</code> 区中 <strong>容量</strong> 及 <strong>分配情况</strong> 等。</li>
</ol>
<p>命令格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Usage: jstat -<span class="built_in">help</span>|-options</span><br><span class="line">       jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]</span><br></pre></td></tr></table></figure>
<p>参数含义如下:</p>
<ul>
<li>option: 参数选项。<ul>
<li>-t: 可以在打印的列加上 <code>timestamp</code> 列，用于显示系统运行的时间。</li>
<li>-h: 可以在 <strong>周期性数据</strong> 的时候，可以在指定输出多少行以后输出一次 <strong>表头</strong>。</li>
</ul>
</li>
<li>vmid: Virtual Machine ID（进程的 <code>pid</code>）。</li>
<li>lines: <strong>表头</strong> 与 <strong>表头</strong> 的间隔行数。</li>
<li>interval: 执行每次的 <strong>间隔时间</strong>，单位为 <strong>毫秒</strong>。</li>
<li>count: 用于指定输出记录的 <strong>次数</strong>，缺省则会一直打印。</li>
</ul>
<p>参数选项说明如下：</p>
<ul>
<li>class: 显示 <strong>类加载</strong> <code>ClassLoad</code> 的相关信息；</li>
<li>compiler: 显示 <code>JIT</code> <strong>编译</strong> 的相关信息；</li>
<li>gc: 显示和 <code>gc</code> 相关的 <strong>堆信息</strong>；</li>
<li>gccapacity: 显示 <strong>各个代</strong> 的 <strong>容量</strong> 以及 <strong>使用情况</strong>；</li>
<li>gcmetacapacity: 显示 <strong>元空间</strong> <code>metaspace</code> 的大小；</li>
<li>gcnew: 显示 <strong>新生代</strong> 信息；</li>
<li>gcnewcapacity: 显示 <strong>新生代大小</strong> 和 <strong>使用情况</strong>；</li>
<li>gcold: 显示 <strong>老年代</strong> 和 <strong>永久代</strong> 的信息；</li>
<li>gcoldcapacity: 显示 <strong>老年代</strong> 的大小；</li>
<li>gcutil: 显示 <strong>垃圾回收信息</strong>；</li>
<li>gccause: 显示 <strong>垃圾回收</strong> 的相关信息（同 <code>-gcutil</code>），同时显示 <strong>最后一次</strong> 或 <strong>当前</strong> 正在发生的垃圾回收的 <strong>诱因</strong>；</li>
<li>printcompilation: 输出 <code>JIT</code> <strong>编译</strong> 的方法信息；</li>
</ul>
<h4 id="2-1-class"><a href="#2-1-class" class="headerlink" title="2.1. class"></a>2.1. class</h4><p>显示和监视 <strong>类装载</strong>、<strong>卸载数量</strong>、<strong>总空间</strong> 以及 <strong>耗费的时间</strong>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -class 8615</span><br><span class="line">Loaded  Bytes     Unloaded  Bytes      Time</span><br><span class="line">  7271 13325.8        1      0.9       2.98</span><br></pre></td></tr></table></figure>
<p>参数列表及含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Loaded</td>
<td style="text-align:left">已经装载的类的数量</td>
</tr>
<tr>
<td style="text-align:left">Bytes</td>
<td style="text-align:left">装载类所占用的字节数</td>
</tr>
<tr>
<td style="text-align:left">Unloaded</td>
<td style="text-align:left">已经卸载类的数量</td>
</tr>
<tr>
<td style="text-align:left">Bytes</td>
<td style="text-align:left">卸载类的字节数</td>
</tr>
<tr>
<td style="text-align:left">Time</td>
<td style="text-align:left">装载和卸载类所花费的时间</td>
</tr>
</tbody>
</table>
<h4 id="2-2-compiler"><a href="#2-2-compiler" class="headerlink" title="2.2. compiler"></a>2.2. compiler</h4><p>显示虚拟机 <strong>实时编译</strong>（<code>JIT</code>）的 <strong>次数</strong> 和 <strong>耗时</strong> 等信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -compiler 8615</span><br><span class="line">Compiled   Failed  Invalid  Time     FailedType   FailedMethod</span><br><span class="line">  3886        0       0     1.29          0</span><br></pre></td></tr></table></figure>
<p>参数列表及含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Compiled</td>
<td style="text-align:left">编译任务执行数量</td>
</tr>
<tr>
<td style="text-align:left">Failed</td>
<td style="text-align:left">编译任务执行失败数量</td>
</tr>
<tr>
<td style="text-align:left">Invalid</td>
<td style="text-align:left">编译任务执行失效数量</td>
</tr>
<tr>
<td style="text-align:left">Time</td>
<td style="text-align:left">编译任务消耗时间</td>
</tr>
<tr>
<td style="text-align:left">FailedType</td>
<td style="text-align:left">最后一个编译失败任务的类型</td>
</tr>
<tr>
<td style="text-align:left">FailedMethod</td>
<td style="text-align:left">最后一个编译失败任务所在的类及方法</td>
</tr>
</tbody>
</table>
<h4 id="2-3-gc"><a href="#2-3-gc" class="headerlink" title="2.3. gc"></a>2.3. gc</h4><p>显示 <strong>垃圾回收</strong>（<code>gc</code>）相关的 <strong>堆信息</strong>，查看 <code>gc</code> 的 <strong>次数</strong> 及 <strong>时间</strong>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gc 8615</span><br><span class="line"> S0C      S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT   </span><br><span class="line">20480.0 10752.0  0.0    0.0   262128.0 130750.7  165376.0   24093.7   35456.0 33931.0 4992.0 4582.0      5    0.056   2      0.075    0.131</span><br></pre></td></tr></table></figure>
<p>比如下面输出的是 <code>GC</code> 信息，采样 <strong>时间间隔</strong> 为 <code>250ms</code>，采样数为 <code>4</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gc 8615 250 4</span><br><span class="line"> S0C      S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT   </span><br><span class="line">20480.0 10752.0  0.0    0.0   262144.0 130750.7  165376.0   24093.7   35456.0 33931.0 4992.0 4582.0      5    0.056   2      0.075    0.131</span><br><span class="line">20480.0 10752.0  0.0    0.0   262872.0 130750.7  165376.0   24093.7   35456.0 33931.0 4992.0 4582.0      5    0.056   2      0.075    0.131</span><br><span class="line">20480.0 10752.0  0.0    0.0   262720.0 130750.7  165376.0   24093.7   35456.0 33931.0 4992.0 4582.0      5    0.056   2      0.075    0.131</span><br><span class="line">20480.0 10752.0  0.0    0.0   262446.0 130750.7  165376.0   24093.7   35456.0 33931.0 4992.0 4582.0      5    0.056   2      0.075    0.131</span><br></pre></td></tr></table></figure>
<p>参数列表及含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">S0C</td>
<td style="text-align:left">年轻代中第一个 <code>survivor</code> 的容量</td>
</tr>
<tr>
<td style="text-align:left">S1C</td>
<td style="text-align:left">年轻代中第二个 <code>survivor</code> 的容量</td>
</tr>
<tr>
<td style="text-align:left">S0U</td>
<td style="text-align:left">年轻代中第一个 <code>survivor</code> 目前已使用空间</td>
</tr>
<tr>
<td style="text-align:left">S1U</td>
<td style="text-align:left">年轻代中第二个 <code>survivor</code> 目前已使用空间</td>
</tr>
<tr>
<td style="text-align:left">EC</td>
<td style="text-align:left">年轻代中 <code>Eden</code> 的容量</td>
</tr>
<tr>
<td style="text-align:left">EU</td>
<td style="text-align:left">年轻代中 <code>Eden</code> 目前已使用空间</td>
</tr>
<tr>
<td style="text-align:left">OC</td>
<td style="text-align:left">老年代的容量</td>
</tr>
<tr>
<td style="text-align:left">OU</td>
<td style="text-align:left">老年代目前已使用空间</td>
</tr>
<tr>
<td style="text-align:left">MC</td>
<td style="text-align:left">元空间 <code>metaspace</code> 的容量</td>
</tr>
<tr>
<td style="text-align:left">MU</td>
<td style="text-align:left">元空间 <code>metaspace</code> 目前已使用空间</td>
</tr>
<tr>
<td style="text-align:left">YGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>年轻代</strong> 中 <code>gc</code> <strong>次数</strong></td>
</tr>
<tr>
<td style="text-align:left">YGCT</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>年轻代</strong> 中 <code>gc</code> <strong>所用时间</strong></td>
</tr>
<tr>
<td style="text-align:left">FGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>老年代</strong> 中 <code>gc</code> <strong>次数</strong></td>
</tr>
<tr>
<td style="text-align:left">FGCT</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>老年代</strong> 中 <code>gc</code> <strong>所用时间</strong></td>
</tr>
<tr>
<td style="text-align:left">GCT</td>
<td style="text-align:left">从应用程序启动到采样时 <code>gc</code> 用的 <strong>总时间</strong></td>
</tr>
</tbody>
</table>
<h4 id="2-4-gccapacity"><a href="#2-4-gccapacity" class="headerlink" title="2.4. gccapacity"></a>2.4. gccapacity</h4><p>显示 <strong>虚拟机内存</strong> 中三代 <strong>年轻代</strong>（<code>young</code>)，<strong>老年代</strong>（<code>old</code>），<strong>元空间</strong>（<code>metaspace</code>）对象的使用和占用大小。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gccapacity 8615</span><br><span class="line"> NGCMN     NGCMX     NGC      S0C     S1C      EC       OGCMN      OGCMX       OGC        OC         MCMN   MCMX       MC        CCSMN  CCSMX     CCSC      YGC    FGC </span><br><span class="line"> 87040.0 1397760.0 372736.0 20480.0 10752.0 262144.0   175104.0  2796544.0   165376.0   165376.0      0.0 1079296.0  35456.0      0.0 1048576.0   4992.0      5     2</span><br></pre></td></tr></table></figure>
<p>参数列表及含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">NGCMN</td>
<td style="text-align:left">年轻代的 <strong>初始化</strong>（最小）容量</td>
</tr>
<tr>
<td style="text-align:left">NGCMX</td>
<td style="text-align:left">年轻代的 <strong>最大容量</strong></td>
</tr>
<tr>
<td style="text-align:left">NGC</td>
<td style="text-align:left">年轻代 <strong>当前的容量</strong></td>
</tr>
<tr>
<td style="text-align:left">S0C</td>
<td style="text-align:left">年轻代中 <strong>第一个</strong> <code>survivor</code> 区的容量</td>
</tr>
<tr>
<td style="text-align:left">S1C</td>
<td style="text-align:left">年轻代中 <strong>第二个</strong> <code>survivor</code> 区的容量</td>
</tr>
<tr>
<td style="text-align:left">EC</td>
<td style="text-align:left">年轻代中 <code>Eden</code>（<strong>伊甸园</strong>）的容量</td>
</tr>
<tr>
<td style="text-align:left">OGCMN</td>
<td style="text-align:left">老年代中 <strong>初始化</strong>（最小）容量</td>
</tr>
<tr>
<td style="text-align:left">OGCMX</td>
<td style="text-align:left">老年代的 <strong>最大容量</strong></td>
</tr>
<tr>
<td style="text-align:left">OGC</td>
<td style="text-align:left">老年代 <strong>当前新生成</strong> 的容量</td>
</tr>
<tr>
<td style="text-align:left">OC</td>
<td style="text-align:left">老年代的容量大小</td>
</tr>
<tr>
<td style="text-align:left">MCMN</td>
<td style="text-align:left"><strong>元空间</strong> 的 <strong>初始化容量</strong></td>
</tr>
<tr>
<td style="text-align:left">MCMX</td>
<td style="text-align:left"><strong>元空间</strong> 的 <strong>最大容量</strong></td>
</tr>
<tr>
<td style="text-align:left">MC</td>
<td style="text-align:left"><strong>元空间</strong> 当前 <strong>新生成</strong> 的容量</td>
</tr>
<tr>
<td style="text-align:left">CCSMN</td>
<td style="text-align:left"><strong>最小</strong> 压缩类空间大小</td>
</tr>
<tr>
<td style="text-align:left">CCSMX</td>
<td style="text-align:left"><strong>最大</strong> 压缩类空间大小</td>
</tr>
<tr>
<td style="text-align:left">CCSC</td>
<td style="text-align:left"><strong>当前</strong> 压缩类空间大小</td>
</tr>
<tr>
<td style="text-align:left">YGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>年轻代</strong> 中的 <code>gc</code> 次数</td>
</tr>
<tr>
<td style="text-align:left">FGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>老年代</strong> 中的 <code>gc</code> 次数</td>
</tr>
</tbody>
</table>
<h4 id="2-5-gcmetacapacity"><a href="#2-5-gcmetacapacity" class="headerlink" title="2.5. gcmetacapacity"></a>2.5. gcmetacapacity</h4><p>显示 <strong>元空间</strong>（<code>metaspace</code>）中 <strong>对象</strong> 的信息及其占用量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcmetacapacity 8615</span><br><span class="line">MCMN       MCMX        MC       CCSMN      CCSMX       CCSC     YGC   FGC    FGCT     GCT   </span><br><span class="line">0.0      1079296.0   35456.0     0.0     1048576.0    4992.0     5     2    0.075    0.131</span><br></pre></td></tr></table></figure>
<p>参数列表及含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">MCMN</td>
<td style="text-align:left"><strong>最小</strong> 元数据空间容量</td>
</tr>
<tr>
<td style="text-align:left">MCMX</td>
<td style="text-align:left"><strong>最大</strong> 元数据空间容量</td>
</tr>
<tr>
<td style="text-align:left">MC</td>
<td style="text-align:left"><strong>当前</strong> 元数据空间容量</td>
</tr>
<tr>
<td style="text-align:left">CCSMN</td>
<td style="text-align:left"><strong>最小压缩</strong> 类空间容量</td>
</tr>
<tr>
<td style="text-align:left">CCSMX</td>
<td style="text-align:left"><strong>最大压缩</strong> 类空间容量</td>
</tr>
<tr>
<td style="text-align:left">CCSC</td>
<td style="text-align:left"><strong>当前</strong> 压缩类空间容量</td>
</tr>
<tr>
<td style="text-align:left">YGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>年轻代</strong> 中 <code>gc</code> 次数</td>
</tr>
<tr>
<td style="text-align:left">FGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>老年代</strong> 中 <code>gc</code> 次数</td>
</tr>
<tr>
<td style="text-align:left">FGCT</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>老年代</strong> <code>gc</code> <strong>所用时间</strong></td>
</tr>
<tr>
<td style="text-align:left">GCT</td>
<td style="text-align:left">从应用程序启动到采样时 <code>gc</code> 用的 <strong>总时间</strong></td>
</tr>
</tbody>
</table>
<h4 id="2-6-gcnew"><a href="#2-6-gcnew" class="headerlink" title="2.6. gcnew"></a>2.6. gcnew</h4><p>显示 <strong>年轻代对象</strong> 的相关信息，包括两个 <code>survivor</code> 区和 一个 <code>Eden</code> 区。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcnew 8615</span><br><span class="line"> S0C      S1C      S0U    S1U TTv MTT  DSS      EC       EU       YGC     YGCT  </span><br><span class="line">20480.0 10752.0    0.0    0.0  6  15 20480.0 262144.0 131406.0      5    0.056</span><br></pre></td></tr></table></figure>
<p>参数列表及含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">S0C</td>
<td style="text-align:left">年轻代中第一个 <code>survivor</code> 的容量</td>
</tr>
<tr>
<td style="text-align:left">S1C</td>
<td style="text-align:left">年轻代中第二个 <code>survivor</code> 的容量</td>
</tr>
<tr>
<td style="text-align:left">S0U</td>
<td style="text-align:left">年轻代中第一个 <code>survivor</code> 目前已使用空间</td>
</tr>
<tr>
<td style="text-align:left">S1U</td>
<td style="text-align:left">年轻代中第二个 <code>survivor</code> 目前已使用空间</td>
</tr>
<tr>
<td style="text-align:left">TT</td>
<td style="text-align:left">持有次数限制</td>
</tr>
<tr>
<td style="text-align:left">MTT</td>
<td style="text-align:left">最大持有次数限制</td>
</tr>
<tr>
<td style="text-align:left">DSS</td>
<td style="text-align:left">期望的 <strong>幸存区</strong> 大小</td>
</tr>
<tr>
<td style="text-align:left">EC</td>
<td style="text-align:left">年轻代中 <code>Eden</code> 的容量</td>
</tr>
<tr>
<td style="text-align:left">EU</td>
<td style="text-align:left">年轻代中 <code>Eden</code> 目前已使用空间</td>
</tr>
<tr>
<td style="text-align:left">YGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>年轻代</strong> 中 <code>gc</code> <strong>次数</strong></td>
</tr>
<tr>
<td style="text-align:left">YGCT</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>年轻代</strong> 中 <code>gc</code> <strong>所用时间</strong></td>
</tr>
</tbody>
</table>
<h4 id="2-7-gcnewcapacity"><a href="#2-7-gcnewcapacity" class="headerlink" title="2.7. gcnewcapacity"></a>2.7. gcnewcapacity</h4><p>查看 <strong>年轻代</strong> 对象的信息及其占用量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcnewcapacity 8615</span><br><span class="line">  NGCMN      NGCMX       NGC      S0CMX     S0C     S1CMX     S1C       ECMX        EC      YGC   FGC </span><br><span class="line"> 87040.0   1397760.0   372736.0  465920.0  20480.0 465920.0  10752.0  1396736.0   262144.0   5     2</span><br></pre></td></tr></table></figure>
<p>参数列表及含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">NGCMN</td>
<td style="text-align:left">年轻代中初始化(最小)的大小</td>
</tr>
<tr>
<td style="text-align:left">NGCMX</td>
<td style="text-align:left">年轻代的最大容量</td>
</tr>
<tr>
<td style="text-align:left">NGC</td>
<td style="text-align:left">年轻代中当前的容量</td>
</tr>
<tr>
<td style="text-align:left">S0CMX</td>
<td style="text-align:left">年轻代中第一个 <code>survivor</code> 的最大容量</td>
</tr>
<tr>
<td style="text-align:left">S0C</td>
<td style="text-align:left">年轻代中第一个 <code>survivor</code>的容量</td>
</tr>
<tr>
<td style="text-align:left">S1CMX</td>
<td style="text-align:left">年轻代中第二个 <code>survivor</code> 的最大容量</td>
</tr>
<tr>
<td style="text-align:left">S1C</td>
<td style="text-align:left">年轻代中第二个 <code>survivor</code> 的容量</td>
</tr>
<tr>
<td style="text-align:left">ECMX</td>
<td style="text-align:left">年轻代中 <code>Eden</code> 的最大容量</td>
</tr>
<tr>
<td style="text-align:left">EC</td>
<td style="text-align:left">年轻代中 <code>Eden</code> 的容量</td>
</tr>
<tr>
<td style="text-align:left">YGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>年轻代</strong> 中 <code>gc</code> 次数</td>
</tr>
<tr>
<td style="text-align:left">FGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>老年代</strong> 中 <code>gc</code> 次数</td>
</tr>
</tbody>
</table>
<h4 id="2-8-gcold"><a href="#2-8-gcold" class="headerlink" title="2.8. gcold"></a>2.8. gcold</h4><p>显示 <strong>老年代对象</strong> 的相关信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcold 8615</span><br><span class="line">   MC       MU      CCSC     CCSU       OC          OU       YGC    FGC    FGCT     GCT   </span><br><span class="line"> 35456.0  33931.0   4992.0   4582.0    165376.0     24093.7      5     2    0.075    0.131</span><br></pre></td></tr></table></figure>
<p>参数列表及含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">MC</td>
<td style="text-align:left"><strong>元空间</strong>（<code>metaspace</code>）的容量</td>
</tr>
<tr>
<td style="text-align:left">MU</td>
<td style="text-align:left"><strong>元空间</strong>（<code>metaspace</code>）目前已使用空间</td>
</tr>
<tr>
<td style="text-align:left">CCSC</td>
<td style="text-align:left">压缩类空间大小</td>
</tr>
<tr>
<td style="text-align:left">CCSU</td>
<td style="text-align:left">压缩类空间 <strong>使用</strong> 大小</td>
</tr>
<tr>
<td style="text-align:left">OC</td>
<td style="text-align:left"><strong>老年代</strong> 的容量</td>
</tr>
<tr>
<td style="text-align:left">OU</td>
<td style="text-align:left"><strong>老年代</strong> 目前已使用空间</td>
</tr>
<tr>
<td style="text-align:left">YGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>年轻代</strong> 中 <code>gc</code> 次数</td>
</tr>
<tr>
<td style="text-align:left">FGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>老年代</strong> 中 <code>gc</code> 次数</td>
</tr>
<tr>
<td style="text-align:left">FGCT</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>老年代</strong> <code>gc</code> <strong>所用时间</strong></td>
</tr>
<tr>
<td style="text-align:left">GCT</td>
<td style="text-align:left">从应用程序启动到采样时 <code>gc</code> 用的 <strong>总时间</strong></td>
</tr>
</tbody>
</table>
<h4 id="2-9-gcoldcapacity"><a href="#2-9-gcoldcapacity" class="headerlink" title="2.9. gcoldcapacity"></a>2.9. gcoldcapacity</h4><p>查看 <strong>老年代</strong> 对象的信息及其占用量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcoldcapacity 8615</span><br><span class="line">   OGCMN       OGCMX        OGC         OC        YGC   FGC    FGCT     GCT   </span><br><span class="line">  175104.0   2796544.0    165376.0    165376.0     5     2    0.075    0.131</span><br></pre></td></tr></table></figure>
<p>参数列表及含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">OGCMN</td>
<td style="text-align:left"><strong>老年代</strong> 中初始化(最小)的大小</td>
</tr>
<tr>
<td style="text-align:left">OGCMX</td>
<td style="text-align:left"><strong>老年代</strong> 的最大容量</td>
</tr>
<tr>
<td style="text-align:left">OGC</td>
<td style="text-align:left"><strong>老年代</strong> 当前新生成的容量</td>
</tr>
<tr>
<td style="text-align:left">OC</td>
<td style="text-align:left"><strong>老年代</strong> 的容量</td>
</tr>
<tr>
<td style="text-align:left">YGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>年轻代</strong> 中 <code>gc</code> 的次数</td>
</tr>
<tr>
<td style="text-align:left">FGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>老年代</strong> 中 <code>gc</code> 的次数</td>
</tr>
<tr>
<td style="text-align:left">FGCT</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>老年代</strong> 中 <code>gc</code> 所用时间</td>
</tr>
<tr>
<td style="text-align:left">GCT</td>
<td style="text-align:left">从应用程序启动到采样时 <code>gc</code> 用的 <strong>总时间</strong></td>
</tr>
</tbody>
</table>
<h4 id="2-10-gcutil"><a href="#2-10-gcutil" class="headerlink" title="2.10. gcutil"></a>2.10. gcutil</h4><p>显示 <strong>垃圾回收</strong>（<code>gc</code>）过程中的信息，包括各个 <strong>内存的使用占比</strong>，垃圾回收 <strong>时间</strong> 和回收 <strong>次数</strong>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcutil 8615</span><br><span class="line">   S0     S1     E      O      M     CCS     YGC     YGCT    FGC    FGCT     GCT   </span><br><span class="line">  0.00   0.00  50.13  14.57  95.70  91.79      5    0.056     2    0.075    0.131</span><br></pre></td></tr></table></figure>
<p>参数列表及含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">S0</td>
<td style="text-align:left">年轻代中 <strong>第一个</strong> <code>survivor</code> 区 <strong>已使用</strong> 的占当前容量百分比</td>
</tr>
<tr>
<td style="text-align:left">S1</td>
<td style="text-align:left">年轻代中 <strong>第二个</strong> <code>survivor</code> 区 <strong>已使用</strong> 的占当前容量百分比</td>
</tr>
<tr>
<td style="text-align:left">E</td>
<td style="text-align:left">年轻代中 <code>Eden</code> 区 <strong>已使用</strong> 的占当前容量百分比</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left"><strong>老年代</strong> 中 <strong>已使用</strong> 的占当前容量百分比</td>
</tr>
<tr>
<td style="text-align:left">M</td>
<td style="text-align:left"><strong>元空间</strong>（<code>metaspace</code>）中 <strong>已使用</strong> 的占当前容量百分比</td>
</tr>
<tr>
<td style="text-align:left">YGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>年轻代</strong> 中 <code>gc</code> <strong>次数</strong></td>
</tr>
<tr>
<td style="text-align:left">YGCT</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>年轻代</strong> 中 <code>gc</code> <strong>所用时间</strong></td>
</tr>
<tr>
<td style="text-align:left">FGC</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>老年代</strong> <code>gc</code> <strong>次数</strong></td>
</tr>
<tr>
<td style="text-align:left">FGCT</td>
<td style="text-align:left">从应用程序启动到采样时 <strong>老年代</strong> <code>gc</code> <strong>所用时间</strong></td>
</tr>
<tr>
<td style="text-align:left">GCT</td>
<td style="text-align:left">从应用程序启动到采样时 <code>gc</code> 用的 <strong>总时间</strong></td>
</tr>
</tbody>
</table>
<h3 id="3-jmap堆内存统计工具"><a href="#3-jmap堆内存统计工具" class="headerlink" title="3. jmap堆内存统计工具"></a>3. jmap堆内存统计工具</h3><p><code>jmap</code> (<code>JVM Memory Map</code>) 命令用来查看 <strong>堆内存</strong> 使用状况，一般结合 <code>jhat</code> 使用，用于生成 <code>heap dump</code> 文件。<code>jmap</code> 不仅能生成 <code>dump</code> 文件，还可以查询 <code>finalize</code> <strong>执行队列</strong>、<code>Java</code> <strong>堆</strong> 和 <strong>元空间</strong> <code>metaspace</code> 的详细信息，如当前 <strong>使用率</strong>、当前使用的是哪种 <strong>收集器</strong> 等等。</p>
<blockquote>
<p>如果不使用这个命令，还可以使用 <code>-XX:+HeapDumpOnOutOfMemoryError</code> 参数来让虚拟机出现 <code>OOM</code> 的时候，自动生成 <code>dump</code> 文件。</p>
</blockquote>
<p>命令格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">    jmap [option] &lt;pid&gt;</span><br><span class="line">        (to connect to running process)</span><br><span class="line">    jmap [option] &lt;executable &lt;core&gt;</span><br><span class="line">        (to connect to a core file)</span><br><span class="line">    jmap [option] [server_id@]&lt;remote server IP or hostname&gt;</span><br><span class="line">        (to connect to remote debug server)</span><br></pre></td></tr></table></figure>
<p>参数含义如下：</p>
<ul>
<li>pid：本地 <code>jvm</code> 服务的进程 <code>ID</code>；</li>
<li>executable core：打印 <strong>堆栈跟踪</strong> 的核心文件；</li>
<li>remote server IP/hostname：远程 <code>debug</code> 服务的 <strong>主机名</strong> 或 <code>IP</code> 地址；</li>
<li>server id：远程 <code>debug</code> 服务的 <strong>进程</strong> <code>ID</code>。</li>
</ul>
<p>参数选项说明如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">heap</td>
<td style="text-align:left">显示 <strong>堆</strong> 中的摘要信息</td>
</tr>
<tr>
<td style="text-align:left">histo</td>
<td style="text-align:left">显示 <strong>堆</strong> 中对象的统计信息</td>
</tr>
<tr>
<td style="text-align:left">histo[:live]</td>
<td style="text-align:left">只显示 <strong>堆</strong> 中 <strong>存活对象</strong> 的统计信息</td>
</tr>
<tr>
<td style="text-align:left">clstats</td>
<td style="text-align:left">显示 <strong>类加载</strong> 的统计信息</td>
</tr>
<tr>
<td style="text-align:left">finalizerinfo</td>
<td style="text-align:left">显示在 <code>F-Queue</code> <strong>队列</strong> 等待 <code>Finalizer</code> 线程执行 <code>finalizer</code> 方法的对象</td>
</tr>
<tr>
<td style="text-align:left">dump</td>
<td style="text-align:left">导出内存转储快照</td>
</tr>
</tbody>
</table>
<blockquote>
<p>注意：<code>dump</code> 内存快照分析基本上包含了 <code>histo</code>、<code>clstats</code>、<code>finalizerinfo</code> 等功能。</p>
</blockquote>
<h5 id="3-1-heap"><a href="#3-1-heap" class="headerlink" title="3.1. heap"></a>3.1. heap</h5><p>显示 <strong>堆</strong> 中的摘要信息。包括 <strong>堆内存</strong> 的使用情况，正在使用的 <code>GC</code> <strong>算法</strong>、<strong>堆配置参数</strong> 和 <strong>各代中堆内存</strong> 使用情况。可以用此来判断内存目前的 <strong>使用情况</strong> 以及 <strong>垃圾回收</strong> 情况。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -heap 11368</span><br><span class="line">Attaching to process ID 11368, please <span class="built_in">wait</span>...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.101-b13</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Parallel GC with 2 thread(s)</span><br><span class="line"></span><br><span class="line">Heap Configuration:</span><br><span class="line">   MinHeapFreeRatio         = 0</span><br><span class="line">   MaxHeapFreeRatio         = 100</span><br><span class="line">   MaxHeapSize              = 2684354560 (2560.0MB)</span><br><span class="line">   NewSize                  = 1073741824 (1024.0MB)</span><br><span class="line">   MaxNewSize               = 1073741824 (1024.0MB)</span><br><span class="line">   OldSize                  = 1610612736 (1536.0MB)</span><br><span class="line">   NewRatio                 = 2</span><br><span class="line">   SurvivorRatio            = 8</span><br><span class="line">   MetaspaceSize            = 21807104 (20.796875MB)</span><br><span class="line">   CompressedClassSpaceSize = 1073741824 (1024.0MB)</span><br><span class="line">   MaxMetaspaceSize         = 17592186044415 MB</span><br><span class="line">   G1HeapRegionSize         = 0 (0.0MB)</span><br><span class="line"></span><br><span class="line">Heap Usage:</span><br><span class="line">PS Young Generation</span><br><span class="line">Eden Space:</span><br><span class="line">   capacity = 852492288 (813.0MB)</span><br><span class="line">   used     = 420427144 (400.95056915283203MB)</span><br><span class="line">   free     = 432065144 (412.04943084716797MB)</span><br><span class="line">   49.31741317993014% used</span><br><span class="line">From Space:</span><br><span class="line">   capacity = 113770496 (108.5MB)</span><br><span class="line">   used     = 2299712 (2.19317626953125MB)</span><br><span class="line">   free     = 111470784 (106.30682373046875MB)</span><br><span class="line">   2.021360617079493% used</span><br><span class="line">To Space:</span><br><span class="line">   capacity = 107479040 (102.5MB)</span><br><span class="line">   used     = 0 (0.0MB)</span><br><span class="line">   free     = 107479040 (102.5MB)</span><br><span class="line">   0.0% used</span><br><span class="line">PS Old Generation</span><br><span class="line">   capacity = 1610612736 (1536.0MB)</span><br><span class="line">   used     = 50883368 (48.526161193847656MB)</span><br><span class="line">   free     = 1559729368 (1487.4738388061523MB)</span><br><span class="line">   3.1592552860577903% used</span><br><span class="line"></span><br><span class="line">27595 interned Strings occupying 3138384 bytes.</span><br></pre></td></tr></table></figure>
<p>这里主要对 <code>heap configuration</code> 的参数列表说明一下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">对应启动参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">MinHeapFreeRatio</td>
<td style="text-align:left">-XX:MinHeapFreeRatio</td>
<td style="text-align:left">JVM堆最小空闲比率(default 40)</td>
</tr>
<tr>
<td style="text-align:left">MaxHeapFreeRatio</td>
<td style="text-align:left">-XX:MaxHeapFreeRatio</td>
<td style="text-align:left">JVM堆最大空闲比率(default 70)</td>
</tr>
<tr>
<td style="text-align:left">MaxHeapSize</td>
<td style="text-align:left">XX:Xmx</td>
<td style="text-align:left">JVM堆的最大大小</td>
</tr>
<tr>
<td style="text-align:left">NewSize</td>
<td style="text-align:left">-XX:NewSize</td>
<td style="text-align:left">JVM堆新生代的默认（初始化）大小</td>
</tr>
<tr>
<td style="text-align:left">MaxNewSize</td>
<td style="text-align:left">-XX:MaxNewSize</td>
<td style="text-align:left">JVM堆新生代的最大大小</td>
</tr>
<tr>
<td style="text-align:left">OldSize</td>
<td style="text-align:left">-XX:OldSize</td>
<td style="text-align:left">JVM堆老年代的默认（初始化）大小</td>
</tr>
<tr>
<td style="text-align:left">NewRatio</td>
<td style="text-align:left">-XX:NewRatio</td>
<td style="text-align:left">JVM堆新生代和老年代的大小比例</td>
</tr>
<tr>
<td style="text-align:left">SurvivorRatio</td>
<td style="text-align:left">-XX:SurvivorRatio</td>
<td style="text-align:left">JVM堆年轻代中Eden区与Survivor区的大小比值</td>
</tr>
<tr>
<td style="text-align:left">MetaspaceSize</td>
<td style="text-align:left">-XX:MetaspaceSize</td>
<td style="text-align:left">JVM元空间（metaspace）初始化大小</td>
</tr>
<tr>
<td style="text-align:left">MaxMetaspaceSize</td>
<td style="text-align:left">-XX:MaxMetaspaceSize</td>
<td style="text-align:left">JVM元空间（metaspace）最大大小</td>
</tr>
<tr>
<td style="text-align:left">CompressedClass SpaceSize</td>
<td style="text-align:left">-XX:CompressedClass SpaceSize</td>
<td style="text-align:left">JVM类指针压缩空间大小, 默认为1G</td>
</tr>
<tr>
<td style="text-align:left">G1HeapRegionSize</td>
<td style="text-align:left">-XX:G1HeapRegionSize</td>
<td style="text-align:left">使用G1垃圾回收器时单个Region的大小，取值为1M至32M</td>
</tr>
</tbody>
</table>
<h4 id="3-2-histo"><a href="#3-2-histo" class="headerlink" title="3.2. histo"></a>3.2. histo</h4><p>打印堆的 <strong>对象统计</strong>，包括 <strong>对象实例数</strong>、<strong>内存大小</strong> 等等。因为在 <code>histo:live</code> 前会进行 <code>full gc</code>，如果带上 <code>live</code> 则只统计 <strong>活对象</strong>。不加 <code>live</code> 的堆大小要大于加 <code>live</code> 堆的大小。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -histo:live 12498</span><br><span class="line"> num     <span class="comment">#instances         #bytes  class name</span></span><br><span class="line">----------------------------------------------</span><br><span class="line">   1:         50358        7890344  [C</span><br><span class="line">   2:         22887        2014056  java.lang.reflect.Method</span><br><span class="line">   3:          3151        1485512  [B</span><br><span class="line">   4:         49267        1182408  java.lang.String</span><br><span class="line">   5:          7836         871384  java.lang.Class</span><br><span class="line">   6:         24149         772768  java.util.concurrent.ConcurrentHashMap<span class="variable">$Node</span></span><br><span class="line">   7:         20785         482256  [Ljava.lang.Class;</span><br><span class="line">   8:          8357         435248  [Ljava.lang.Object;</span><br><span class="line">   9:         10035         401400  java.util.LinkedHashMap<span class="variable">$Entry</span></span><br><span class="line">  10:          4803         369488  [Ljava.util.HashMap<span class="variable">$Node</span>;</span><br><span class="line">  11:         10763         344416  java.util.HashMap<span class="variable">$Node</span></span><br><span class="line">  12:          5205         291480  java.util.LinkedHashMap</span><br><span class="line">  13:          3055         219960  java.lang.reflect.Field</span><br><span class="line">  14:           120         193408  [Ljava.util.concurrent.ConcurrentHashMap<span class="variable">$Node</span>;</span><br><span class="line">  15:         11224         179584  java.lang.Object</span><br><span class="line">  16:          1988         146152  [Ljava.lang.reflect.Method;</span><br><span class="line">  17:          3036         145728  org.aspectj.weaver.reflect.ShadowMatchImpl</span><br><span class="line">  18:          1771         141680  java.lang.reflect.Constructor</span><br><span class="line">  19:          4903         117672  org.springframework.core.MethodClassKey</span><br><span class="line">  20:          3263         104416  java.lang.ref.WeakReference</span><br><span class="line">  21:          2507         100280  java.lang.ref.SoftReference</span><br><span class="line">  22:          2523          97600  [I</span><br><span class="line">  23:          3036          97152  org.aspectj.weaver.patterns.ExposedState</span><br><span class="line">  24:          2072          95280  [Ljava.lang.String;</span><br><span class="line">  25:           954          91584  org.springframework.beans.GenericTypeAwarePropertyDescriptor</span><br><span class="line">  26:          1633          91448  java.lang.Class<span class="variable">$ReflectionData</span></span><br><span class="line">  27:          3142          90520  [Z</span><br><span class="line">  28:          1671          80208  java.util.HashMap</span><br><span class="line">  29:          3244          77856  java.util.ArrayList</span><br><span class="line">  30:          3037          72880  [Lorg.aspectj.weaver.ast.Var;</span><br><span class="line">  31:          1809          72360  java.util.WeakHashMap<span class="variable">$Entry</span></span><br><span class="line">  32:          1967          62944  java.util.LinkedList</span><br></pre></td></tr></table></figure>
<p>其中，<code>class name</code> 是 <strong>对象类型</strong>，对象 <strong>缩写类型</strong> 与 <strong>真实类型</strong> 的对应说明如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">对象缩写类型</th>
<th style="text-align:left">对象真实类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">B</td>
<td style="text-align:left">byte</td>
</tr>
<tr>
<td style="text-align:left">C</td>
<td style="text-align:left">char</td>
</tr>
<tr>
<td style="text-align:left">D</td>
<td style="text-align:left">double</td>
</tr>
<tr>
<td style="text-align:left">F</td>
<td style="text-align:left">float</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">int</td>
</tr>
<tr>
<td style="text-align:left">J</td>
<td style="text-align:left">long</td>
</tr>
<tr>
<td style="text-align:left">Z</td>
<td style="text-align:left">boolean</td>
</tr>
<tr>
<td style="text-align:left">[</td>
<td style="text-align:left">数组，如[I表示int[]</td>
</tr>
<tr>
<td style="text-align:left">[L+类名</td>
<td style="text-align:left">其他对象</td>
</tr>
</tbody>
</table>
<h4 id="3-3-dump"><a href="#3-3-dump" class="headerlink" title="3.3. dump"></a>3.3. dump</h4><p><code>dump</code> 用于导出内存转储快照。常用的方式是通过 <code>jmap</code> 把进程 <strong>内存使用情况</strong> <code>dump</code> 到文件中，再用 <code>jhat</code> 分析查看。<code>jmap</code> 进行 <code>dump</code> 的命令格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap -dump:format=b,file=dumpFileName</span><br></pre></td></tr></table></figure>
<p>参数含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">dump</td>
<td style="text-align:left">堆到文件</td>
</tr>
<tr>
<td style="text-align:left">format</td>
<td style="text-align:left">指定输出格式</td>
</tr>
<tr>
<td style="text-align:left">live</td>
<td style="text-align:left">指明是活着的对象</td>
</tr>
<tr>
<td style="text-align:left">file</td>
<td style="text-align:left">指定文件名</td>
</tr>
</tbody>
</table>
<ul>
<li>通过 <code>jmap</code> 导出 <strong>内存快照</strong>，文件命名为 <code>dump.dat</code>：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jmap -dump:format=b,file=dump.dat 12498</span><br><span class="line">Dumping heap to /Users/XXX/dump.dat ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure>
<p>导出的 <code>dump</code> 文件可以通过 <code>MAT</code>、<code>VisualVM</code> 和 <code>jhat</code> 等工具查看分析，后面会详细介绍。</p>
<h3 id="4-jhat堆快照分析工具"><a href="#4-jhat堆快照分析工具" class="headerlink" title="4. jhat堆快照分析工具"></a>4. jhat堆快照分析工具</h3><p><code>jhat</code>（<code>JVM Heap Analysis Tool</code>）命令通常与 <code>jmap</code> 搭配使用，用来分析 <code>jmap</code> 生成的 <code>dump</code>。<code>jhat</code> 内置了一个微型的 <code>HTTP/HTML</code> <strong>服务器</strong>，生成 <code>dump</code> 的分析结果后，可以在浏览器中查看。</p>
<blockquote>
<p>注意：一般不会直接在 <strong>服务器</strong> 上 <strong>进行分析</strong>，因为使用 <code>jhat</code> 是一个 <strong>耗时</strong> 并且 <strong>耗费硬件资源</strong> 的过程，一般的做法是，把 <strong>服务器</strong> 生成的 <code>dump</code> 文件复制到 <strong>本地</strong> 或 <strong>其他机器</strong> 上进行分析。</p>
</blockquote>
<p>命令格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Usage:  jhat [-stack &lt;bool&gt;] [-refs &lt;bool&gt;] [-port &lt;port&gt;] [-baseline &lt;file&gt;] [-debug &lt;int&gt;] [-version] [-h|-<span class="built_in">help</span>] &lt;file&gt;</span><br><span class="line"></span><br><span class="line">	-J&lt;flag&gt;          Pass &lt;flag&gt; directly to the runtime system. For</span><br><span class="line">			  example, -J-mx512m to use a maximum heap size of 512MB</span><br><span class="line">	-stack <span class="literal">false</span>:     Turn off tracking object allocation call stack.</span><br><span class="line">	-refs <span class="literal">false</span>:      Turn off tracking of references to objects</span><br><span class="line">	-port &lt;port&gt;:     Set the port <span class="keyword">for</span> the HTTP server.  Defaults to 7000</span><br><span class="line">	-exclude &lt;file&gt;:  Specify a file that lists data members that should</span><br><span class="line">			  be excluded from the reachableFrom query.</span><br><span class="line">	-baseline &lt;file&gt;: Specify a baseline object dump.  Objects <span class="keyword">in</span></span><br><span class="line">			  both heap dumps with the same ID and same class will</span><br><span class="line">			  be marked as not being <span class="string">"new"</span>.</span><br><span class="line">	-debug &lt;int&gt;:     Set debug level.</span><br><span class="line">			    0:  No debug output</span><br><span class="line">			    1:  Debug hprof file parsing</span><br><span class="line">			    2:  Debug hprof file parsing, no server</span><br><span class="line">	-version          Report version number</span><br><span class="line">	-h|-<span class="built_in">help</span>          Print this <span class="built_in">help</span> and <span class="built_in">exit</span></span><br><span class="line">	&lt;file&gt;            The file to <span class="built_in">read</span></span><br></pre></td></tr></table></figure>
<p>参数含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数值默认值</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">stack</td>
<td style="text-align:left">true</td>
<td style="text-align:left">关闭 <strong>对象分配调用栈跟踪</strong>。如果分配位置信息在堆转储中不可用。则必须将此标志设置为false。</td>
</tr>
<tr>
<td style="text-align:left">refs</td>
<td style="text-align:left">true</td>
<td style="text-align:left">关闭 <strong>对象引用跟踪</strong>。默认情况下，返回的指针是指向其他特定对象的对象。如 <strong>反向链接</strong> 或 <strong>输入引用</strong>，会统计/计算堆中的所有对象</td>
</tr>
<tr>
<td style="text-align:left">port</td>
<td style="text-align:left">7000</td>
<td style="text-align:left">设置jhat HTTP server的端口号</td>
</tr>
<tr>
<td style="text-align:left">exclude</td>
<td style="text-align:left">—</td>
<td style="text-align:left">指定对象查询时需要排除的数据成员列表文件</td>
</tr>
<tr>
<td style="text-align:left">baseline</td>
<td style="text-align:left">—</td>
<td style="text-align:left">指定一个 <strong>基准堆转储</strong>。在两个heap dumps中有相同object ID的对象时，会被标记为不是新的，其他对象被标记为新的。在比较两个不同的堆转储时很有用</td>
</tr>
<tr>
<td style="text-align:left">debug</td>
<td style="text-align:left">0</td>
<td style="text-align:left">设置debug级别，0表示不输出调试信息。值越大则表示输出更详细的debug信息</td>
</tr>
<tr>
<td style="text-align:left">version</td>
<td style="text-align:left">—</td>
<td style="text-align:left">启动后只显示版本信息就退出</td>
</tr>
<tr>
<td style="text-align:left">J</td>
<td style="text-align:left">—</td>
<td style="text-align:left">jhat命令实际上会启动一个JVM来执行，通过-J可以在启动JVM时传入一些 <strong>启动参数</strong>。例如， -J-Xmx512m则指定运行jhat 的Java虚拟机使用的最大堆内存为512MB。</td>
</tr>
</tbody>
</table>
<ul>
<li>前面提到，通过 <code>jmap dump</code> 出来的文件可以用 <code>MAT</code>、<code>VisualVM</code> 等工具查看，这里我们用 <code>jhat</code> 查看：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ jhat -port 7000 dump.dat</span><br><span class="line">Reading from dump.dat...</span><br><span class="line">Dump file created Sun Aug 12 12:15:02 CST 2018</span><br><span class="line">Snapshot <span class="built_in">read</span>, resolving...</span><br><span class="line">Resolving 1788693 objects...</span><br><span class="line">Chasing references, expect 357 dots.....................................................................................................................................................................................................................................................................................................................................................................</span><br><span class="line">Eliminating duplicate references.....................................................................................................................................................................................................................................................................................................................................................................</span><br><span class="line">Snapshot resolved.</span><br><span class="line">Started HTTP server on port 7000</span><br><span class="line">Server is ready.</span><br></pre></td></tr></table></figure>
<ul>
<li>打开浏览器，输入 <code>http://localhost:7000</code>，查看 <code>jhat</code> 的分析报表页面：</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/12/1652e8d753092849?w=2880&amp;h=1696&amp;f=png&amp;s=769053" alt=""></p>
<ul>
<li>可以按照 <strong>包名称</strong> 查看项目模块中的具体 <strong>对象示例</strong>：</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/12/1652e8d752efb04c?w=2880&amp;h=1726&amp;f=png&amp;s=769036" alt=""></p>
<p>除此之外，报表分析的最后一页，还提供了一些扩展查询：</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/12/1652e8d752fbdf18?w=2880&amp;h=468&amp;f=png&amp;s=120137" alt=""></p>
<ul>
<li>显示所有的 <code>Root</code> 集合；</li>
<li>显示所有 <code>class</code> 的当前 <strong>对象实例数量</strong>（包含 <code>JVM</code> 平台相关类）；</li>
<li>显示所有 <code>class</code> 的当前 <strong>对象实例数量</strong>（除去 <code>JVM</code> 平台相关类）；</li>
<li>显示 <strong>堆内存</strong> 中实例对象的 <strong>统计直方图</strong>（和直接使用 <code>jmap</code> 没有区别）；</li>
<li>显示 <code>finalizer</code> 虚拟机 <strong>二次回收</strong> 的信息摘要；</li>
<li>执行 <code>jhat</code> 提供的 <strong>对象查询语言</strong>（<code>OQL</code>）获取指定对象的实例信息。</li>
</ul>
<blockquote>
<p>注意：<code>jhat</code> 支持根据某些条件来 <strong>过滤</strong> 或 <strong>查询</strong> 堆的对象。可以在 <code>jhat</code> 的 <code>html</code> 页面中执行 <code>OQL</code> 语句，来查询符合条件的对象。<code>OQL</code> `具体的语法可以直接访问 <a href="http://localhost:7000/oqlhelp。" target="_blank" rel="noopener">http://localhost:7000/oqlhelp。</a></p>
</blockquote>
<p>在具体排查时，需要结合代码，观察是否 <strong>大量应该被回收</strong> 的对象 <strong>一直被引用</strong>，或者是否有 <strong>占用内存特别大</strong> 的对象 <strong>无法被回收</strong>。</p>
<h3 id="5-jstack堆栈跟踪工具"><a href="#5-jstack堆栈跟踪工具" class="headerlink" title="5. jstack堆栈跟踪工具"></a>5. jstack堆栈跟踪工具</h3><p><code>jstack</code> 用于生成 <code>java</code> 虚拟机当前时刻的 <strong>线程快照</strong>。<strong>线程快照</strong> 是当前 <code>java</code> 虚拟机内 <strong>每一条线程</strong> 正在执行的 <strong>方法堆栈</strong> 的 <strong>集合</strong>。生成线程快照的主要目的是定位线程出现 <strong>长时间停顿</strong> 的原因，如 <strong>线程间死锁</strong>、<strong>死循环</strong>、<strong>请求外部资源</strong> 导致的 <strong>长时间等待</strong> 等等。</p>
<p>线程出现 <strong>停顿</strong> 的时候，通过 <code>jstack</code> 来查看 <strong>各个线程</strong> 的 <strong>调用堆栈</strong>，就可以知道没有响应的线程到底在后台做什么事情，或者等待什么资源。如果 <code>java</code> 程序 <strong>崩溃</strong> 生成 <code>core</code> <strong>文件</strong>，<code>jstack</code> 工具可以通过 <code>core</code> 文件获取 <code>java stack</code> 和 <code>native stack</code> 的信息，从而定位程序崩溃的原因。</p>
<p>命令格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">    jstack [-l] &lt;pid&gt;</span><br><span class="line">        (to connect to running process)</span><br><span class="line">    jstack -F [-m] [-l] &lt;pid&gt;</span><br><span class="line">        (to connect to a hung process)</span><br><span class="line">    jstack [-m] [-l] &lt;executable&gt; &lt;core&gt;</span><br><span class="line">        (to connect to a core file)</span><br><span class="line">    jstack [-m] [-l] [server_id@]&lt;remote server IP or hostname&gt;</span><br><span class="line">        (to connect to a remote debug server)</span><br></pre></td></tr></table></figure>
<p>参数含义如下：</p>
<ul>
<li>pid：本地 <code>jvm</code> 服务的进程 <code>ID</code>；</li>
<li>executable core：打印 <strong>堆栈跟踪</strong> 的核心文件；</li>
<li>remote server IP/hostname：远程 <code>debug</code> 服务的 <strong>主机名</strong> 或 <code>IP</code> 地址；</li>
<li>server id：远程 <code>debug</code> 服务的 <strong>进程</strong> <code>ID</code>。</li>
</ul>
<p>参数选项说明如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">参数含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">F</td>
<td style="text-align:left">当正常输出请求 <strong>不被响应</strong> 时，强制输出 <strong>线程堆栈</strong></td>
</tr>
<tr>
<td style="text-align:left">l</td>
<td style="text-align:left">除堆栈外，显示关于 <strong>锁的附加信息</strong></td>
</tr>
<tr>
<td style="text-align:left">m</td>
<td style="text-align:left">如果调用到 <strong>本地方法</strong> 的话，可以显示 <code>C/C++</code> 的堆栈</td>
</tr>
</tbody>
</table>
<blockquote>
<p>注意：在实际运行中，往往一次 <code>dump</code> 的信息，还不足以确认问题。建议产生三次 <code>dump</code> 信息，如果每次 <code>dump</code> 都指向同一个问题，才能确定问题的典型性。</p>
</blockquote>
<h4 id="5-1-系统线程状态"><a href="#5-1-系统线程状态" class="headerlink" title="5.1. 系统线程状态"></a>5.1. 系统线程状态</h4><p>在 <code>dump</code> 文件里，值得关注的 <strong>线程状态</strong> 有：</p>
<ol>
<li>死锁：Deadlock（重点关注）</li>
<li>执行中：Runnable</li>
<li>等待资源：Waiting on condition（重点关注） </li>
<li>等待获取监视器：Waiting on monitor entry（重点关注）</li>
<li>暂停：Suspended</li>
<li>对象等待中：Object.wait() 或 TIMED_WAITING</li>
<li>阻塞：Blocked（重点关注）  </li>
<li>停止：Parked</li>
</ol>
<p>具体的含义如下所示：</p>
<p><strong>(a). Deadlock</strong></p>
<blockquote>
<p><strong>死锁线程</strong>，一般指多个线程调用期间发生 <strong>资源的相互占用</strong>，导致一直等待无法释放的情况。</p>
</blockquote>
<p><strong>(b). Runnable</strong></p>
<blockquote>
<p>一般指该线程正在 <strong>执行状态</strong> 中，该线程占用了 <strong>资源</strong>，正在 <strong>处理某个请求</strong>。有可能正在传递 <code>SQL</code> 到数据库执行，有可能在对某个文件操作，有可能进行数据类型等转换。</p>
</blockquote>
<p><strong>(c). Waiting on condition</strong></p>
<blockquote>
<p>该状态在线程等待 <strong>某个条件</strong> 的发生。具体是什么原因，可以结合 <code>stacktrace</code> 来分析。线程处于这种 <strong>等待状态</strong>，一旦有数据准备好读之后，线程会重新激活，读取并处理数据。</p>
</blockquote>
<p>线程正处于等待资源或等待某个条件的发生，具体的原因需要结合下面堆栈信息进行分析。</p>
<ul>
<li><p>如果 <strong>堆栈信息</strong> 明确是 <strong>应用代码</strong>，则证明该线程正在 <strong>等待资源</strong>。一般是大量 <strong>读取某种资源</strong> 且该资源采用了 <strong>资源锁</strong> 的情况下，线程进入 <strong>等待状态</strong>。</p>
</li>
<li><p>如果发现有 <strong>大量的线程</strong> 都正处于这种状态，并且堆栈信息中得知正在 <strong>等待网络读写</strong>，这是因为 <strong>网络阻塞</strong> 导致 <strong>线程无法执行</strong>，很有可能是一个 <strong>网络瓶颈</strong> 的征兆：</p>
<ul>
<li>网络非常 <strong>繁忙</strong>，几乎消耗了所有的带宽，仍然有大量数据等待网络读写；</li>
<li>网络可能是 <strong>空闲的</strong>，但由于 <strong>路由</strong> 或 <strong>防火墙</strong> 等原因，导致包无法正常到达。</li>
</ul>
</li>
<li><p>还有一种常见的情况是该线程在 <code>sleep</code>，等待 <code>sleep</code> 的时间到了，将被唤醒。</p>
</li>
</ul>
<p><strong>(d). Locked</strong></p>
<blockquote>
<p><strong>线程阻塞</strong>，是指当前线程执行过程中，所需要的资源 <strong>长时间等待</strong> 却 <strong>一直未能获取到</strong>，被容器的线程管理器标识为 <strong>阻塞状态</strong>，可以理解为 <strong>等待资源超时</strong> 的线程。</p>
</blockquote>
<p><strong>(e). Waiting for monitor entry 和 in Object.wait()</strong></p>
<blockquote>
<p><code>Monitor</code> 是 <code>Java</code> 中实现线程之间的 <strong>互斥与协作</strong> 的主要手段，它可以看成是 <strong>对象</strong> 或者 <code>Class</code> 的 <strong>锁</strong>。每一个对象都有一个 <code>monitor</code>。</p>
</blockquote>
<h4 id="5-1-死锁示例"><a href="#5-1-死锁示例" class="headerlink" title="5.1. 死锁示例"></a>5.1. 死锁示例</h4><p>下面给出一个 <strong>死锁</strong> 的案例，在 <code>IntLock</code> 中定义了两个静态的 <strong>可重入锁</strong> 实例，在主方法中声明了 <strong>两个线程</strong> 对 <strong>两把锁</strong> 进行资源竞争。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeadLockRunner</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        IntLock r1 = <span class="keyword">new</span> IntLock(<span class="number">1</span>);</span><br><span class="line">        IntLock r2 = <span class="keyword">new</span> IntLock(<span class="number">2</span>);</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(r1);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(r2);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IntLock</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> ReentrantLock lock1 = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> ReentrantLock lock2 = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> lock;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">IntLock</span><span class="params">(<span class="keyword">int</span> lock)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.lock = lock;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (lock == <span class="number">1</span>) &#123;</span><br><span class="line">                    lock1.lock();</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    lock2.lock();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    lock2.lock();</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    lock1.lock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (lock1.isHeldByCurrentThread()) &#123;</span><br><span class="line">                    lock1.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (lock2.isHeldByCurrentThread()) &#123;</span><br><span class="line">                    lock2.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-2-dump日志分析"><a href="#5-2-dump日志分析" class="headerlink" title="5.2. dump日志分析"></a>5.2. dump日志分析</h4><p>启动 <code>DeadLockRunner</code> 的 <code>main()</code> 方法，使用 <code>jps</code> 查看阻塞的 <code>jvm</code> 进程的 <code>id</code>，然后使用 <code>jstack</code> 查看 <strong>线程堆栈信息</strong>，可以发现两个线程相互 <strong>竞争资源</strong>，<strong>出现死锁</strong>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">$ jstack -l 15584</span><br><span class="line">2018-08-12 20:35:40</span><br><span class="line">Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.172-b11 mixed mode):</span><br><span class="line"></span><br><span class="line">// 省略...</span><br><span class="line"></span><br><span class="line">Found one Java-level deadlock:</span><br><span class="line">=============================</span><br><span class="line"><span class="string">"Thread-1"</span>:</span><br><span class="line">  waiting <span class="keyword">for</span> ownable synchronizer 0x000000076ad61180, (a java.util.concurrent.locks.ReentrantLock<span class="variable">$NonfairSync</span>),</span><br><span class="line">  <span class="built_in">which</span> is held by <span class="string">"Thread-0"</span></span><br><span class="line"><span class="string">"Thread-0"</span>:</span><br><span class="line">  waiting <span class="keyword">for</span> ownable synchronizer 0x000000076ad611b0, (a java.util.concurrent.locks.ReentrantLock<span class="variable">$NonfairSync</span>),</span><br><span class="line">  <span class="built_in">which</span> is held by <span class="string">"Thread-1"</span></span><br><span class="line"></span><br><span class="line">Java stack information <span class="keyword">for</span> the threads listed above:</span><br><span class="line">===================================================</span><br><span class="line"><span class="string">"Thread-1"</span>:</span><br><span class="line">	at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">	- parking to <span class="built_in">wait</span> <span class="keyword">for</span>  &lt;0x000000076ad61180&gt; (a java.util.concurrent.locks.ReentrantLock<span class="variable">$NonfairSync</span>)</span><br><span class="line">	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class="line">	at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)</span><br><span class="line">	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:870)</span><br><span class="line">	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1199)</span><br><span class="line">	at java.util.concurrent.locks.ReentrantLock<span class="variable">$NonfairSync</span>.lock(ReentrantLock.java:209)</span><br><span class="line">	at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:285)</span><br><span class="line">	at io.ostenant.deadlock.DeadLockRunner<span class="variable">$IntLock</span>.run(DeadLockRunner.java:47)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"><span class="string">"Thread-0"</span>:</span><br><span class="line">	at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">	- parking to <span class="built_in">wait</span> <span class="keyword">for</span>  &lt;0x000000076ad611b0&gt; (a java.util.concurrent.locks.ReentrantLock<span class="variable">$NonfairSync</span>)</span><br><span class="line">	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class="line">	at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)</span><br><span class="line">	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:870)</span><br><span class="line">	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1199)</span><br><span class="line">	at java.util.concurrent.locks.ReentrantLock<span class="variable">$NonfairSync</span>.lock(ReentrantLock.java:209)</span><br><span class="line">	at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:285)</span><br><span class="line">	at io.ostenant.deadlock.DeadLockRunner<span class="variable">$IntLock</span>.run(DeadLockRunner.java:37)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line">Found 1 deadlock.</span><br></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>周志明，深入理解Java虚拟机：JVM高级特性与最佳实践，机械工业出版社</p>
<hr>
<p>欢迎关注技术公众号：零壹技术栈</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/4/16502c7bd1fd0856?w=258&amp;h=258&amp;f=jpeg&amp;s=16109" alt="零壹技术栈"></p>
<p>本帐号将持续分享后端技术干货，包括虚拟机基础，多线程编程，高性能框架，异步、缓存和消息中间件，分布式和微服务，架构学习和进阶等学习资料和文章。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



    <div class="a2a_kit a2a_default_style">
    <a class="a2a_dd" href="https://www.addtoany.com/share">Share</a>
    <span class="a2a_divider"></span>
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_google_plus"></a>
    <a class="a2a_button_pinterest"></a>
    <a class="a2a_button_tumblr"></a>
</div>
<script type="text/javascript" src="//static.addtoany.com/menu/page.js"></script>
<style>
    .a2a_menu {
        border-radius: 4px;
    }
    .a2a_menu a {
        margin: 2px 0;
        font-size: 14px;
        line-height: 16px;
        border-radius: 4px;
        color: inherit !important;
        font-family: 'Microsoft Yahei';
    }
    #a2apage_dropdown {
        margin: 10px 0;
    }
    .a2a_mini_services {
        padding: 10px;
    }
    a.a2a_i,
    i.a2a_i {
        width: 122px;
        line-height: 16px;
    }
    a.a2a_i .a2a_svg,
    a.a2a_more .a2a_svg {
        width: 16px;
        height: 16px;
        line-height: 16px;
        vertical-align: top;
        background-size: 16px;
    }
    a.a2a_i {
        border: none !important;
    }
    a.a2a_menu_show_more_less {
        margin: 0;
        padding: 10px 0;
        line-height: 16px;
    }
    .a2a_mini_services:after{content:".";display:block;height:0;clear:both;visibility:hidden}
    .a2a_mini_services{*+height:1%;}
</style>

</div>

            
    
        <a href="https://ostenant.coding.me/2018/08/06/JVM系列(七) - JVM线上监控工具/#comments" class="article-comment-link">评论</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2018/08/16/深入剖析Redis系列(一) - Redis入门简介与主从搭建/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    深入剖析Redis系列(一) - Redis入门简介与主从搭建
                
            </div>
        </a>
    
    
        <a href="/2018/08/03/JVM系列(六) - JVM垃圾回收器/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">JVM系列(六) - JVM垃圾回收器</div>
        </a>
    
</nav>


    
</article>


    
    
        <section id="comments">
    <div id="lv-container" data-id="city" data-uid=MTAyMC8zNzE2NC8xMzY5OA==></div>
</section>
    

</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Redis学习系列/">Redis学习系列</a></p>
                            <p class="item-title"><a href="/2018/08/17/深入剖析Redis系列(二) - Redis哨兵模式与高可用集群/" class="title">深入剖析Redis系列(二) - Redis哨兵模式与高可用集群</a></p>
                            <p class="item-date"><time datetime="2018-08-17T15:02:00.000Z" itemprop="datePublished">2018-08-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Redis学习系列/">Redis学习系列</a></p>
                            <p class="item-title"><a href="/2018/08/16/深入剖析Redis系列(一) - Redis入门简介与主从搭建/" class="title">深入剖析Redis系列(一) - Redis入门简介与主从搭建</a></p>
                            <p class="item-date"><time datetime="2018-08-16T05:36:00.000Z" itemprop="datePublished">2018-08-16</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/JAVA虚拟机系列/">JAVA虚拟机系列</a></p>
                            <p class="item-title"><a href="/2018/08/06/JVM系列(七) - JVM线上监控工具/" class="title">JVM系列(七) - JVM线上监控工具</a></p>
                            <p class="item-date"><time datetime="2018-08-06T07:21:00.000Z" itemprop="datePublished">2018-08-06</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/JAVA虚拟机系列/">JAVA虚拟机系列</a></p>
                            <p class="item-title"><a href="/2018/08/03/JVM系列(六) - JVM垃圾回收器/" class="title">JVM系列(六) - JVM垃圾回收器</a></p>
                            <p class="item-date"><time datetime="2018-08-02T22:58:00.000Z" itemprop="datePublished">2018-08-03</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/高并发系统系列/">高并发系统系列</a></p>
                            <p class="item-title"><a href="/2018/07/15/浅谈Nginx服务器的内部核心架构设计/" class="title">浅谈Nginx服务器的内部核心架构设计</a></p>
                            <p class="item-date"><time datetime="2018-07-15T10:50:00.000Z" itemprop="datePublished">2018-07-15</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker学习系列/">Docker学习系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA编程进阶系列/">JAVA编程进阶系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA虚拟机系列/">JAVA虚拟机系列</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA设计模式系列/">JAVA设计模式系列</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JDK1-8编程系列/">JDK1.8编程系列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java编程基础系列/">Java编程基础系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java编程进阶系列/">Java编程进阶系列</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL学习系列/">MySQL学习系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RPC通信框架系列/">RPC通信框架系列</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis学习系列/">Redis学习系列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RxJava异步框架系列/">RxJava异步框架系列</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Reactive编程系列/">Spring Reactive编程系列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/任务调度框架系列/">任务调度框架系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式系列/">分布式系列</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/加密算法系列/">加密算法系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/实战Spring-Boot-2-0系列/">实战Spring Boot 2.0系列</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微服务系列/">微服务系列</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术知识图谱/">技术知识图谱</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构学习系列/">架构学习系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/测试框架系列/">测试框架系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/消息队列系列/">消息队列系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络协议系列/">网络协议系列</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/认证与授权系列/">认证与授权系列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/高并发系统系列/">高并发系统系列</a><span class="category-list-count">2</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/2PC/">2PC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/3PC/">3PC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AES/">AES</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ActiveMQ/">ActiveMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Adapter/">Adapter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/">Apache</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BASE/">BASE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Builder/">Builder</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAP/">CAP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CentOS/">CentOS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Consul/">Consul</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Consul-template/">Consul-template</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DES/">DES</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker-Compose/">Docker Compose</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Filter/">Filter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTPS/">HTTPS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Interceptor/">Interceptor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK/">JDK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK1-8/">JDK1.8</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT/">JWT</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/">Kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Listener/">Listener</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MD5/">MD5</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mockito/">Mockito</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NIO/">NIO</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth/">OAuth</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth-2-0/">OAuth 2.0</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Paxos/">Paxos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Prototype/">Prototype</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Quartz/">Quartz</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPC/">RPC</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RSA/">RSA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/">RabbitMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raft/">Raft</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reactive-Streams/">Reactive Streams</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reactor/">Reactor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis-Sentinel/">Redis Sentinel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reference/">Reference</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Registrator/">Registrator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RocketMQ/">RocketMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxJava/">RxJava</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SAML/">SAML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SHA1/">SHA1</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SOFA-Boot/">SOFA-Boot</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SOFA-RPC/">SOFA-RPC</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSO/">SSO</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ScheduledExecutorService/">ScheduledExecutorService</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Servlet/">Servlet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Session/">Session</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Singleton/">Singleton</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Boot-2-0/">Spring Boot 2.0</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Cloud/">Spring Cloud</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Task/">Spring Task</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-WebFlux/">Spring WebFlux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thrift/">Thrift</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Timer/">Timer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unique-ID/">Unique ID</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/">Web</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/">WebSocket</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/一致性哈希/">一致性哈希</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/主从复制/">主从复制</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式存储/">分布式存储</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分片/">分片</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/反向代理/">反向代理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/反模式/">反模式</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/定时任务/">定时任务</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/异步/">异步</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微服务/">微服务</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/服务器/">服务器</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/消息队列/">消息队列</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/负载均衡/">负载均衡</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/限流/">限流</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高并发/">高并发</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高性能/">高性能</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/2PC/" style="font-size: 10px;">2PC</a> <a href="/tags/3PC/" style="font-size: 10px;">3PC</a> <a href="/tags/AES/" style="font-size: 10px;">AES</a> <a href="/tags/ActiveMQ/" style="font-size: 10px;">ActiveMQ</a> <a href="/tags/Adapter/" style="font-size: 10px;">Adapter</a> <a href="/tags/Android/" style="font-size: 12.86px;">Android</a> <a href="/tags/Apache/" style="font-size: 12.86px;">Apache</a> <a href="/tags/BASE/" style="font-size: 10px;">BASE</a> <a href="/tags/Builder/" style="font-size: 10px;">Builder</a> <a href="/tags/CAP/" style="font-size: 10px;">CAP</a> <a href="/tags/CentOS/" style="font-size: 10px;">CentOS</a> <a href="/tags/Consul/" style="font-size: 11.43px;">Consul</a> <a href="/tags/Consul-template/" style="font-size: 10px;">Consul-template</a> <a href="/tags/DES/" style="font-size: 10px;">DES</a> <a href="/tags/Docker/" style="font-size: 15.71px;">Docker</a> <a href="/tags/Docker-Compose/" style="font-size: 10px;">Docker Compose</a> <a href="/tags/Filter/" style="font-size: 10px;">Filter</a> <a href="/tags/Gradle/" style="font-size: 10px;">Gradle</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/Interceptor/" style="font-size: 10px;">Interceptor</a> <a href="/tags/JDK/" style="font-size: 10px;">JDK</a> <a href="/tags/JDK1-8/" style="font-size: 11.43px;">JDK1.8</a> <a href="/tags/JVM/" style="font-size: 17.14px;">JVM</a> <a href="/tags/JWT/" style="font-size: 10px;">JWT</a> <a href="/tags/Java/" style="font-size: 18.57px;">Java</a> <a href="/tags/Kafka/" style="font-size: 10px;">Kafka</a> <a href="/tags/Listener/" style="font-size: 10px;">Listener</a> <a href="/tags/MD5/" style="font-size: 10px;">MD5</a> <a href="/tags/Mockito/" style="font-size: 10px;">Mockito</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/NIO/" style="font-size: 14.29px;">NIO</a> <a href="/tags/Nginx/" style="font-size: 11.43px;">Nginx</a> <a href="/tags/OAuth/" style="font-size: 10px;">OAuth</a> <a href="/tags/OAuth-2-0/" style="font-size: 10px;">OAuth 2.0</a> <a href="/tags/Paxos/" style="font-size: 10px;">Paxos</a> <a href="/tags/Prototype/" style="font-size: 10px;">Prototype</a> <a href="/tags/Quartz/" style="font-size: 11.43px;">Quartz</a> <a href="/tags/RPC/" style="font-size: 20px;">RPC</a> <a href="/tags/RSA/" style="font-size: 10px;">RSA</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/Raft/" style="font-size: 10px;">Raft</a> <a href="/tags/Reactive-Streams/" style="font-size: 11.43px;">Reactive Streams</a> <a href="/tags/Reactor/" style="font-size: 10px;">Reactor</a> <a href="/tags/Redis/" style="font-size: 11.43px;">Redis</a> <a href="/tags/Redis-Sentinel/" style="font-size: 10px;">Redis Sentinel</a> <a href="/tags/Reference/" style="font-size: 10px;">Reference</a> <a href="/tags/Registrator/" style="font-size: 10px;">Registrator</a> <a href="/tags/RocketMQ/" style="font-size: 10px;">RocketMQ</a> <a href="/tags/RxJava/" style="font-size: 12.86px;">RxJava</a> <a href="/tags/SAML/" style="font-size: 10px;">SAML</a> <a href="/tags/SHA1/" style="font-size: 10px;">SHA1</a> <a href="/tags/SOFA-Boot/" style="font-size: 12.86px;">SOFA-Boot</a> <a href="/tags/SOFA-RPC/" style="font-size: 14.29px;">SOFA-RPC</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/ScheduledExecutorService/" style="font-size: 10px;">ScheduledExecutorService</a> <a href="/tags/Servlet/" style="font-size: 10px;">Servlet</a> <a href="/tags/Session/" style="font-size: 10px;">Session</a> <a href="/tags/Singleton/" style="font-size: 10px;">Singleton</a> <a href="/tags/Spring-Boot-2-0/" style="font-size: 18.57px;">Spring Boot 2.0</a> <a href="/tags/Spring-Cloud/" style="font-size: 11.43px;">Spring Cloud</a> <a href="/tags/Spring-Task/" style="font-size: 10px;">Spring Task</a> <a href="/tags/Spring-WebFlux/" style="font-size: 11.43px;">Spring WebFlux</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/Thrift/" style="font-size: 15.71px;">Thrift</a> <a href="/tags/Timer/" style="font-size: 10px;">Timer</a> <a href="/tags/Unique-ID/" style="font-size: 10px;">Unique ID</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/WebSocket/" style="font-size: 10px;">WebSocket</a> <a href="/tags/一致性哈希/" style="font-size: 10px;">一致性哈希</a> <a href="/tags/主从复制/" style="font-size: 10px;">主从复制</a> <a href="/tags/分布式/" style="font-size: 14.29px;">分布式</a> <a href="/tags/分布式存储/" style="font-size: 10px;">分布式存储</a> <a href="/tags/分片/" style="font-size: 10px;">分片</a> <a href="/tags/反向代理/" style="font-size: 10px;">反向代理</a> <a href="/tags/反模式/" style="font-size: 12.86px;">反模式</a> <a href="/tags/定时任务/" style="font-size: 10px;">定时任务</a> <a href="/tags/异步/" style="font-size: 15.71px;">异步</a> <a href="/tags/微服务/" style="font-size: 12.86px;">微服务</a> <a href="/tags/服务器/" style="font-size: 10px;">服务器</a> <a href="/tags/消息队列/" style="font-size: 10px;">消息队列</a> <a href="/tags/负载均衡/" style="font-size: 10px;">负载均衡</a> <a href="/tags/限流/" style="font-size: 10px;">限流</a> <a href="/tags/高并发/" style="font-size: 10px;">高并发</a> <a href="/tags/高性能/" style="font-size: 10px;">高性能</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://weekly.manong.io/issues" target="_blank">码农周刊</a>
                    </li>
                
                    <li>
                        <a href="https://www.tuicool.com/mags" target="_blank">编程狂人</a>
                    </li>
                
                    <li>
                        <a href="http://ifeve.com" target="_blank">并发编程网</a>
                    </li>
                
                    <li>
                        <a href="https://juejin.im" target="_blank">掘金</a>
                    </li>
                
                    <li>
                        <a href="http://www.jianshu.com" target="_blank">简书</a>
                    </li>
                
                    <li>
                        <a href="https://github.com" target="_blank">Github</a>
                    </li>
                
                    <li>
                        <a href="https://stackoverflow.com" target="_blank">StackoverFlow</a>
                    </li>
                
                    <li>
                        <a href="http://www.infoq.com" target="_blank">Infoq</a>
                    </li>
                
                    <li>
                        <a href="https://segmentfault.com" target="_blank">SegmentFault</a>
                    </li>
                
                    <li>
                        <a href="http://www.importnew.com" target="_blank">ImportNew</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fas fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2018 Chen Icarus<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">Icarus</a><br>
            
    <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1273891841'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s13.cnzz.com/z_stat.php%3Fid%3D1273891841%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>


        </div>
    </div>
</footer>
        
    
    
    <!-- 来必力City版安装代码 -->
    <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];

         if (typeof LivereTower === 'function') { return; }

         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;

         e.parentNode.insertBefore(j, e);
     })(document, 'script');
    </script>
  <noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
  <!-- City版安装代码已完成 -->





    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>